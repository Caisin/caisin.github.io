(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{369:function(t,a,_){t.exports=_.p+"assets/img/DatabaseLifeCycle.173e462c.png"},401:function(t,a,_){"use strict";_.r(a);var v=_(44),s=Object(v.a)({},(function(){var t=this,a=t.$createElement,v=t._self._c||a;return v("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[v("h1",{attrs:{id:"数据生命周期管理"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#数据生命周期管理"}},[t._v("#")]),t._v(" 数据生命周期管理")]),t._v(" "),v("h2",{attrs:{id:"_1-概述"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_1-概述"}},[t._v("#")]),t._v(" 1. 概述")]),t._v(" "),v("p",[t._v("系统中许多表存放的数据有一定的周期，在到达生命周期后需要做对其做相应的清理工作，现在的清理模式有：")]),t._v(" "),v("ol",[v("li",[v("p",[t._v("数据到达一年周期后搬迁至年表存放（各种日志表）")])]),t._v(" "),v("li",[v("p",[t._v("数据到达一年周期直接清理（工单历史表）")])]),t._v(" "),v("li",[v("p",[t._v("数据到达一个月周期后直接清理（工单异常日志表）")])]),t._v(" "),v("li",[v("p",[t._v("工单表数据三天前的要搬迁到当天的分区（工单表）")])])]),t._v(" "),v("p",[t._v("针对这些数据清理的要求，对应实现了数据清理的应用，通过定时任务按照每天、每月的周期对这些表的数据进行清理。")]),t._v(" "),v("h2",{attrs:{id:"_2-清理规则"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_2-清理规则"}},[t._v("#")]),t._v(" 2. 清理规则")]),t._v(" "),v("p",[t._v("针对清理要求，现支持的清理规则分为5种，")]),t._v(" "),v("ol",[v("li",[v("p",[t._v("采用交换分区的方式，每月末将一年前的月分区数据交换至年表中")])]),t._v(" "),v("li",[v("p",[t._v("无需年表保存的数据，每月末将一年前的月分区truncate即可")])]),t._v(" "),v("li",[v("p",[t._v("工单错误记录表按照日分区，无需保存历史数据，只需每天将一个月前的日分区truncate即可")])]),t._v(" "),v("li",[v("p",[t._v("工单表按照日分区，工单只会执行近三天的分区数据，所以每天将三天前的数据搬迁只当日分区后truncate三天前分区")])]),t._v(" "),v("li",[v("p",[t._v("月表在每月末需要将一年前的月表truncate，待下个月继续使用；")])])]),t._v(" "),v("h2",{attrs:{id:"_3-系统实现"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_3-系统实现"}},[t._v("#")]),t._v(" 3. 系统实现")]),t._v(" "),v("h3",{attrs:{id:"_3-1-模型设计"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-模型设计"}},[t._v("#")]),t._v(" 3.1 模型设计")]),t._v(" "),v("blockquote",[v("p",[v("strong",[t._v("清理规则参数表")]),t._v("BS_DCL，建立在账管参数库上")])]),t._v(" "),v("table",[v("thead",[v("tr",[v("th",[t._v("DCL_ID")]),t._v(" "),v("th",[t._v("数据清理任务标识")])])]),t._v(" "),v("tbody",[v("tr",[v("td",[t._v("DCL_NAME")]),t._v(" "),v("td",[t._v("数据清理任务描述")])]),t._v(" "),v("tr",[v("td",[t._v("SRC_TABLE_NAME")]),t._v(" "),v("td",[t._v("数据源表")])]),t._v(" "),v("tr",[v("td",[t._v("TEMP_TABLE_NAME")]),t._v(" "),v("td",[t._v("交换分区中间表")])]),t._v(" "),v("tr",[v("td",[t._v("DES_TABLE_NAME")]),t._v(" "),v("td",[t._v("数据目的表（用于交换分区和数据搬迁）")])]),t._v(" "),v("tr",[v("td",[t._v("REMOVE_CYCLE")]),t._v(" "),v("td",[t._v("清理周期，-1表示向前推1天/月，1表示向后推1天/月")])]),t._v(" "),v("tr",[v("td",[t._v("REMOVE_METHOD")]),t._v(" "),v("td",[t._v("清理方法（exchg-part：交换分区；trunc-mon-tab：清空月表；trunc-mon-part：清空月分区；trunc-day-part：清空日分区；move-to-his：在线表搬迁到历史表）")])]),t._v(" "),v("tr",[v("td",[t._v("REMOVE_COND")]),t._v(" "),v("td",[t._v("搬迁条件，仅使用在move-to-his方式时作为搬迁到历史表的条件")])]),t._v(" "),v("tr",[v("td",[t._v("DCL_DATE")]),t._v(" "),v("td",[t._v("清理周期（日）：0则每天都执行，1-31表示每月的某天执行")])]),t._v(" "),v("tr",[v("td",[t._v("DCL_HOUR")]),t._v(" "),v("td",[t._v("清理时刻（小时）")])]),t._v(" "),v("tr",[v("td",[t._v("DCL_MINUTE")]),t._v(" "),v("td",[t._v("清理时刻（分钟）")])]),t._v(" "),v("tr",[v("td",[t._v("STATE")]),t._v(" "),v("td",[t._v("状态（U：有效；N：无效）")])]),t._v(" "),v("tr",[v("td",[t._v("CONN_NAMES")]),t._v(" "),v("td",[t._v("连接名称，在那些链接下可用")])])])]),t._v(" "),v("blockquote",[v("p",[v("strong",[t._v("清理日志表")]),t._v("BS_DCL_LOG，建立在账管地州库和中心库上")])]),t._v(" "),v("table",[v("thead",[v("tr",[v("th",[t._v("DCL_ID")]),t._v(" "),v("th",[t._v("清理任务标识")])])]),t._v(" "),v("tbody",[v("tr",[v("td",[t._v("DCL_NAME")]),t._v(" "),v("td",[t._v("清理任务描述")])]),t._v(" "),v("tr",[v("td",[t._v("START_TIME")]),t._v(" "),v("td",[t._v("清理任务开始时间")])]),t._v(" "),v("tr",[v("td",[t._v("END_TIME")]),t._v(" "),v("td",[t._v("清理任务结束时间")])]),t._v(" "),v("tr",[v("td",[t._v("DURATION")]),t._v(" "),v("td",[t._v("清理时长（秒）")])]),t._v(" "),v("tr",[v("td",[t._v("RESULT_CODE")]),t._v(" "),v("td",[t._v("结果标志（F：成功；E：失败）")])]),t._v(" "),v("tr",[v("td",[t._v("ERR_INFO")]),t._v(" "),v("td",[t._v("异常信息")])])])]),t._v(" "),v("h3",{attrs:{id:"_3-2-代码路径"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-代码路径"}},[t._v("#")]),t._v(" 3.2 代码路径")]),t._v(" "),v("p",[t._v("清理程序：/home/aifet/asset/dcl/lib/acctcomp-dcl-5.0-SNAPSHOT.jar")]),t._v(" "),v("p",[t._v("配置文件： /home/aifet/asset/dcl/config")]),t._v(" "),v("h3",{attrs:{id:"_3-3-配置文件说明"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-配置文件说明"}},[t._v("#")]),t._v(" 3.3 配置文件说明")]),t._v(" "),v("p",[t._v("defaults.xml：数据库连接的配置")]),t._v(" "),v("p",[v("strong",[t._v("acctconfig.properties：清理规则的配置，具体配置内容如下：")])]),t._v(" "),v("div",{staticClass:"language-properties extra-class"},[v("pre",{pre:!0,attrs:{class:"language-properties"}},[v("code",[v("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 数据库连接管理器，不允许修改")]),t._v("\n\n"),v("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("db.conn.operator")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),v("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("com.ai.acctcomp.db.impl.DataSourceConnOperator")]),t._v("\n\n"),v("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 时间管理器，不允许修改")]),t._v("\n\n"),v("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("time.handler")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),v("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("com.ai.acctcomp.util.time.LocalTimeHandler")]),t._v("\n\n"),v("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 清理参数配置表bs_dcl所在的数据源")]),t._v("\n\n"),v("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("dcl.param.connname")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),v("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("ACTPARAM")]),t._v("\n\n"),v("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 参数配置刷新周期，以秒为单位")]),t._v("\n\n"),v("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("dcl.param.refresh.sec")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),v("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("1200")]),t._v("\n\n"),v("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 每种清理规则对应的实现类")]),t._v("\n\n"),v("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("dcl.method.exchg-part")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),v("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("com.ai.acctcomp.dcl.oper.ExchangePartition")]),t._v("\n\n"),v("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("dcl.method.trunc-mon-tab")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),v("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("com.ai.acctcomp.dcl.oper.TruncMonthTable")]),t._v("\n\n"),v("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("dcl.method.trunc-mon-part")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),v("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("com.ai.acctcomp.dcl.oper.TruncMonthPartition")]),t._v("\n\n"),v("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("dcl.method.trunc-day-part")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),v("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("com.ai.acctcomp.dcl.oper.TruncDatePartition")]),t._v("\n\n"),v("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("dcl.method.trunc-order-day")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),v("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("com.ai.acctcomp.dcl.oper.TruncOrderDatePart")]),t._v("\n\n"),v("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("dcl.method.move-to-his")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),v("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("com.ai.acctcomp.dcl.oper.MoveToHisOper")]),t._v("\n")])])]),v("h3",{attrs:{id:"_3-4-应用部署"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-应用部署"}},[t._v("#")]),t._v(" 3.4 应用部署")]),t._v(" "),v("table",[v("thead",[v("tr",[v("th",[t._v("主机IP")]),t._v(" "),v("th",[t._v("用户名/密码")]),t._v(" "),v("th",[t._v("程序目录")]),t._v(" "),v("th",[t._v("启动脚本")]),t._v(" "),v("th",[t._v("停止脚本")])])]),t._v(" "),v("tbody",[v("tr",[v("td",[t._v("172.25.136.16")]),t._v(" "),v("td",[t._v("aifet/1q1w1e1r")]),t._v(" "),v("td",[t._v("/home/aifet/asset/dcl")]),t._v(" "),v("td",[t._v("./bin/startAll.sh")]),t._v(" "),v("td",[t._v("./sbin/kill-app.sh dcl")])])])]),t._v(" "),v("h3",{attrs:{id:"_3-5-生命周期启动及停止操作说明"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_3-5-生命周期启动及停止操作说明"}},[t._v("#")]),t._v(" 3.5 生命周期启动及停止操作说明")]),t._v(" "),v("ol",[v("li",[v("p",[t._v("登录172.25.136.16主机，aifet用户 密码：1q1w1e1r")])]),t._v(" "),v("li",[v("p",[t._v("切到/home/aifet/asset/dcl目录下")])])]),t._v(" "),v("p",[v("img",{attrs:{src:_(369),alt:"生命周期截图"}})]),t._v(" "),v("blockquote",[v("p",[t._v("Bin目录存放启动脚")]),t._v(" "),v("p",[t._v("Config目录存在配置文件目录")]),t._v(" "),v("p",[t._v("Lib目录存放dcl程序及需要的jar包")]),t._v(" "),v("p",[t._v("Sbin 目录存放停止脚本")]),t._v(" "),v("p",[t._v("Logs目录存放每个中心启动时产生的日志记录")])]),t._v(" "),v("ol",{attrs:{start:"3"}},[v("li",[t._v("进入bin目录")])]),t._v(" "),v("blockquote",[v("p",[t._v("./startAll.sh 启动脚本")])]),t._v(" "),v("ol",{attrs:{start:"4"}},[v("li",[t._v("进入logs目录")])]),t._v(" "),v("blockquote",[v("p",[t._v("tail -1000f dcl_appAC1-1227.log 查看目录")])]),t._v(" "),v("ol",{attrs:{start:"5"}},[v("li",[t._v("如果需要停止进程")])]),t._v(" "),v("blockquote",[v("p",[t._v("进入sbin目录")]),t._v(" "),v("p",[t._v("./kill-app dcl 命令")])]),t._v(" "),v("h2",{attrs:{id:"_4-注意事项"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_4-注意事项"}},[t._v("#")]),t._v(" 4. 注意事项")]),t._v(" "),v("ol",[v("li",[v("p",[t._v("生命周期是定时任务。一次启动就不用再起。")])]),t._v(" "),v("li",[v("p",[t._v("BS_DCL表中配置的任务，每月/每日按照配置中的日期定时执行清理任务")])]),t._v(" "),v("li",[v("p",[t._v("新增表清理任务，需要在BS_DCL中新增任务配置，不需要刷缓存。并且需要重新启停生命周期管理进程。")])])])])}),[],!1,null,null,null);a.default=s.exports}}]);