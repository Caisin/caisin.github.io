<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>后台设计文档 | CMPAK 账管文档</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="CMPAK 账管交维文档">
    
    <link rel="preload" href="/acct-doc/assets/css/0.styles.51d143cd.css" as="style"><link rel="preload" href="/acct-doc/assets/js/app.63ad57cc.js" as="script"><link rel="preload" href="/acct-doc/assets/js/2.33beb707.js" as="script"><link rel="preload" href="/acct-doc/assets/js/10.3a0026ee.js" as="script"><link rel="prefetch" href="/acct-doc/assets/js/11.37b0e332.js"><link rel="prefetch" href="/acct-doc/assets/js/12.aeeb4d1b.js"><link rel="prefetch" href="/acct-doc/assets/js/13.ac323191.js"><link rel="prefetch" href="/acct-doc/assets/js/14.bd2cb70d.js"><link rel="prefetch" href="/acct-doc/assets/js/15.e224db95.js"><link rel="prefetch" href="/acct-doc/assets/js/16.1706826f.js"><link rel="prefetch" href="/acct-doc/assets/js/17.d60e9805.js"><link rel="prefetch" href="/acct-doc/assets/js/18.b7a13350.js"><link rel="prefetch" href="/acct-doc/assets/js/19.cf8e7b1d.js"><link rel="prefetch" href="/acct-doc/assets/js/20.105e9797.js"><link rel="prefetch" href="/acct-doc/assets/js/21.b3600cfd.js"><link rel="prefetch" href="/acct-doc/assets/js/22.fc9c31d9.js"><link rel="prefetch" href="/acct-doc/assets/js/23.63486421.js"><link rel="prefetch" href="/acct-doc/assets/js/24.206d6f32.js"><link rel="prefetch" href="/acct-doc/assets/js/25.fcfed3db.js"><link rel="prefetch" href="/acct-doc/assets/js/26.9c2a70ba.js"><link rel="prefetch" href="/acct-doc/assets/js/27.a56776c7.js"><link rel="prefetch" href="/acct-doc/assets/js/28.f3ad07db.js"><link rel="prefetch" href="/acct-doc/assets/js/29.b5b0f0f5.js"><link rel="prefetch" href="/acct-doc/assets/js/3.e252b8df.js"><link rel="prefetch" href="/acct-doc/assets/js/30.3b82be60.js"><link rel="prefetch" href="/acct-doc/assets/js/31.7cfde945.js"><link rel="prefetch" href="/acct-doc/assets/js/32.b0420cfa.js"><link rel="prefetch" href="/acct-doc/assets/js/33.9208bbca.js"><link rel="prefetch" href="/acct-doc/assets/js/34.1ef2f7cc.js"><link rel="prefetch" href="/acct-doc/assets/js/35.f00cf5a4.js"><link rel="prefetch" href="/acct-doc/assets/js/36.c8d22bd6.js"><link rel="prefetch" href="/acct-doc/assets/js/37.a8d4eb5f.js"><link rel="prefetch" href="/acct-doc/assets/js/4.6f4dd1f9.js"><link rel="prefetch" href="/acct-doc/assets/js/5.1dee15cb.js"><link rel="prefetch" href="/acct-doc/assets/js/6.6d4ac80a.js"><link rel="prefetch" href="/acct-doc/assets/js/7.e14e4b70.js"><link rel="prefetch" href="/acct-doc/assets/js/8.36259b9a.js"><link rel="prefetch" href="/acct-doc/assets/js/9.bbaf23c7.js">
    <link rel="stylesheet" href="/acct-doc/assets/css/0.styles.51d143cd.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/acct-doc/" class="home-link router-link-active"><!----> <span class="site-name">CMPAK 账管文档</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/acct-doc/zh/" class="nav-link router-link-active">
  首页
</a></div><div class="nav-item"><a href="/acct-doc/zh/deploy/" class="nav-link">
  发布
</a></div><div class="nav-item"><a href="/acct-doc/zh/environment/" class="nav-link">
  环境
</a></div><div class="nav-item"><a href="/acct-doc/zh/db/" class="nav-link">
  数据脚本
</a></div><div class="nav-item"><a href="/acct-doc/zh/cache/" class="nav-link">
  缓存
</a></div><div class="nav-item"><a href="/acct-doc/zh/param/" class="nav-link">
  参数
</a></div><div class="nav-item"><a href="/acct-doc/zh/assetcenter/" class="nav-link router-link-active">
  资产中心
</a></div><div class="nav-item"><a href="http://172.25.132.86:9000/cmpk-api/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CSF 服务
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/acct-doc/zh/assetcenter/后台设计文档.html" class="nav-link">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="/acct-doc/en/" class="nav-link">
  English
</a></li></ul></div></div> <a href="http://8.208.26.203:18082/cmpak/acctmanm" target="_blank" rel="noopener noreferrer" class="repo-link">
    Source
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/acct-doc/zh/" class="nav-link router-link-active">
  首页
</a></div><div class="nav-item"><a href="/acct-doc/zh/deploy/" class="nav-link">
  发布
</a></div><div class="nav-item"><a href="/acct-doc/zh/environment/" class="nav-link">
  环境
</a></div><div class="nav-item"><a href="/acct-doc/zh/db/" class="nav-link">
  数据脚本
</a></div><div class="nav-item"><a href="/acct-doc/zh/cache/" class="nav-link">
  缓存
</a></div><div class="nav-item"><a href="/acct-doc/zh/param/" class="nav-link">
  参数
</a></div><div class="nav-item"><a href="/acct-doc/zh/assetcenter/" class="nav-link router-link-active">
  资产中心
</a></div><div class="nav-item"><a href="http://172.25.132.86:9000/cmpk-api/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CSF 服务
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/acct-doc/zh/assetcenter/后台设计文档.html" class="nav-link">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="/acct-doc/en/" class="nav-link">
  English
</a></li></ul></div></div> <a href="http://8.208.26.203:18082/cmpak/acctmanm" target="_blank" rel="noopener noreferrer" class="repo-link">
    Source
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>资产中心</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/acct-doc/zh/assetcenter/" aria-current="page" class="sidebar-link">资产中心</a></li><li><a href="/acct-doc/zh/assetcenter/interface.html" class="sidebar-link">接口出入参</a></li><li><a href="/acct-doc/zh/assetcenter/writeoff.html" class="sidebar-link">抵扣</a></li><li><a href="/acct-doc/zh/assetcenter/前台设计文档.html" class="sidebar-link">前台设计文档</a></li><li><a href="/acct-doc/zh/assetcenter/后台设计文档.html" class="active sidebar-link">后台设计文档</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#第1章-ntn-bill-query" class="sidebar-link">第1章 NTN Bill Query</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#_1-1-基本描述" class="sidebar-link">1.1 基本描述</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#_1-2-业务流程" class="sidebar-link">1.2 业务流程</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#_1-3-业务表说明" class="sidebar-link">1.3 业务表说明</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#_1-4-关键配置说明" class="sidebar-link">1.4 关键配置说明</a></li></ul></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#第2章-预付费账本调账" class="sidebar-link">第2章 预付费账本调账</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#_2-1-基本描述-basic-description" class="sidebar-link">2.1 基本描述-basic description</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#_2-2-业务流程-business-process" class="sidebar-link">2.2 业务流程-business process</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#_2-3-关键配置说明" class="sidebar-link">2.3 关键配置说明</a></li></ul></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#第3章-集团完税进程" class="sidebar-link">第3章 集团完税进程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#_3-1-基本描述-basic-description" class="sidebar-link">3.1 基本描述-basic description</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#_3-2-业务流程-business-process" class="sidebar-link">3.2 业务流程-business process</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#_3-3-关键配置说明" class="sidebar-link">3.3 关键配置说明</a></li></ul></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#第4章-个人批量完税" class="sidebar-link">第4章 个人批量完税</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#_4-1-基本描述-basic-description" class="sidebar-link">4.1 基本描述-basic description</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#_4-2-业务流程-business-process" class="sidebar-link">4.2 业务流程-business process</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#_4-3-关键配置说明" class="sidebar-link">4.3 关键配置说明</a></li></ul></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#第5章-vc充值同步" class="sidebar-link">第5章 VC充值同步</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#_5-1-基本描述-basic-description" class="sidebar-link">5.1 基本描述-basic description</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#_5-2-业务流程-business-process" class="sidebar-link">5.2 业务流程-business process</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#_5-3-关键配置说明" class="sidebar-link">5.3 关键配置说明</a></li></ul></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#第6章-完税文件归集和文件生成" class="sidebar-link">第6章 完税文件归集和文件生成</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#_6-1-基本描述-basic-description" class="sidebar-link">6.1 基本描述-basic description</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#_6-2-业务流程-business-process" class="sidebar-link">6.2 业务流程-business process</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#_6-3-关键配置说明" class="sidebar-link">6.3 关键配置说明</a></li></ul></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#第7章-充值分发" class="sidebar-link">第7章 充值分发</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#_7-1-基本描述-basic-description" class="sidebar-link">7.1 基本描述-basic description</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#_7-2-业务流程-business-process" class="sidebar-link">7.2 业务流程-business process</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#_7-3-关键配置说明" class="sidebar-link">7.3 关键配置说明</a></li></ul></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#第8章-实时扣费业务回滚" class="sidebar-link">第8章 实时扣费业务回滚</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#_8-1-基本描述-basic-description" class="sidebar-link">8.1 基本描述-basic description</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#_8-2-业务流程" class="sidebar-link">8.2 业务流程</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#_8-3-业务表说明" class="sidebar-link">8.3 业务表说明:</a></li></ul></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#第9章-数据同步进程" class="sidebar-link">第9章 数据同步进程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#_9-1-基本描述" class="sidebar-link">9.1 基本描述</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#_9-2-业务流程" class="sidebar-link">9.2 业务流程</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#_9-3-业务表说明" class="sidebar-link">9.3 业务表说明</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#_9-4-关键配置说明" class="sidebar-link">9.4 关键配置说明</a></li></ul></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#第10章-外部费用同步" class="sidebar-link">第10章 外部费用同步</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#_10-1-基本描述" class="sidebar-link">10.1 基本描述</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#_10-2-业务流程" class="sidebar-link">10.2 业务流程</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#_10-3-关键表说明" class="sidebar-link">10.3 关键表说明</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#_10-4-关键配置说明" class="sidebar-link">10.4 关键配置说明</a></li></ul></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#第11章-usage短信发送" class="sidebar-link">第11章 usage短信发送</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#_11-1-基本描述" class="sidebar-link">11.1 基本描述</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#_11-2-业务流程" class="sidebar-link">11.2 业务流程</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#_11-3-业务表说明" class="sidebar-link">11.3 业务表说明</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#_11-4-关键配置说明" class="sidebar-link">11.4 关键配置说明</a></li></ul></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#第12章-参数同步进程" class="sidebar-link">第12章 参数同步进程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#基本描述" class="sidebar-link">基本描述</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#业务流程" class="sidebar-link">业务流程</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#业务表说明" class="sidebar-link">业务表说明</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#关键参数配置说明" class="sidebar-link">关键参数配置说明</a></li></ul></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#第13章-批量vc充值" class="sidebar-link">第13章 批量vc充值</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#第14章-0缴费销账工单" class="sidebar-link">第14章 0缴费销账工单</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#黄典后台" class="sidebar-link">黄典后台</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#基本描述-basic-description" class="sidebar-link">基本描述-basic description</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#业务流程-business-process" class="sidebar-link">业务流程-business process</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#业务表说明-2" class="sidebar-link">业务表说明</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#关键配置说明" class="sidebar-link">关键配置说明</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#基本描述-basic-description-2" class="sidebar-link">基本描述-basic description</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#业务流程-business-process-2" class="sidebar-link">业务流程-business process</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#业务表说明-3" class="sidebar-link">业务表说明</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#关键配置说明-2" class="sidebar-link">关键配置说明</a></li></ul></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#周琪宏后台" class="sidebar-link">周琪宏后台</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#后付费出帐后的短信提醒" class="sidebar-link">后付费出帐后的短信提醒</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#基本描述-basic-description-3" class="sidebar-link">基本描述-basic description</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#业务流程-business-process-3" class="sidebar-link">业务流程-business process</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#业务表说明-4" class="sidebar-link">业务表说明</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#关键配置说明-3" class="sidebar-link">关键配置说明</a></li></ul></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#后付费号码月底短信提醒" class="sidebar-link">后付费号码月底短信提醒</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#基本描述-basic-description-4" class="sidebar-link">基本描述-basic description</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#业务流程-business-process-4" class="sidebar-link">业务流程-business process</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#业务表说明-5" class="sidebar-link">业务表说明</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#关键配置说明-4" class="sidebar-link">关键配置说明</a></li></ul></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#后付费号码月中短信提醒" class="sidebar-link">后付费号码月中短信提醒</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#基本描述-basic-description-5" class="sidebar-link">基本描述-basic description</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#业务流程-business-process-5" class="sidebar-link">业务流程-business process</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#业务表说明-6" class="sidebar-link">业务表说明</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#关键配置说明-5" class="sidebar-link">关键配置说明</a></li></ul></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#月租费使用提醒" class="sidebar-link">月租费使用提醒</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#" class="sidebar-link"></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#基本描述-basic-description-6" class="sidebar-link">基本描述-basic description</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#业务流程-business-process-6" class="sidebar-link">业务流程-business process</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#业务表说明-7" class="sidebar-link">业务表说明</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#关键配置说明-6" class="sidebar-link">关键配置说明</a></li></ul></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#多重账单提醒" class="sidebar-link">多重账单提醒</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#基本描述-basic-description-7" class="sidebar-link">基本描述-basic description</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#业务流程-business-process-7" class="sidebar-link">业务流程-business process</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#业务表说明-8" class="sidebar-link">业务表说明</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#关键配置说明-7" class="sidebar-link">关键配置说明</a></li></ul></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#无邮寄地址提醒" class="sidebar-link">无邮寄地址提醒</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#基本描述-basic-description-8" class="sidebar-link">基本描述-basic description</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#业务流程-business-process-8" class="sidebar-link">业务流程-business process</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#业务表说明-9" class="sidebar-link">业务表说明</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#关键配置说明-8" class="sidebar-link">关键配置说明</a></li></ul></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#最多打电话提醒" class="sidebar-link">最多打电话提醒</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#基本描述-basic-description-9" class="sidebar-link">基本描述-basic description</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#业务流程-business-process-9" class="sidebar-link">业务流程-business process</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#业务表说明-10" class="sidebar-link">业务表说明</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#关键配置说明-9" class="sidebar-link">关键配置说明</a></li></ul></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#批量押金缴欠费" class="sidebar-link">批量押金缴欠费</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#基本描述-basic-description-10" class="sidebar-link">基本描述-basic description</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#业务流程-business-process-10" class="sidebar-link">业务流程-business process</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#业务表说明-11" class="sidebar-link">业务表说明</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#关键配置说明-10" class="sidebar-link">关键配置说明</a></li></ul></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#批量退押金" class="sidebar-link">批量退押金</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#基本描述-basic-description-11" class="sidebar-link">基本描述-basic description</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#业务流程-business-process-11" class="sidebar-link">业务流程-business process</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#业务表说明-12" class="sidebar-link">业务表说明</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#关键配置说明-11" class="sidebar-link">关键配置说明</a></li></ul></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#ntn退押金" class="sidebar-link">NTN退押金</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#基本描述-basic-description-12" class="sidebar-link">基本描述-basic description</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#业务流程-business-process-12" class="sidebar-link">业务流程-business process</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#业务表说明-13" class="sidebar-link">业务表说明</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#关键配置说明-12" class="sidebar-link">关键配置说明</a></li></ul></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#业务流程-business-process-13" class="sidebar-link">业务流程-business process</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#业务表说明-14" class="sidebar-link">业务表说明</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#关键配置说明-13" class="sidebar-link">关键配置说明</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#基本描述-basic-description-13" class="sidebar-link">基本描述-basic description</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#业务流程-business-process-14" class="sidebar-link">业务流程-business process</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#业务表说明-15" class="sidebar-link">业务表说明</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#关键配置说明-14" class="sidebar-link">关键配置说明</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#邮寄账单-post-bill-task" class="sidebar-link">邮寄账单-Post Bill Task</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#基本描述-basic-description-14" class="sidebar-link">基本描述-basic description</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#单个号码生成介绍" class="sidebar-link">单个号码生成介绍</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/后台设计文档.html#业务流程-business-process-15" class="sidebar-link">业务流程-business process</a></li></ul></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="后台设计文档"><a href="#后台设计文档" class="header-anchor">#</a> 后台设计文档</h1> <p></p><div class="table-of-contents"><ul><li><a href="#第1章-ntn-bill-query">第1章 NTN Bill Query</a><ul><li><a href="#_1-1-基本描述">1.1 基本描述</a></li><li><a href="#_1-2-业务流程">1.2 业务流程</a></li><li><a href="#_1-3-业务表说明">1.3 业务表说明</a></li><li><a href="#_1-4-关键配置说明">1.4 关键配置说明</a></li></ul></li><li><a href="#第2章-预付费账本调账">第2章 预付费账本调账</a><ul><li><a href="#_2-1-基本描述-basic-description">2.1 基本描述-basic description</a></li><li><a href="#_2-2-业务流程-business-process">2.2 业务流程-business process</a></li><li><a href="#_2-3-关键配置说明">2.3 关键配置说明</a></li></ul></li><li><a href="#第3章-集团完税进程">第3章 集团完税进程</a><ul><li><a href="#_3-1-基本描述-basic-description">3.1 基本描述-basic description</a></li><li><a href="#_3-2-业务流程-business-process">3.2 业务流程-business process</a></li><li><a href="#_3-3-关键配置说明">3.3 关键配置说明</a></li></ul></li><li><a href="#第4章-个人批量完税">第4章 个人批量完税</a><ul><li><a href="#_4-1-基本描述-basic-description">4.1 基本描述-basic description</a></li><li><a href="#_4-2-业务流程-business-process">4.2 业务流程-business process</a></li><li><a href="#_4-3-关键配置说明">4.3 关键配置说明</a></li></ul></li><li><a href="#第5章-vc充值同步">第5章 VC充值同步</a><ul><li><a href="#_5-1-基本描述-basic-description">5.1 基本描述-basic description</a></li><li><a href="#_5-2-业务流程-business-process">5.2 业务流程-business process</a></li><li><a href="#_5-3-关键配置说明">5.3 关键配置说明</a></li></ul></li><li><a href="#第6章-完税文件归集和文件生成">第6章 完税文件归集和文件生成</a><ul><li><a href="#_6-1-基本描述-basic-description">6.1 基本描述-basic description</a></li><li><a href="#_6-2-业务流程-business-process">6.2 业务流程-business process</a></li><li><a href="#_6-3-关键配置说明">6.3 关键配置说明</a></li></ul></li><li><a href="#第7章-充值分发">第7章 充值分发</a><ul><li><a href="#_7-1-基本描述-basic-description">7.1 基本描述-basic description</a></li><li><a href="#_7-2-业务流程-business-process">7.2 业务流程-business process</a></li><li><a href="#_7-3-关键配置说明">7.3 关键配置说明</a></li></ul></li><li><a href="#第8章-实时扣费业务回滚">第8章 实时扣费业务回滚</a><ul><li><a href="#_8-1-基本描述-basic-description">8.1 基本描述-basic description</a></li><li><a href="#_8-2-业务流程">8.2 业务流程</a></li><li><a href="#_8-3-业务表说明">8.3 业务表说明:</a></li></ul></li><li><a href="#第9章-数据同步进程">第9章 数据同步进程</a><ul><li><a href="#_9-1-基本描述">9.1 基本描述</a></li><li><a href="#_9-2-业务流程">9.2 业务流程</a></li><li><a href="#_9-3-业务表说明">9.3 业务表说明</a></li><li><a href="#_9-4-关键配置说明">9.4 关键配置说明</a></li></ul></li><li><a href="#第10章-外部费用同步">第10章 外部费用同步</a><ul><li><a href="#_10-1-基本描述">10.1 基本描述</a></li><li><a href="#_10-2-业务流程">10.2 业务流程</a></li><li><a href="#_10-3-关键表说明">10.3 关键表说明</a></li><li><a href="#_10-4-关键配置说明">10.4 关键配置说明</a></li></ul></li><li><a href="#第11章-usage短信发送">第11章 usage短信发送</a><ul><li><a href="#_11-1-基本描述">11.1 基本描述</a></li><li><a href="#_11-2-业务流程">11.2 业务流程</a></li><li><a href="#_11-3-业务表说明">11.3 业务表说明</a></li><li><a href="#_11-4-关键配置说明">11.4 关键配置说明</a></li></ul></li><li><a href="#第12章-参数同步进程">第12章 参数同步进程</a><ul><li><a href="#基本描述">基本描述</a></li><li><a href="#业务流程">业务流程</a></li><li><a href="#业务表说明">业务表说明</a></li><li><a href="#关键参数配置说明">关键参数配置说明</a></li></ul></li><li><a href="#第13章-批量vc充值">第13章 批量vc充值</a></li><li><a href="#第14章-0缴费销账工单">第14章 0缴费销账工单</a></li><li><a href="#黄典后台">黄典后台</a><ul><li><a href="#基本描述-basic-description">基本描述-basic description</a></li><li><a href="#业务流程-business-process">业务流程-business process</a></li><li><a href="#业务表说明">业务表说明</a></li><li><a href="#关键配置说明">关键配置说明</a></li><li><a href="#基本描述-basic-description">基本描述-basic description</a></li><li><a href="#业务流程-business-process">业务流程-business process</a></li><li><a href="#业务表说明">业务表说明</a></li><li><a href="#关键配置说明">关键配置说明</a></li></ul></li><li><a href="#周琪宏后台">周琪宏后台</a></li><li><a href="#后付费出帐后的短信提醒">后付费出帐后的短信提醒</a><ul><li><a href="#基本描述-basic-description">基本描述-basic description</a></li><li><a href="#业务流程-business-process">业务流程-business process</a></li><li><a href="#业务表说明">业务表说明</a></li><li><a href="#关键配置说明">关键配置说明</a></li></ul></li><li><a href="#后付费号码月底短信提醒">后付费号码月底短信提醒</a><ul><li><a href="#基本描述-basic-description">基本描述-basic description</a></li><li><a href="#业务流程-business-process">业务流程-business process</a></li><li><a href="#业务表说明">业务表说明</a></li><li><a href="#关键配置说明">关键配置说明</a></li></ul></li><li><a href="#后付费号码月中短信提醒">后付费号码月中短信提醒</a><ul><li><a href="#基本描述-basic-description">基本描述-basic description</a></li><li><a href="#业务流程-business-process">业务流程-business process</a></li><li><a href="#业务表说明">业务表说明</a></li><li><a href="#关键配置说明">关键配置说明</a></li></ul></li><li><a href="#月租费使用提醒">月租费使用提醒</a></li><li><a href="#"></a><ul><li><a href="#基本描述-basic-description">基本描述-basic description</a></li><li><a href="#业务流程-business-process">业务流程-business process</a></li><li><a href="#业务表说明">业务表说明</a></li><li><a href="#关键配置说明">关键配置说明</a></li></ul></li><li><a href="#多重账单提醒">多重账单提醒</a><ul><li><a href="#基本描述-basic-description">基本描述-basic description</a></li><li><a href="#业务流程-business-process">业务流程-business process</a></li><li><a href="#业务表说明">业务表说明</a></li><li><a href="#关键配置说明">关键配置说明</a></li></ul></li><li><a href="#无邮寄地址提醒">无邮寄地址提醒</a><ul><li><a href="#基本描述-basic-description">基本描述-basic description</a></li><li><a href="#业务流程-business-process">业务流程-business process</a></li><li><a href="#业务表说明">业务表说明</a></li><li><a href="#关键配置说明">关键配置说明</a></li></ul></li><li><a href="#最多打电话提醒">最多打电话提醒</a><ul><li><a href="#基本描述-basic-description">基本描述-basic description</a></li><li><a href="#业务流程-business-process">业务流程-business process</a></li><li><a href="#业务表说明">业务表说明</a></li><li><a href="#关键配置说明">关键配置说明</a></li></ul></li><li><a href="#批量押金缴欠费">批量押金缴欠费</a><ul><li><a href="#基本描述-basic-description">基本描述-basic description</a></li><li><a href="#业务流程-business-process">业务流程-business process</a></li><li><a href="#业务表说明">业务表说明</a></li><li><a href="#关键配置说明">关键配置说明</a></li></ul></li><li><a href="#批量退押金">批量退押金</a><ul><li><a href="#基本描述-basic-description">基本描述-basic description</a></li><li><a href="#业务流程-business-process">业务流程-business process</a></li><li><a href="#业务表说明">业务表说明</a></li><li><a href="#关键配置说明">关键配置说明</a></li></ul></li><li><a href="#ntn退押金">NTN退押金</a><ul><li><a href="#基本描述-basic-description">基本描述-basic description</a></li><li><a href="#业务流程-business-process">业务流程-business process</a></li><li><a href="#业务表说明">业务表说明</a></li><li><a href="#关键配置说明">关键配置说明</a></li></ul></li><li><a href="#业务流程-business-process">业务流程-business process</a></li><li><a href="#业务表说明">业务表说明</a></li><li><a href="#关键配置说明">关键配置说明</a></li><li><a href="#基本描述-basic-description">基本描述-basic description</a></li><li><a href="#业务流程-business-process">业务流程-business process</a></li><li><a href="#业务表说明">业务表说明</a></li><li><a href="#关键配置说明">关键配置说明</a></li><li><a href="#邮寄账单-post-bill-task">邮寄账单-Post Bill Task</a><ul><li><a href="#基本描述-basic-description">基本描述-basic description</a></li><li><a href="#单个号码生成介绍">单个号码生成介绍</a></li><li><a href="#业务流程-business-process">业务流程-business process</a></li></ul></li></ul></div><p></p> <h2 id="第1章-ntn-bill-query"><a href="#第1章-ntn-bill-query" class="header-anchor">#</a> 第1章 NTN Bill Query</h2> <h3 id="_1-1-基本描述"><a href="#_1-1-基本描述" class="header-anchor">#</a> 1.1 基本描述</h3> <p>​		通过NTN、DEPT、开始结束月份,实时统计NTN当前成员每个月的总出账金额,历史欠费,缴费金额,</p> <p>成NTN员总的历史欠费,总的实时月账单,余额,信用度,账单的总体信息，后付费明细和预付费明细</p> <h3 id="_1-2-业务流程"><a href="#_1-2-业务流程" class="header-anchor">#</a> 1.2 业务流程</h3> <ol><li><p>输入NTN号码,开始结束月份,DEPT选填；</p></li> <li><p>点击查询,生成一条NTN工单；</p></li> <li><p>NTN Bill Query的工单会异步处理,生成成员详细信息；</p></li> <li><p>后台处理逻辑见后台文档</p></li></ol> <h3 id="_1-3-业务表说明"><a href="#_1-3-业务表说明" class="header-anchor">#</a> 1.3 业务表说明</h3> <ol><li><p>NTN工单表</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> cen<span class="token punctuation">.</span>AM_NTN_TASK<span class="token punctuation">;</span>
</code></pre></div></li> <li><p>NTN详情</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> cen<span class="token punctuation">.</span>AM_NTN_TASK_DETAILS
</code></pre></div></li> <li><p>NTN 费用信息</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> cen<span class="token punctuation">.</span>AM_NTN_FEE<span class="token punctuation">;</span>
</code></pre></div></li></ol> <h3 id="_1-4-关键配置说明"><a href="#_1-4-关键配置说明" class="header-anchor">#</a> 1.4 关键配置说明</h3> <blockquote><p>进程接口: asset_ITaskCSV_ntnBillQuery</p></blockquote> <h2 id="第2章-预付费账本调账"><a href="#第2章-预付费账本调账" class="header-anchor">#</a> 第2章 预付费账本调账</h2> <h3 id="_2-1-基本描述-basic-description"><a href="#_2-1-基本描述-basic-description" class="header-anchor">#</a> 2.1 基本描述-basic description</h3> <p>预付费账本批量调账。从前台导入EXCEl表格。按照导入的号码依次调用预付费账本调账接口</p> <h3 id="_2-2-业务流程-business-process"><a href="#_2-2-业务流程-business-process" class="header-anchor">#</a> 2.2 业务流程-business process</h3> <ol><li>前端校验逻辑</li></ol> <p>a) 添加的手机号码不能重复</p> <ol start="2"><li>提交逻辑</li></ol> <p>2.1输入了CPR_NO,需要校验cprNo是否重复</p> <p>2.2 输入了OUT_GOING_VALIDATY(改变生命周期天数)</p> <p>a) 查询生命周期生失效时间, 失效时间加上指定天数,重新赋值到map中</p> <p>2.3 金额大于0,走充值逻辑</p> <p>2.4 金额小于0,走扣减逻辑</p> <p>2.5 写入一条调整记录 --&gt; AM_ADJUSTMENT_REC</p> <ol start="3"><li>扣减逻辑 (注意:负金额是扣减), 主要逻辑在 --&gt; PrepaidDeductLogic#doDeduct</li></ol> <p>3.1 汇总扣减走金额</p> <p>3.2 设置交易信息,即用input的值给tradeBean赋值, 方便后面通过tradeBean的各种取值</p> <p>3.3 待扣减列表中相同账本科目id金额进行合并</p> <p>3.4 查询预付费账本列表</p> <p>3.5 待扣减列表和账本列表进行预扣,得到需要扣减的账本信息</p> <p>a) 遍历待扣减列表</p> <p>b) 调高的逻辑</p> <ol><li><p>指定账本id时, 查找指定账本并增加余额, 不存在则新建</p></li> <li><p>不指定账本id时, 查找通用账本并增加余额,不存在则新建账本</p></li></ol> <p>d) 调低时的逻辑</p> <ol><li><p>指定账本id时, 查找指定账本并扣减账本余额, 不存在则报错</p></li> <li><p>不指定账本id时,查找通用账本并扣减账本余额</p></li> <li><p>账本余额不足扣减,直接报错</p></li></ol> <p>3.6 拿到预扣减的账本列表,上发账本</p> <p>a) 金额大于0,插入上发表</p> <p>b) 金额小于0,通过webservice扣减</p> <p>3.7 写业务日志</p> <p>3.8 手动改变用户生命周期</p> <p>3.9 记录充值累计信息,插入通知表</p> <p>3.10 发送短信</p> <ol start="4"><li>webservice扣减</li></ol> <p>4.1 组织参数, 调webservice扣减</p> <p>4.2 另起事务,插入一条正的余额到回滚表, 防止后面失败,webservice扣减的余额好回滚业务表说明</p> <h3 id="_2-3-关键配置说明"><a href="#_2-3-关键配置说明" class="header-anchor">#</a> 2.3 关键配置说明</h3> <blockquote><p>任务处理接口：asset_ITaskCSV_adjustBalance</p></blockquote> <p>工单配置：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> t<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span>rowid <span class="token keyword">from</span> param<span class="token punctuation">.</span>bs_work_order_conf t <span class="token keyword">where</span> t<span class="token punctuation">.</span>order_code <span class="token operator">=</span> <span class="token string">'BatchBalanceAdjust'</span><span class="token punctuation">;</span>

<span class="token keyword">select</span> t<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span>rowid <span class="token keyword">from</span> param<span class="token punctuation">.</span>bs_work_order_channel t <span class="token keyword">where</span> t<span class="token punctuation">.</span>order_code <span class="token operator">=</span> <span class="token string">'BatchBalanceAdjust'</span><span class="token punctuation">;</span>
</code></pre></div><p>工单表：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> t<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span>rowid <span class="token keyword">from</span> cen<span class="token punctuation">.</span>am_batch_adjust_balance t<span class="token punctuation">;</span>
</code></pre></div><h2 id="第3章-集团完税进程"><a href="#第3章-集团完税进程" class="header-anchor">#</a> 第3章 集团完税进程</h2> <h3 id="_3-1-基本描述-basic-description"><a href="#_3-1-基本描述-basic-description" class="header-anchor">#</a> 3.1 基本描述-basic description</h3> <p>前台输入NTN账号，选择起始月份，输入跨度周期。</p> <h3 id="_3-2-业务流程-business-process"><a href="#_3-2-业务流程-business-process" class="header-anchor">#</a> 3.2 业务流程-business process</h3> <p>a)  定时查询集团完税工单表状态为0的数据。</p> <p>b)  按照捞到的数据调用个人完税查询接口查询完税信息。</p> <p>c)  将查出来的结果更新到集团完税工单表中。</p> <h3 id="_3-3-关键配置说明"><a href="#_3-3-关键配置说明" class="header-anchor">#</a> 3.3 关键配置说明</h3> <blockquote><p>acctmanmassetprocesssrcmainjavacomaiaccoretaxtaskGroupTaxCertifyGenTask.java</p></blockquote> <p>工单配置：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> t<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span>rowid <span class="token keyword">from</span> param<span class="token punctuation">.</span>bs_task t <span class="token keyword">where</span> task_code<span class="token operator">=</span><span class="token string">'GroupTaxCertifyGenTask'</span><span class="token punctuation">;</span>

<span class="token keyword">select</span> t<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span>rowid <span class="token keyword">from</span> param<span class="token punctuation">.</span>bs_task_channel t <span class="token keyword">where</span> task_code<span class="token operator">=</span><span class="token string">'GroupTaxCertifyGenTask'</span><span class="token punctuation">;</span>
</code></pre></div><p>工单表：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> t<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span>rowid <span class="token keyword">from</span> CEN<span class="token punctuation">.</span>AM_NTN_TAX_CERTIFY t <span class="token keyword">WHERE</span> T<span class="token punctuation">.</span>NTN_ID <span class="token operator">=</span> <span class="token string">'0022370-7'</span> <span class="token operator">and</span> t<span class="token punctuation">.</span>certify_cycle <span class="token operator">=</span> <span class="token string">'201807:12'</span><span class="token punctuation">;</span>
<span class="token comment">--根据ntn_id dept_id及phone_id查询</span>
</code></pre></div><h2 id="第4章-个人批量完税"><a href="#第4章-个人批量完税" class="header-anchor">#</a> 第4章 个人批量完税</h2> <h3 id="_4-1-基本描述-basic-description"><a href="#_4-1-基本描述-basic-description" class="header-anchor">#</a> 4.1 基本描述-basic description</h3> <p>前台导入批量文件，选择账期和月份，点击导入，后台异步查询完税信息，按照号码生成pdf，上传至pdf主机。更新工单表，保存工单信息。前台按照批次号查询导入信息。</p> <h3 id="_4-2-业务流程-business-process"><a href="#_4-2-业务流程-business-process" class="header-anchor">#</a> 4.2 业务流程-business process</h3> <p>d)  先查询个人批量完税主表，获取批次号</p> <p>e)  根据批次号查询个人批量完税明细表，捞取号码信息</p> <p>f)  根据号码查询完税信息，生成pdf，上传至ftp主机。</p> <h3 id="_4-3-关键配置说明"><a href="#_4-3-关键配置说明" class="header-anchor">#</a> 4.3 关键配置说明</h3> <blockquote><p>acctmanmassetprocesssrcmainjavacomaiaccoretaxtaskBulkTaxCertifyGenTask.java</p></blockquote> <p>工单配置：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> t<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span>rowid <span class="token keyword">from</span> param<span class="token punctuation">.</span>bs_task t <span class="token keyword">where</span> task_code<span class="token operator">=</span> BulkTaxCertifyGenTask<span class="token punctuation">;</span>

<span class="token keyword">select</span> t<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span>rowid <span class="token keyword">from</span> param<span class="token punctuation">.</span>bs_task_channel t <span class="token keyword">where</span> task_code<span class="token operator">=</span> BulkTaxCertifyGenTask<span class="token punctuation">;</span>
</code></pre></div><p>工单表：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> BATCH_ID<span class="token punctuation">,</span>STS <span class="token keyword">FROM</span> AM_BULK_TAX_CERTIFY <span class="token keyword">WHERE</span> STS<span class="token operator">=</span>?<span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> BATCH_ID<span class="token punctuation">,</span>REGION_CODE<span class="token punctuation">,</span>PHONE_ID<span class="token punctuation">,</span>ACCT_ID<span class="token punctuation">,</span>CUST_ID<span class="token punctuation">,</span>CERTIFY_CYCLE<span class="token punctuation">,</span>STS <span class="token keyword">FROM</span> AM_BULK_TAX_CERTIFY_DTL <span class="token keyword">WHERE</span> BATCH_ID<span class="token operator">=</span>? <span class="token operator">AND</span> STS<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="第5章-vc充值同步"><a href="#第5章-vc充值同步" class="header-anchor">#</a> 第5章 VC充值同步</h2> <h3 id="_5-1-基本描述-basic-description"><a href="#_5-1-基本描述-basic-description" class="header-anchor">#</a> 5.1 基本描述-basic description</h3> <p>Vc平台充值，将充值记录同步至账管中心库vc记录表。工单处理记录。将充值信息同步到账管业务流水表中，渠道业务流水表中。</p> <h3 id="_5-2-业务流程-business-process"><a href="#_5-2-业务流程-business-process" class="header-anchor">#</a> 5.2 业务流程-business process</h3> <p>g)  获取工单表中状态为0的工单</p> <p>h)  ETOP充值调用ETOP同步接口，查询代理商资料，记录am_busi，ag_busi，渠道业务表。</p> <p>i)  充值卡调用充值卡接口，记录am_busi</p> <p>j)  ETop 转账记录ETOP转账接口，查询代理商资料，记录am_busi，ag_busi，渠道业务表。</p> <h3 id="_5-3-关键配置说明"><a href="#_5-3-关键配置说明" class="header-anchor">#</a> 5.3 关键配置说明</h3> <blockquote><p>asset_ITaskCSV_reprocessRechargeRec</p></blockquote> <p>工单配置：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> t<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span>rowid <span class="token keyword">from</span> param<span class="token punctuation">.</span>bs_task t <span class="token keyword">where</span> task_code<span class="token operator">=</span><span class="token string">' ReprocessRechargeRec'</span><span class="token punctuation">;</span>

<span class="token keyword">select</span> t<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span>rowid <span class="token keyword">from</span> param<span class="token punctuation">.</span>bs_task_channel t <span class="token keyword">where</span> task_code<span class="token operator">=</span><span class="token string">' ReprocessRechargeRec'</span><span class="token punctuation">;</span>
</code></pre></div><p>工单表：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> A<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span> A<span class="token punctuation">.</span>ROWID<span class="token punctuation">,</span> A<span class="token punctuation">.</span>OP_ID <span class="token keyword">AS</span> TRADE_OP_ID<span class="token punctuation">,</span>A<span class="token punctuation">.</span>SO_ORG_ID <span class="token keyword">AS</span> TRADE_ORG_ID<span class="token punctuation">,</span>A<span class="token punctuation">.</span>SO_COUNTY_CODE <span class="token keyword">AS</span> TRADE_COUNTY_CODE<span class="token punctuation">,</span>A<span class="token punctuation">.</span>SO_REGION_CODE <span class="token keyword">AS</span> TRADE_REGION_ID <span class="token keyword">FROM</span> AM_CHARGE_REC_DONE A <span class="token keyword">WHERE</span> A<span class="token punctuation">.</span>FLAG<span class="token operator">=</span><span class="token number">0</span>
</code></pre></div><h2 id="第6章-完税文件归集和文件生成"><a href="#第6章-完税文件归集和文件生成" class="header-anchor">#</a> 第6章 完税文件归集和文件生成</h2> <h3 id="_6-1-基本描述-basic-description"><a href="#_6-1-基本描述-basic-description" class="header-anchor">#</a> 6.1 基本描述-basic description</h3> <h3 id="_6-2-业务流程-business-process"><a href="#_6-2-业务流程-business-process" class="header-anchor">#</a> 6.2 业务流程-business process</h3> <ol><li><p>从am_busi和am_recive_fee表里按照完税周期获取缴费记录</p></li> <li><p>调用完税查询接口生成个人完税信息保存至表中</p></li> <li><p>启动完税文件生成进程，生成txt文件上传至ftp主机</p></li></ol> <h3 id="_6-3-关键配置说明"><a href="#_6-3-关键配置说明" class="header-anchor">#</a> 6.3 关键配置说明</h3> <blockquote><p>acctmanmassetprocesssrcmainjavacomaiaccoretaxtaskTaxCertifyCollectTask.java</p> <p>acctmanmassetprocesssrcmainjavacomaiaccoretaxtaskTaxCertifyFileGenerateTask.java</p></blockquote> <p>工单配置：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> t<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span>rowid <span class="token keyword">from</span> param<span class="token punctuation">.</span>bs_task t <span class="token keyword">where</span> task_code<span class="token operator">=</span> <span class="token string">'TaxCertifyCollectTask;
select t.*,rowid from param.bs_task_channel t where task_code= '</span>TaxCertifyCollectTask<span class="token punctuation">;</span>
<span class="token keyword">select</span> t<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span>rowid <span class="token keyword">from</span> param<span class="token punctuation">.</span>bs_task t <span class="token keyword">where</span> task_code<span class="token operator">=</span> <span class="token string">'TaxCertifyFileGenerateTask'</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> t<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span>rowid <span class="token keyword">from</span> param<span class="token punctuation">.</span>bs_task_channel t <span class="token keyword">where</span> task_code<span class="token operator">=</span> <span class="token string">'TaxCertifyFileGenerateTask'</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="第7章-充值分发"><a href="#第7章-充值分发" class="header-anchor">#</a> 第7章 充值分发</h2> <h3 id="_7-1-基本描述-basic-description"><a href="#_7-1-基本描述-basic-description" class="header-anchor">#</a> 7.1 基本描述-basic description</h3> <h3 id="_7-2-业务流程-business-process"><a href="#_7-2-业务流程-business-process" class="header-anchor">#</a> 7.2 业务流程-business process</h3> <ol><li><p>从参数库获取查询参数</p></li> <li><p>按照分发规则分发数据至分发目的表中</p></li></ol> <h3 id="_7-3-关键配置说明"><a href="#_7-3-关键配置说明" class="header-anchor">#</a> 7.3 关键配置说明</h3> <blockquote><p>acctmanmassetprocesssrcmainjavacomaiaccorepaymenttaskRechargeNotifySplitTask.java</p></blockquote> <p>工单配置：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> t<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span>rowid <span class="token keyword">from</span> param<span class="token punctuation">.</span>bs_task t <span class="token keyword">where</span> task_code<span class="token operator">=</span> <span class="token string">'RechargeNotifySplitTask;

select t.*,rowid from param.bs_task_channel t where task_code= '</span>RechargeNotifySplitTask<span class="token punctuation">;</span>
</code></pre></div><p>参数表：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> param<span class="token punctuation">.</span>bs_sys_profile t <span class="token keyword">where</span> t<span class="token punctuation">.</span>para_type <span class="token operator">=</span><span class="token string">' RECHARGE_NTY_SPLIT'</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="第8章-实时扣费业务回滚"><a href="#第8章-实时扣费业务回滚" class="header-anchor">#</a> 第8章 实时扣费业务回滚</h2> <h3 id="_8-1-基本描述-basic-description"><a href="#_8-1-基本描述-basic-description" class="header-anchor">#</a> 8.1 基本描述-basic description</h3> <p>​		webservice接口扣费失败,回滚</p> <h3 id="_8-2-业务流程"><a href="#_8-2-业务流程" class="header-anchor">#</a> 8.2 业务流程</h3> <ol><li>扣费成功在开启独立事物插入AM_DEDUCT_INBOSS表记录一条数据</li> <li>业务成功删除记录的数据</li> <li>捞取十分钟前的数据,调回退的webservice接口,以保证实物一致</li></ol> <h3 id="_8-3-业务表说明"><a href="#_8-3-业务表说明" class="header-anchor">#</a> 8.3 业务表说明:</h3> <table><thead><tr><th>表名</th> <th>说明</th></tr></thead> <tbody><tr><td>AM_DEDUCT_INBOSS</td> <td>扣费回退记录表</td></tr></tbody></table> <p>关键配置说明:</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">--任务配置 sql中可配置捞取多久以前的</span>
<span class="token keyword">delete</span> <span class="token keyword">from</span> PARAM<span class="token punctuation">.</span>bs_work_order_conf <span class="token keyword">where</span> ORDER_CODE <span class="token operator">=</span> <span class="token string">'PROCESS_INBOSS_REFUND_TASK'</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> PARAM<span class="token punctuation">.</span>BS_WORK_ORDER_CONF <span class="token punctuation">(</span>ORDER_CODE<span class="token punctuation">,</span> ORDER_NAME<span class="token punctuation">,</span> G_SELECT_SQL<span class="token punctuation">,</span> G_UPDATE_SQL<span class="token punctuation">,</span> G_SLEEP_STRATEGY<span class="token punctuation">,</span> G_QUEUE_LENGTH<span class="token punctuation">,</span> S_SERVICE_URI<span class="token punctuation">,</span> S_EXCEPTION_SQL<span class="token punctuation">,</span> CHANNEL_NUMBER<span class="token punctuation">,</span> CHANNEL_FIELD<span class="token punctuation">,</span> CHECK_RULE<span class="token punctuation">,</span> STATE<span class="token punctuation">,</span> EFFECTIVE_DATE<span class="token punctuation">,</span> EXPIRE_DATE<span class="token punctuation">,</span> REGION_ID<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'PROCESS_INBOSS_REFUND_TASK'</span><span class="token punctuation">,</span> <span class="token string">'RollBack'</span><span class="token punctuation">,</span> <span class="token string">'SELECT A.*, A.ROWID  FROM AM_DEDUCT_INBOSS A  WHERE A.PARTITION_ID IN (:TODAY, :YESTERDAY) AND A.STS = 0 AND A.INSERT_DATE &lt; SYSDATE - numtodsinterval(600,''second'')'</span><span class="token punctuation">,</span> <span class="token string">'UPDATE AM_DEDUCT_INBOSS A SET A.STS = ''1'' WHERE A.ROWID = :ROWID'</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token string">'asset_ITaskCSV_inbossRefund'</span><span class="token punctuation">,</span> <span class="token string">'UPDATE AM_DEDUCT_INBOSS A SET A.STS = ''3'' WHERE A.ROWID = :ROWID'</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token string">'ACCT_ID'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'U'</span><span class="token punctuation">,</span> TO_DATE<span class="token punctuation">(</span><span class="token string">'2016-10-01 00:00:00'</span><span class="token punctuation">,</span> <span class="token string">'YYYY-MM-DD HH24:MI:SS'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> TO_DATE<span class="token punctuation">(</span><span class="token string">'2050-12-31 00:00:00'</span><span class="token punctuation">,</span> <span class="token string">'YYYY-MM-DD HH24:MI:SS'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'ZZZZ'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- 八个中心,分八个通道</span>
<span class="token keyword">delete</span> <span class="token keyword">from</span> param<span class="token punctuation">.</span>BS_WORK_ORDER_CHANNEL <span class="token keyword">where</span> PARAM<span class="token punctuation">.</span>BS_WORK_ORDER_CHANNEL<span class="token punctuation">.</span>ORDER_CODE<span class="token operator">=</span><span class="token string">'PROCESS_INBOSS_REFUND_TASK'</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> PARAM<span class="token punctuation">.</span>BS_WORK_ORDER_CHANNEL <span class="token punctuation">(</span>ORDER_CODE<span class="token punctuation">,</span> CHANNEL_NO<span class="token punctuation">,</span> START_ID<span class="token punctuation">,</span> END_ID<span class="token punctuation">,</span> G_DATABASE<span class="token punctuation">,</span> REGION_IDS<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'PROCESS_INBOSS_REFUND_TASK'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'AC1'</span><span class="token punctuation">,</span> <span class="token string">'ZZZZ'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> PARAM<span class="token punctuation">.</span>BS_WORK_ORDER_CHANNEL <span class="token punctuation">(</span>ORDER_CODE<span class="token punctuation">,</span> CHANNEL_NO<span class="token punctuation">,</span> START_ID<span class="token punctuation">,</span> END_ID<span class="token punctuation">,</span> G_DATABASE<span class="token punctuation">,</span> REGION_IDS<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'PROCESS_INBOSS_REFUND_TASK'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'AC2'</span><span class="token punctuation">,</span> <span class="token string">'ZZZZ'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> PARAM<span class="token punctuation">.</span>BS_WORK_ORDER_CHANNEL <span class="token punctuation">(</span>ORDER_CODE<span class="token punctuation">,</span> CHANNEL_NO<span class="token punctuation">,</span> START_ID<span class="token punctuation">,</span> END_ID<span class="token punctuation">,</span> G_DATABASE<span class="token punctuation">,</span> REGION_IDS<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'PROCESS_INBOSS_REFUND_TASK'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'AC3'</span><span class="token punctuation">,</span> <span class="token string">'ZZZZ'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> PARAM<span class="token punctuation">.</span>BS_WORK_ORDER_CHANNEL <span class="token punctuation">(</span>ORDER_CODE<span class="token punctuation">,</span> CHANNEL_NO<span class="token punctuation">,</span> START_ID<span class="token punctuation">,</span> END_ID<span class="token punctuation">,</span> G_DATABASE<span class="token punctuation">,</span> REGION_IDS<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'PROCESS_INBOSS_REFUND_TASK'</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'AC4'</span><span class="token punctuation">,</span> <span class="token string">'ZZZZ'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> PARAM<span class="token punctuation">.</span>BS_WORK_ORDER_CHANNEL <span class="token punctuation">(</span>ORDER_CODE<span class="token punctuation">,</span> CHANNEL_NO<span class="token punctuation">,</span> START_ID<span class="token punctuation">,</span> END_ID<span class="token punctuation">,</span> G_DATABASE<span class="token punctuation">,</span> REGION_IDS<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'PROCESS_INBOSS_REFUND_TASK'</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'AC5'</span><span class="token punctuation">,</span> <span class="token string">'ZZZZ'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> PARAM<span class="token punctuation">.</span>BS_WORK_ORDER_CHANNEL <span class="token punctuation">(</span>ORDER_CODE<span class="token punctuation">,</span> CHANNEL_NO<span class="token punctuation">,</span> START_ID<span class="token punctuation">,</span> END_ID<span class="token punctuation">,</span> G_DATABASE<span class="token punctuation">,</span> REGION_IDS<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'PROCESS_INBOSS_REFUND_TASK'</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'AC6'</span><span class="token punctuation">,</span> <span class="token string">'ZZZZ'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> PARAM<span class="token punctuation">.</span>BS_WORK_ORDER_CHANNEL <span class="token punctuation">(</span>ORDER_CODE<span class="token punctuation">,</span> CHANNEL_NO<span class="token punctuation">,</span> START_ID<span class="token punctuation">,</span> END_ID<span class="token punctuation">,</span> G_DATABASE<span class="token punctuation">,</span> REGION_IDS<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'PROCESS_INBOSS_REFUND_TASK'</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'AC7'</span><span class="token punctuation">,</span> <span class="token string">'ZZZZ'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> PARAM<span class="token punctuation">.</span>BS_WORK_ORDER_CHANNEL <span class="token punctuation">(</span>ORDER_CODE<span class="token punctuation">,</span> CHANNEL_NO<span class="token punctuation">,</span> START_ID<span class="token punctuation">,</span> END_ID<span class="token punctuation">,</span> G_DATABASE<span class="token punctuation">,</span> REGION_IDS<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'PROCESS_INBOSS_REFUND_TASK'</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'AC8'</span><span class="token punctuation">,</span> <span class="token string">'ZZZZ'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="第9章-数据同步进程"><a href="#第9章-数据同步进程" class="header-anchor">#</a> 第9章 数据同步进程</h2> <h3 id="_9-1-基本描述"><a href="#_9-1-基本描述" class="header-anchor">#</a> 9.1 基本描述</h3> <p>​		配置表名,字段,数据源,将表数据同步</p> <h3 id="_9-2-业务流程"><a href="#_9-2-业务流程" class="header-anchor">#</a> 9.2 业务流程</h3> <ol><li>根据源数据源,捞取字段查询数据</li> <li>将数据插入到目标数据源的目标表</li> <li>将源数据删除,搬入历史表</li></ol> <h3 id="_9-3-业务表说明"><a href="#_9-3-业务表说明" class="header-anchor">#</a> 9.3 业务表说明</h3> <table><thead><tr><th>表名</th> <th>说明</th></tr></thead> <tbody><tr><td>DATA_TRANS_TASK_CHANNEL</td> <td>COLUMNS:需要同步的列,<br>源表与目标表字段不一致可以通过AS来保证一致性<br> TABLES:格式,源表名:目标表名,可配置多个表,用逗号隔开<br>示例:<br>CA_ADJ_DATA:CA_ADJ_DATA_0$REGION_CODE$,<br>ca_asset_syn:ca_asset_syn_0$REGION_CODE$_$ACC_MOD$<br>$替换字符$,需要查询的列或者代码有赛值的字段替换,可在COLUMNS配置</td></tr></tbody></table> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- Create table</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> PARAM<span class="token punctuation">.</span>DATA_TRANS_TASK_CHANNEL
<span class="token punctuation">(</span>
    task_code         VARCHAR2<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
    channel_no        VARCHAR2<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>  <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
    <span class="token keyword">columns</span>           VARCHAR2<span class="token punctuation">(</span><span class="token number">2048</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">tables</span>            VARCHAR2<span class="token punctuation">(</span><span class="token number">2048</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    source_Datasource VARCHAR2<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    his_Datasource    VARCHAR2<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    target_Datasource VARCHAR2<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    his_TableName     VARCHAR2<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    sleep             NUMBER<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    process_num             NUMBER<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    order_columns     VARCHAR2<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
    PCTFREE <span class="token number">10</span>
    INITRANS <span class="token number">20</span>
    MAXTRANS <span class="token number">255</span>
    <span class="token keyword">TABLESPACE</span> TBS_PARAM_CFG_DAT_01
<span class="token punctuation">;</span>

<span class="token comment">-- Add comments to the table</span>
<span class="token keyword">comment</span> <span class="token keyword">on</span> <span class="token keyword">table</span> PARAM<span class="token punctuation">.</span>DATA_TRANS_TASK_CHANNEL
    <span class="token operator">is</span> <span class="token string">'数据迁移任务通道参数定义'</span><span class="token punctuation">;</span>
<span class="token comment">-- Add comments to the columns</span>
<span class="token keyword">comment</span> <span class="token keyword">on</span> <span class="token keyword">column</span> PARAM<span class="token punctuation">.</span>DATA_TRANS_TASK_CHANNEL<span class="token punctuation">.</span>task_code
    <span class="token operator">is</span> <span class="token string">'任务编码'</span><span class="token punctuation">;</span>
<span class="token keyword">comment</span> <span class="token keyword">on</span> <span class="token keyword">column</span> PARAM<span class="token punctuation">.</span>DATA_TRANS_TASK_CHANNEL<span class="token punctuation">.</span>channel_no
    <span class="token operator">is</span> <span class="token string">'通道编号'</span><span class="token punctuation">;</span>
<span class="token keyword">comment</span> <span class="token keyword">on</span> <span class="token keyword">column</span> PARAM<span class="token punctuation">.</span>DATA_TRANS_TASK_CHANNEL<span class="token punctuation">.</span><span class="token keyword">columns</span>
    <span class="token operator">is</span> <span class="token string">'源表列 如果列名与目标表列不一致时,需要写as
源表为: ACCESS_NO,REGION_ID
目标表为: ACCESS_NUM,REGION_CODE
需要写成: ACCESS_NO AS ACCESS_NUM,REGION_ID AS REGION_CODE'</span><span class="token punctuation">;</span>
<span class="token keyword">comment</span> <span class="token keyword">on</span> <span class="token keyword">column</span> PARAM<span class="token punctuation">.</span>DATA_TRANS_TASK_CHANNEL<span class="token punctuation">.</span><span class="token keyword">tables</span>
    <span class="token operator">is</span> <span class="token string">'sourceTable:targetTable,sourceTable1:targetTable1'</span><span class="token punctuation">;</span>
<span class="token keyword">comment</span> <span class="token keyword">on</span> <span class="token keyword">column</span> PARAM<span class="token punctuation">.</span>DATA_TRANS_TASK_CHANNEL<span class="token punctuation">.</span>source_Datasource
    <span class="token operator">is</span> <span class="token string">'源表数据源'</span><span class="token punctuation">;</span>
<span class="token keyword">comment</span> <span class="token keyword">on</span> <span class="token keyword">column</span> PARAM<span class="token punctuation">.</span>DATA_TRANS_TASK_CHANNEL<span class="token punctuation">.</span>target_Datasource
    <span class="token operator">is</span> <span class="token string">'目标表数据源'</span><span class="token punctuation">;</span>
<span class="token keyword">comment</span> <span class="token keyword">on</span> <span class="token keyword">column</span> PARAM<span class="token punctuation">.</span>DATA_TRANS_TASK_CHANNEL<span class="token punctuation">.</span>his_Datasource
    <span class="token operator">is</span> <span class="token string">'历史表数据源'</span><span class="token punctuation">;</span>
<span class="token keyword">comment</span> <span class="token keyword">on</span> <span class="token keyword">column</span> PARAM<span class="token punctuation">.</span>DATA_TRANS_TASK_CHANNEL<span class="token punctuation">.</span>sleep
    <span class="token operator">is</span> <span class="token string">'无数据休眠时间'</span><span class="token punctuation">;</span>
<span class="token keyword">comment</span> <span class="token keyword">on</span> <span class="token keyword">column</span> PARAM<span class="token punctuation">.</span>DATA_TRANS_TASK_CHANNEL<span class="token punctuation">.</span>process_num
    <span class="token operator">is</span> <span class="token string">'每个表一次处理数据量'</span><span class="token punctuation">;</span>
<span class="token keyword">comment</span> <span class="token keyword">on</span> <span class="token keyword">column</span> PARAM<span class="token punctuation">.</span>DATA_TRANS_TASK_CHANNEL<span class="token punctuation">.</span>ORDER_COLUMNS
    <span class="token operator">is</span> <span class="token string">'排序字段'</span><span class="token punctuation">;</span>

<span class="token comment">-- Create/Recreate primary, unique and foreign key constraints</span>
<span class="token keyword">alter</span> <span class="token keyword">table</span> PARAM<span class="token punctuation">.</span>DATA_TRANS_TASK_CHANNEL
    <span class="token keyword">add</span> <span class="token keyword">constraint</span> PK_BS_TASK_CHANNEL <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>TASK_CODE<span class="token punctuation">,</span> CHANNEL_NO<span class="token punctuation">)</span>
        <span class="token keyword">using</span> <span class="token keyword">index</span>
            PCTFREE <span class="token number">10</span>
            INITRANS <span class="token number">20</span>
            MAXTRANS <span class="token number">255</span>
            <span class="token keyword">TABLESPACE</span> TBS_PARAM_CFG_IND_01
            NoLogging
<span class="token punctuation">;</span>

</code></pre></div><h3 id="_9-4-关键配置说明"><a href="#_9-4-关键配置说明" class="header-anchor">#</a> 9.4 关键配置说明</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">--调账数据同步</span>
<span class="token keyword">delete</span> <span class="token keyword">from</span> PARAM<span class="token punctuation">.</span>BS_TASK_CHANNEL <span class="token keyword">where</span> TASK_CODE<span class="token operator">=</span><span class="token string">'CaAdjDataTransTask'</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> PARAM<span class="token punctuation">.</span>BS_TASK_CHANNEL <span class="token punctuation">(</span>TASK_CODE<span class="token punctuation">,</span> CHANNEL_NO<span class="token punctuation">,</span> START_ID<span class="token punctuation">,</span> END_ID<span class="token punctuation">,</span> BATCH_NUMBER<span class="token punctuation">,</span> INPUT_PATH<span class="token punctuation">,</span> OUTPUT_PATH<span class="token punctuation">,</span> CENTER_TYPE<span class="token punctuation">,</span> REGION_IDS<span class="token punctuation">,</span> CENTER<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'CaAdjDataTransTask'</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> PARAM<span class="token punctuation">.</span>BS_TASK_CHANNEL <span class="token punctuation">(</span>TASK_CODE<span class="token punctuation">,</span> CHANNEL_NO<span class="token punctuation">,</span> START_ID<span class="token punctuation">,</span> END_ID<span class="token punctuation">,</span> BATCH_NUMBER<span class="token punctuation">,</span> INPUT_PATH<span class="token punctuation">,</span> OUTPUT_PATH<span class="token punctuation">,</span> CENTER_TYPE<span class="token punctuation">,</span> REGION_IDS<span class="token punctuation">,</span> CENTER<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'CaAdjDataTransTask'</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> PARAM<span class="token punctuation">.</span>BS_TASK_CHANNEL <span class="token punctuation">(</span>TASK_CODE<span class="token punctuation">,</span> CHANNEL_NO<span class="token punctuation">,</span> START_ID<span class="token punctuation">,</span> END_ID<span class="token punctuation">,</span> BATCH_NUMBER<span class="token punctuation">,</span> INPUT_PATH<span class="token punctuation">,</span> OUTPUT_PATH<span class="token punctuation">,</span> CENTER_TYPE<span class="token punctuation">,</span> REGION_IDS<span class="token punctuation">,</span> CENTER<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'CaAdjDataTransTask'</span><span class="token punctuation">,</span> <span class="token string">'3'</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token string">'3'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> PARAM<span class="token punctuation">.</span>BS_TASK_CHANNEL <span class="token punctuation">(</span>TASK_CODE<span class="token punctuation">,</span> CHANNEL_NO<span class="token punctuation">,</span> START_ID<span class="token punctuation">,</span> END_ID<span class="token punctuation">,</span> BATCH_NUMBER<span class="token punctuation">,</span> INPUT_PATH<span class="token punctuation">,</span> OUTPUT_PATH<span class="token punctuation">,</span> CENTER_TYPE<span class="token punctuation">,</span> REGION_IDS<span class="token punctuation">,</span> CENTER<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'CaAdjDataTransTask'</span><span class="token punctuation">,</span> <span class="token string">'4'</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token string">'4'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> PARAM<span class="token punctuation">.</span>BS_TASK_CHANNEL <span class="token punctuation">(</span>TASK_CODE<span class="token punctuation">,</span> CHANNEL_NO<span class="token punctuation">,</span> START_ID<span class="token punctuation">,</span> END_ID<span class="token punctuation">,</span> BATCH_NUMBER<span class="token punctuation">,</span> INPUT_PATH<span class="token punctuation">,</span> OUTPUT_PATH<span class="token punctuation">,</span> CENTER_TYPE<span class="token punctuation">,</span> REGION_IDS<span class="token punctuation">,</span> CENTER<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'CaAdjDataTransTask'</span><span class="token punctuation">,</span> <span class="token string">'5'</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token string">'5'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> PARAM<span class="token punctuation">.</span>BS_TASK_CHANNEL <span class="token punctuation">(</span>TASK_CODE<span class="token punctuation">,</span> CHANNEL_NO<span class="token punctuation">,</span> START_ID<span class="token punctuation">,</span> END_ID<span class="token punctuation">,</span> BATCH_NUMBER<span class="token punctuation">,</span> INPUT_PATH<span class="token punctuation">,</span> OUTPUT_PATH<span class="token punctuation">,</span> CENTER_TYPE<span class="token punctuation">,</span> REGION_IDS<span class="token punctuation">,</span> CENTER<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'CaAdjDataTransTask'</span><span class="token punctuation">,</span> <span class="token string">'6'</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token string">'6'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> PARAM<span class="token punctuation">.</span>BS_TASK_CHANNEL <span class="token punctuation">(</span>TASK_CODE<span class="token punctuation">,</span> CHANNEL_NO<span class="token punctuation">,</span> START_ID<span class="token punctuation">,</span> END_ID<span class="token punctuation">,</span> BATCH_NUMBER<span class="token punctuation">,</span> INPUT_PATH<span class="token punctuation">,</span> OUTPUT_PATH<span class="token punctuation">,</span> CENTER_TYPE<span class="token punctuation">,</span> REGION_IDS<span class="token punctuation">,</span> CENTER<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'CaAdjDataTransTask'</span><span class="token punctuation">,</span> <span class="token string">'7'</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token string">'7'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> PARAM<span class="token punctuation">.</span>BS_TASK_CHANNEL <span class="token punctuation">(</span>TASK_CODE<span class="token punctuation">,</span> CHANNEL_NO<span class="token punctuation">,</span> START_ID<span class="token punctuation">,</span> END_ID<span class="token punctuation">,</span> BATCH_NUMBER<span class="token punctuation">,</span> INPUT_PATH<span class="token punctuation">,</span> OUTPUT_PATH<span class="token punctuation">,</span> CENTER_TYPE<span class="token punctuation">,</span> REGION_IDS<span class="token punctuation">,</span> CENTER<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'CaAdjDataTransTask'</span><span class="token punctuation">,</span> <span class="token string">'8'</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token string">'8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">delete</span> <span class="token keyword">from</span> PARAM<span class="token punctuation">.</span>DATA_TRANS_TASK_CHANNEL <span class="token keyword">where</span> TASK_CODE<span class="token operator">=</span><span class="token string">'CaAdjDataTransTask'</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> PARAM<span class="token punctuation">.</span>DATA_TRANS_TASK_CHANNEL <span class="token punctuation">(</span>TASK_CODE<span class="token punctuation">,</span> CHANNEL_NO<span class="token punctuation">,</span> <span class="token keyword">COLUMNS</span><span class="token punctuation">,</span> <span class="token keyword">TABLES</span><span class="token punctuation">,</span> SOURCE_DATASOURCE<span class="token punctuation">,</span> HIS_DATASOURCE<span class="token punctuation">,</span> TARGET_DATASOURCE<span class="token punctuation">,</span> HIS_TABLENAME<span class="token punctuation">,</span> SLEEP<span class="token punctuation">,</span> PROCESS_NUM<span class="token punctuation">,</span> ORDER_COLUMNS<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'CaAdjDataTransTask'</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'SERIAL_ID,PARTITION_ID,RESOURCE_ID,ACCT_ID,PAY_ACCT_ID,USER_TYPE,CHARGE_DATE,BILL_BEGIN_DATE,BILL_END_DATE,DEDUCT_TIME,OPERATIOIN_TIME,BILLING_PLAN_ID,PRODUCT_OFFER_ID,MEASURE_ID,BILL_FEE,ITEM_CODE,BILLING_TYPE,INCLUDE_TAX_FLAG,OWNER_TYPE,IS_REAL,BILL_FLAG,STS,STS_DATE,RESULT,USER_LIFE_CYCLE,BRAND,REGION_CODE,PHONE_CODE,GEN_DATE,TOPUP_NUMBER,SO_NBR,BUSI_CODE,REMARKS,TENANT_ID'</span><span class="token punctuation">,</span> <span class="token string">'CA_ADJ_DATA:CA_ADJ_DATA_0$REGION_CODE$'</span><span class="token punctuation">,</span> <span class="token string">'AC1'</span><span class="token punctuation">,</span> <span class="token string">'AC1'</span><span class="token punctuation">,</span> <span class="token string">'AD'</span><span class="token punctuation">,</span> <span class="token string">'CA_ADJ_DATA_H'</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token string">'SERIAL_ID'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> PARAM<span class="token punctuation">.</span>DATA_TRANS_TASK_CHANNEL <span class="token punctuation">(</span>TASK_CODE<span class="token punctuation">,</span> CHANNEL_NO<span class="token punctuation">,</span> <span class="token keyword">COLUMNS</span><span class="token punctuation">,</span> <span class="token keyword">TABLES</span><span class="token punctuation">,</span> SOURCE_DATASOURCE<span class="token punctuation">,</span> HIS_DATASOURCE<span class="token punctuation">,</span> TARGET_DATASOURCE<span class="token punctuation">,</span> HIS_TABLENAME<span class="token punctuation">,</span> SLEEP<span class="token punctuation">,</span> PROCESS_NUM<span class="token punctuation">,</span> ORDER_COLUMNS<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'CaAdjDataTransTask'</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token string">'SERIAL_ID,PARTITION_ID,RESOURCE_ID,ACCT_ID,PAY_ACCT_ID,USER_TYPE,CHARGE_DATE,BILL_BEGIN_DATE,BILL_END_DATE,DEDUCT_TIME,OPERATIOIN_TIME,BILLING_PLAN_ID,PRODUCT_OFFER_ID,MEASURE_ID,BILL_FEE,ITEM_CODE,BILLING_TYPE,INCLUDE_TAX_FLAG,OWNER_TYPE,IS_REAL,BILL_FLAG,STS,STS_DATE,RESULT,USER_LIFE_CYCLE,BRAND,REGION_CODE,PHONE_CODE,GEN_DATE,TOPUP_NUMBER,SO_NBR,BUSI_CODE,REMARKS,TENANT_ID'</span><span class="token punctuation">,</span> <span class="token string">'CA_ADJ_DATA:CA_ADJ_DATA_0$REGION_CODE$'</span><span class="token punctuation">,</span> <span class="token string">'AC2'</span><span class="token punctuation">,</span> <span class="token string">'AC2'</span><span class="token punctuation">,</span> <span class="token string">'AD'</span><span class="token punctuation">,</span> <span class="token string">'CA_ADJ_DATA_H'</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token string">'SERIAL_ID'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> PARAM<span class="token punctuation">.</span>DATA_TRANS_TASK_CHANNEL <span class="token punctuation">(</span>TASK_CODE<span class="token punctuation">,</span> CHANNEL_NO<span class="token punctuation">,</span> <span class="token keyword">COLUMNS</span><span class="token punctuation">,</span> <span class="token keyword">TABLES</span><span class="token punctuation">,</span> SOURCE_DATASOURCE<span class="token punctuation">,</span> HIS_DATASOURCE<span class="token punctuation">,</span> TARGET_DATASOURCE<span class="token punctuation">,</span> HIS_TABLENAME<span class="token punctuation">,</span> SLEEP<span class="token punctuation">,</span> PROCESS_NUM<span class="token punctuation">,</span> ORDER_COLUMNS<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'CaAdjDataTransTask'</span><span class="token punctuation">,</span> <span class="token string">'3'</span><span class="token punctuation">,</span> <span class="token string">'SERIAL_ID,PARTITION_ID,RESOURCE_ID,ACCT_ID,PAY_ACCT_ID,USER_TYPE,CHARGE_DATE,BILL_BEGIN_DATE,BILL_END_DATE,DEDUCT_TIME,OPERATIOIN_TIME,BILLING_PLAN_ID,PRODUCT_OFFER_ID,MEASURE_ID,BILL_FEE,ITEM_CODE,BILLING_TYPE,INCLUDE_TAX_FLAG,OWNER_TYPE,IS_REAL,BILL_FLAG,STS,STS_DATE,RESULT,USER_LIFE_CYCLE,BRAND,REGION_CODE,PHONE_CODE,GEN_DATE,TOPUP_NUMBER,SO_NBR,BUSI_CODE,REMARKS,TENANT_ID'</span><span class="token punctuation">,</span> <span class="token string">'CA_ADJ_DATA:CA_ADJ_DATA_0$REGION_CODE$'</span><span class="token punctuation">,</span> <span class="token string">'AC3'</span><span class="token punctuation">,</span> <span class="token string">'AC3'</span><span class="token punctuation">,</span> <span class="token string">'AD'</span><span class="token punctuation">,</span> <span class="token string">'CA_ADJ_DATA_H'</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token string">'SERIAL_ID'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> PARAM<span class="token punctuation">.</span>DATA_TRANS_TASK_CHANNEL <span class="token punctuation">(</span>TASK_CODE<span class="token punctuation">,</span> CHANNEL_NO<span class="token punctuation">,</span> <span class="token keyword">COLUMNS</span><span class="token punctuation">,</span> <span class="token keyword">TABLES</span><span class="token punctuation">,</span> SOURCE_DATASOURCE<span class="token punctuation">,</span> HIS_DATASOURCE<span class="token punctuation">,</span> TARGET_DATASOURCE<span class="token punctuation">,</span> HIS_TABLENAME<span class="token punctuation">,</span> SLEEP<span class="token punctuation">,</span> PROCESS_NUM<span class="token punctuation">,</span> ORDER_COLUMNS<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'CaAdjDataTransTask'</span><span class="token punctuation">,</span> <span class="token string">'4'</span><span class="token punctuation">,</span> <span class="token string">'SERIAL_ID,PARTITION_ID,RESOURCE_ID,ACCT_ID,PAY_ACCT_ID,USER_TYPE,CHARGE_DATE,BILL_BEGIN_DATE,BILL_END_DATE,DEDUCT_TIME,OPERATIOIN_TIME,BILLING_PLAN_ID,PRODUCT_OFFER_ID,MEASURE_ID,BILL_FEE,ITEM_CODE,BILLING_TYPE,INCLUDE_TAX_FLAG,OWNER_TYPE,IS_REAL,BILL_FLAG,STS,STS_DATE,RESULT,USER_LIFE_CYCLE,BRAND,REGION_CODE,PHONE_CODE,GEN_DATE,TOPUP_NUMBER,SO_NBR,BUSI_CODE,REMARKS,TENANT_ID'</span><span class="token punctuation">,</span> <span class="token string">'CA_ADJ_DATA:CA_ADJ_DATA_0$REGION_CODE$'</span><span class="token punctuation">,</span> <span class="token string">'AC4'</span><span class="token punctuation">,</span> <span class="token string">'AC4'</span><span class="token punctuation">,</span> <span class="token string">'AD'</span><span class="token punctuation">,</span> <span class="token string">'CA_ADJ_DATA_H'</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token string">'SERIAL_ID'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> PARAM<span class="token punctuation">.</span>DATA_TRANS_TASK_CHANNEL <span class="token punctuation">(</span>TASK_CODE<span class="token punctuation">,</span> CHANNEL_NO<span class="token punctuation">,</span> <span class="token keyword">COLUMNS</span><span class="token punctuation">,</span> <span class="token keyword">TABLES</span><span class="token punctuation">,</span> SOURCE_DATASOURCE<span class="token punctuation">,</span> HIS_DATASOURCE<span class="token punctuation">,</span> TARGET_DATASOURCE<span class="token punctuation">,</span> HIS_TABLENAME<span class="token punctuation">,</span> SLEEP<span class="token punctuation">,</span> PROCESS_NUM<span class="token punctuation">,</span> ORDER_COLUMNS<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'CaAdjDataTransTask'</span><span class="token punctuation">,</span> <span class="token string">'5'</span><span class="token punctuation">,</span> <span class="token string">'SERIAL_ID,PARTITION_ID,RESOURCE_ID,ACCT_ID,PAY_ACCT_ID,USER_TYPE,CHARGE_DATE,BILL_BEGIN_DATE,BILL_END_DATE,DEDUCT_TIME,OPERATIOIN_TIME,BILLING_PLAN_ID,PRODUCT_OFFER_ID,MEASURE_ID,BILL_FEE,ITEM_CODE,BILLING_TYPE,INCLUDE_TAX_FLAG,OWNER_TYPE,IS_REAL,BILL_FLAG,STS,STS_DATE,RESULT,USER_LIFE_CYCLE,BRAND,REGION_CODE,PHONE_CODE,GEN_DATE,TOPUP_NUMBER,SO_NBR,BUSI_CODE,REMARKS,TENANT_ID'</span><span class="token punctuation">,</span> <span class="token string">'CA_ADJ_DATA:CA_ADJ_DATA_0$REGION_CODE$'</span><span class="token punctuation">,</span> <span class="token string">'AC5'</span><span class="token punctuation">,</span> <span class="token string">'AC5'</span><span class="token punctuation">,</span> <span class="token string">'AD'</span><span class="token punctuation">,</span> <span class="token string">'CA_ADJ_DATA_H'</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token string">'SERIAL_ID'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> PARAM<span class="token punctuation">.</span>DATA_TRANS_TASK_CHANNEL <span class="token punctuation">(</span>TASK_CODE<span class="token punctuation">,</span> CHANNEL_NO<span class="token punctuation">,</span> <span class="token keyword">COLUMNS</span><span class="token punctuation">,</span> <span class="token keyword">TABLES</span><span class="token punctuation">,</span> SOURCE_DATASOURCE<span class="token punctuation">,</span> HIS_DATASOURCE<span class="token punctuation">,</span> TARGET_DATASOURCE<span class="token punctuation">,</span> HIS_TABLENAME<span class="token punctuation">,</span> SLEEP<span class="token punctuation">,</span> PROCESS_NUM<span class="token punctuation">,</span> ORDER_COLUMNS<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'CaAdjDataTransTask'</span><span class="token punctuation">,</span> <span class="token string">'6'</span><span class="token punctuation">,</span> <span class="token string">'SERIAL_ID,PARTITION_ID,RESOURCE_ID,ACCT_ID,PAY_ACCT_ID,USER_TYPE,CHARGE_DATE,BILL_BEGIN_DATE,BILL_END_DATE,DEDUCT_TIME,OPERATIOIN_TIME,BILLING_PLAN_ID,PRODUCT_OFFER_ID,MEASURE_ID,BILL_FEE,ITEM_CODE,BILLING_TYPE,INCLUDE_TAX_FLAG,OWNER_TYPE,IS_REAL,BILL_FLAG,STS,STS_DATE,RESULT,USER_LIFE_CYCLE,BRAND,REGION_CODE,PHONE_CODE,GEN_DATE,TOPUP_NUMBER,SO_NBR,BUSI_CODE,REMARKS,TENANT_ID'</span><span class="token punctuation">,</span> <span class="token string">'CA_ADJ_DATA:CA_ADJ_DATA_0$REGION_CODE$'</span><span class="token punctuation">,</span> <span class="token string">'AC6'</span><span class="token punctuation">,</span> <span class="token string">'AC6'</span><span class="token punctuation">,</span> <span class="token string">'AD'</span><span class="token punctuation">,</span> <span class="token string">'CA_ADJ_DATA_H'</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token string">'SERIAL_ID'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> PARAM<span class="token punctuation">.</span>DATA_TRANS_TASK_CHANNEL <span class="token punctuation">(</span>TASK_CODE<span class="token punctuation">,</span> CHANNEL_NO<span class="token punctuation">,</span> <span class="token keyword">COLUMNS</span><span class="token punctuation">,</span> <span class="token keyword">TABLES</span><span class="token punctuation">,</span> SOURCE_DATASOURCE<span class="token punctuation">,</span> HIS_DATASOURCE<span class="token punctuation">,</span> TARGET_DATASOURCE<span class="token punctuation">,</span> HIS_TABLENAME<span class="token punctuation">,</span> SLEEP<span class="token punctuation">,</span> PROCESS_NUM<span class="token punctuation">,</span> ORDER_COLUMNS<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'CaAdjDataTransTask'</span><span class="token punctuation">,</span> <span class="token string">'7'</span><span class="token punctuation">,</span> <span class="token string">'SERIAL_ID,PARTITION_ID,RESOURCE_ID,ACCT_ID,PAY_ACCT_ID,USER_TYPE,CHARGE_DATE,BILL_BEGIN_DATE,BILL_END_DATE,DEDUCT_TIME,OPERATIOIN_TIME,BILLING_PLAN_ID,PRODUCT_OFFER_ID,MEASURE_ID,BILL_FEE,ITEM_CODE,BILLING_TYPE,INCLUDE_TAX_FLAG,OWNER_TYPE,IS_REAL,BILL_FLAG,STS,STS_DATE,RESULT,USER_LIFE_CYCLE,BRAND,REGION_CODE,PHONE_CODE,GEN_DATE,TOPUP_NUMBER,SO_NBR,BUSI_CODE,REMARKS,TENANT_ID'</span><span class="token punctuation">,</span> <span class="token string">'CA_ADJ_DATA:CA_ADJ_DATA_0$REGION_CODE$'</span><span class="token punctuation">,</span> <span class="token string">'AC7'</span><span class="token punctuation">,</span> <span class="token string">'AC7'</span><span class="token punctuation">,</span> <span class="token string">'AD'</span><span class="token punctuation">,</span> <span class="token string">'CA_ADJ_DATA_H'</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token string">'SERIAL_ID'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> PARAM<span class="token punctuation">.</span>DATA_TRANS_TASK_CHANNEL <span class="token punctuation">(</span>TASK_CODE<span class="token punctuation">,</span> CHANNEL_NO<span class="token punctuation">,</span> <span class="token keyword">COLUMNS</span><span class="token punctuation">,</span> <span class="token keyword">TABLES</span><span class="token punctuation">,</span> SOURCE_DATASOURCE<span class="token punctuation">,</span> HIS_DATASOURCE<span class="token punctuation">,</span> TARGET_DATASOURCE<span class="token punctuation">,</span> HIS_TABLENAME<span class="token punctuation">,</span> SLEEP<span class="token punctuation">,</span> PROCESS_NUM<span class="token punctuation">,</span> ORDER_COLUMNS<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'CaAdjDataTransTask'</span><span class="token punctuation">,</span> <span class="token string">'8'</span><span class="token punctuation">,</span> <span class="token string">'SERIAL_ID,PARTITION_ID,RESOURCE_ID,ACCT_ID,PAY_ACCT_ID,USER_TYPE,CHARGE_DATE,BILL_BEGIN_DATE,BILL_END_DATE,DEDUCT_TIME,OPERATIOIN_TIME,BILLING_PLAN_ID,PRODUCT_OFFER_ID,MEASURE_ID,BILL_FEE,ITEM_CODE,BILLING_TYPE,INCLUDE_TAX_FLAG,OWNER_TYPE,IS_REAL,BILL_FLAG,STS,STS_DATE,RESULT,USER_LIFE_CYCLE,BRAND,REGION_CODE,PHONE_CODE,GEN_DATE,TOPUP_NUMBER,SO_NBR,BUSI_CODE,REMARKS,TENANT_ID'</span><span class="token punctuation">,</span> <span class="token string">'CA_ADJ_DATA:CA_ADJ_DATA_0$REGION_CODE$'</span><span class="token punctuation">,</span> <span class="token string">'AC8'</span><span class="token punctuation">,</span> <span class="token string">'AC8'</span><span class="token punctuation">,</span> <span class="token string">'AD'</span><span class="token punctuation">,</span> <span class="token string">'CA_ADJ_DATA_H'</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token string">'SERIAL_ID'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">--资产上发同步</span>
<span class="token keyword">delete</span> <span class="token keyword">from</span> PARAM<span class="token punctuation">.</span>BS_TASK_CHANNEL <span class="token keyword">where</span> TASK_CODE<span class="token operator">=</span><span class="token string">'CaAssetSynDataTransTask'</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> PARAM<span class="token punctuation">.</span>BS_TASK_CHANNEL <span class="token punctuation">(</span>TASK_CODE<span class="token punctuation">,</span> CHANNEL_NO<span class="token punctuation">,</span> START_ID<span class="token punctuation">,</span> END_ID<span class="token punctuation">,</span> BATCH_NUMBER<span class="token punctuation">,</span> INPUT_PATH<span class="token punctuation">,</span> OUTPUT_PATH<span class="token punctuation">,</span> CENTER_TYPE<span class="token punctuation">,</span> REGION_IDS<span class="token punctuation">,</span> CENTER<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'CaAssetSynDataTransTask'</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> PARAM<span class="token punctuation">.</span>BS_TASK_CHANNEL <span class="token punctuation">(</span>TASK_CODE<span class="token punctuation">,</span> CHANNEL_NO<span class="token punctuation">,</span> START_ID<span class="token punctuation">,</span> END_ID<span class="token punctuation">,</span> BATCH_NUMBER<span class="token punctuation">,</span> INPUT_PATH<span class="token punctuation">,</span> OUTPUT_PATH<span class="token punctuation">,</span> CENTER_TYPE<span class="token punctuation">,</span> REGION_IDS<span class="token punctuation">,</span> CENTER<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'CaAssetSynDataTransTask'</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> PARAM<span class="token punctuation">.</span>BS_TASK_CHANNEL <span class="token punctuation">(</span>TASK_CODE<span class="token punctuation">,</span> CHANNEL_NO<span class="token punctuation">,</span> START_ID<span class="token punctuation">,</span> END_ID<span class="token punctuation">,</span> BATCH_NUMBER<span class="token punctuation">,</span> INPUT_PATH<span class="token punctuation">,</span> OUTPUT_PATH<span class="token punctuation">,</span> CENTER_TYPE<span class="token punctuation">,</span> REGION_IDS<span class="token punctuation">,</span> CENTER<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'CaAssetSynDataTransTask'</span><span class="token punctuation">,</span> <span class="token string">'3'</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token string">'3'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> PARAM<span class="token punctuation">.</span>BS_TASK_CHANNEL <span class="token punctuation">(</span>TASK_CODE<span class="token punctuation">,</span> CHANNEL_NO<span class="token punctuation">,</span> START_ID<span class="token punctuation">,</span> END_ID<span class="token punctuation">,</span> BATCH_NUMBER<span class="token punctuation">,</span> INPUT_PATH<span class="token punctuation">,</span> OUTPUT_PATH<span class="token punctuation">,</span> CENTER_TYPE<span class="token punctuation">,</span> REGION_IDS<span class="token punctuation">,</span> CENTER<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'CaAssetSynDataTransTask'</span><span class="token punctuation">,</span> <span class="token string">'4'</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token string">'4'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> PARAM<span class="token punctuation">.</span>BS_TASK_CHANNEL <span class="token punctuation">(</span>TASK_CODE<span class="token punctuation">,</span> CHANNEL_NO<span class="token punctuation">,</span> START_ID<span class="token punctuation">,</span> END_ID<span class="token punctuation">,</span> BATCH_NUMBER<span class="token punctuation">,</span> INPUT_PATH<span class="token punctuation">,</span> OUTPUT_PATH<span class="token punctuation">,</span> CENTER_TYPE<span class="token punctuation">,</span> REGION_IDS<span class="token punctuation">,</span> CENTER<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'CaAssetSynDataTransTask'</span><span class="token punctuation">,</span> <span class="token string">'5'</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token string">'5'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> PARAM<span class="token punctuation">.</span>BS_TASK_CHANNEL <span class="token punctuation">(</span>TASK_CODE<span class="token punctuation">,</span> CHANNEL_NO<span class="token punctuation">,</span> START_ID<span class="token punctuation">,</span> END_ID<span class="token punctuation">,</span> BATCH_NUMBER<span class="token punctuation">,</span> INPUT_PATH<span class="token punctuation">,</span> OUTPUT_PATH<span class="token punctuation">,</span> CENTER_TYPE<span class="token punctuation">,</span> REGION_IDS<span class="token punctuation">,</span> CENTER<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'CaAssetSynDataTransTask'</span><span class="token punctuation">,</span> <span class="token string">'6'</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token string">'6'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> PARAM<span class="token punctuation">.</span>BS_TASK_CHANNEL <span class="token punctuation">(</span>TASK_CODE<span class="token punctuation">,</span> CHANNEL_NO<span class="token punctuation">,</span> START_ID<span class="token punctuation">,</span> END_ID<span class="token punctuation">,</span> BATCH_NUMBER<span class="token punctuation">,</span> INPUT_PATH<span class="token punctuation">,</span> OUTPUT_PATH<span class="token punctuation">,</span> CENTER_TYPE<span class="token punctuation">,</span> REGION_IDS<span class="token punctuation">,</span> CENTER<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'CaAssetSynDataTransTask'</span><span class="token punctuation">,</span> <span class="token string">'7'</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token string">'7'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> PARAM<span class="token punctuation">.</span>BS_TASK_CHANNEL <span class="token punctuation">(</span>TASK_CODE<span class="token punctuation">,</span> CHANNEL_NO<span class="token punctuation">,</span> START_ID<span class="token punctuation">,</span> END_ID<span class="token punctuation">,</span> BATCH_NUMBER<span class="token punctuation">,</span> INPUT_PATH<span class="token punctuation">,</span> OUTPUT_PATH<span class="token punctuation">,</span> CENTER_TYPE<span class="token punctuation">,</span> REGION_IDS<span class="token punctuation">,</span> CENTER<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'CaAssetSynDataTransTask'</span><span class="token punctuation">,</span> <span class="token string">'8'</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token string">'8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">delete</span> <span class="token keyword">from</span> PARAM<span class="token punctuation">.</span>DATA_TRANS_TASK_CHANNEL <span class="token keyword">where</span> TASK_CODE<span class="token operator">=</span><span class="token string">'CaAssetSynDataTransTask'</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> PARAM<span class="token punctuation">.</span>DATA_TRANS_TASK_CHANNEL <span class="token punctuation">(</span>TASK_CODE<span class="token punctuation">,</span> CHANNEL_NO<span class="token punctuation">,</span> <span class="token keyword">COLUMNS</span><span class="token punctuation">,</span> <span class="token keyword">TABLES</span><span class="token punctuation">,</span> SOURCE_DATASOURCE<span class="token punctuation">,</span> HIS_DATASOURCE<span class="token punctuation">,</span> TARGET_DATASOURCE<span class="token punctuation">,</span> HIS_TABLENAME<span class="token punctuation">,</span> SLEEP<span class="token punctuation">,</span> PROCESS_NUM<span class="token punctuation">,</span> ORDER_COLUMNS<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'CaAssetSynDataTransTask'</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'SYN_ID,PARTITION_ID,ASSET_ID,SYN_TYPE,ACCT_ID,ASSET_TYPE,ASSET_ITEM,ASSET_AMOUNT,BILL_FEE,SYNC_FLAG,NOTIFY_FLAG,SYNC_TYPE,VALID_DATE,EXPIRE_DATE,CREATE_DATE,STS,STS_DATE,SO_NBR,SO_DATE,REMARK,TENANT_ID,REGION_CODE,BILLING_TYPE,DEAL_AMOUNT,NEW_BILL_FEE,OLD_BILL_FEE,MOD(ACCT_ID,4) AS ACC_MOD'</span><span class="token punctuation">,</span> <span class="token string">'ca_asset_syn:ca_asset_syn_0$REGION_CODE$_$ACC_MOD$'</span><span class="token punctuation">,</span> <span class="token string">'AC1'</span><span class="token punctuation">,</span> <span class="token string">'AC1'</span><span class="token punctuation">,</span> <span class="token string">'AD'</span><span class="token punctuation">,</span> <span class="token string">'ca_asset_syn_h'</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token string">'SYN_ID'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> PARAM<span class="token punctuation">.</span>DATA_TRANS_TASK_CHANNEL <span class="token punctuation">(</span>TASK_CODE<span class="token punctuation">,</span> CHANNEL_NO<span class="token punctuation">,</span> <span class="token keyword">COLUMNS</span><span class="token punctuation">,</span> <span class="token keyword">TABLES</span><span class="token punctuation">,</span> SOURCE_DATASOURCE<span class="token punctuation">,</span> HIS_DATASOURCE<span class="token punctuation">,</span> TARGET_DATASOURCE<span class="token punctuation">,</span> HIS_TABLENAME<span class="token punctuation">,</span> SLEEP<span class="token punctuation">,</span> PROCESS_NUM<span class="token punctuation">,</span> ORDER_COLUMNS<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'CaAssetSynDataTransTask'</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token string">'SYN_ID,PARTITION_ID,ASSET_ID,SYN_TYPE,ACCT_ID,ASSET_TYPE,ASSET_ITEM,ASSET_AMOUNT,BILL_FEE,SYNC_FLAG,NOTIFY_FLAG,SYNC_TYPE,VALID_DATE,EXPIRE_DATE,CREATE_DATE,STS,STS_DATE,SO_NBR,SO_DATE,REMARK,TENANT_ID,REGION_CODE,BILLING_TYPE,DEAL_AMOUNT,NEW_BILL_FEE,OLD_BILL_FEE,MOD(ACCT_ID,4) AS ACC_MOD'</span><span class="token punctuation">,</span> <span class="token string">'ca_asset_syn:ca_asset_syn_0$REGION_CODE$_$ACC_MOD$'</span><span class="token punctuation">,</span> <span class="token string">'AC2'</span><span class="token punctuation">,</span> <span class="token string">'AC2'</span><span class="token punctuation">,</span> <span class="token string">'AD'</span><span class="token punctuation">,</span> <span class="token string">'ca_asset_syn_h'</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token string">'SYN_ID'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> PARAM<span class="token punctuation">.</span>DATA_TRANS_TASK_CHANNEL <span class="token punctuation">(</span>TASK_CODE<span class="token punctuation">,</span> CHANNEL_NO<span class="token punctuation">,</span> <span class="token keyword">COLUMNS</span><span class="token punctuation">,</span> <span class="token keyword">TABLES</span><span class="token punctuation">,</span> SOURCE_DATASOURCE<span class="token punctuation">,</span> HIS_DATASOURCE<span class="token punctuation">,</span> TARGET_DATASOURCE<span class="token punctuation">,</span> HIS_TABLENAME<span class="token punctuation">,</span> SLEEP<span class="token punctuation">,</span> PROCESS_NUM<span class="token punctuation">,</span> ORDER_COLUMNS<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'CaAssetSynDataTransTask'</span><span class="token punctuation">,</span> <span class="token string">'3'</span><span class="token punctuation">,</span> <span class="token string">'SYN_ID,PARTITION_ID,ASSET_ID,SYN_TYPE,ACCT_ID,ASSET_TYPE,ASSET_ITEM,ASSET_AMOUNT,BILL_FEE,SYNC_FLAG,NOTIFY_FLAG,SYNC_TYPE,VALID_DATE,EXPIRE_DATE,CREATE_DATE,STS,STS_DATE,SO_NBR,SO_DATE,REMARK,TENANT_ID,REGION_CODE,BILLING_TYPE,DEAL_AMOUNT,NEW_BILL_FEE,OLD_BILL_FEE,MOD(ACCT_ID,4) AS ACC_MOD'</span><span class="token punctuation">,</span> <span class="token string">'ca_asset_syn:ca_asset_syn_0$REGION_CODE$_$ACC_MOD$'</span><span class="token punctuation">,</span> <span class="token string">'AC3'</span><span class="token punctuation">,</span> <span class="token string">'AC3'</span><span class="token punctuation">,</span> <span class="token string">'AD'</span><span class="token punctuation">,</span> <span class="token string">'ca_asset_syn_h'</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token string">'SYN_ID'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> PARAM<span class="token punctuation">.</span>DATA_TRANS_TASK_CHANNEL <span class="token punctuation">(</span>TASK_CODE<span class="token punctuation">,</span> CHANNEL_NO<span class="token punctuation">,</span> <span class="token keyword">COLUMNS</span><span class="token punctuation">,</span> <span class="token keyword">TABLES</span><span class="token punctuation">,</span> SOURCE_DATASOURCE<span class="token punctuation">,</span> HIS_DATASOURCE<span class="token punctuation">,</span> TARGET_DATASOURCE<span class="token punctuation">,</span> HIS_TABLENAME<span class="token punctuation">,</span> SLEEP<span class="token punctuation">,</span> PROCESS_NUM<span class="token punctuation">,</span> ORDER_COLUMNS<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'CaAssetSynDataTransTask'</span><span class="token punctuation">,</span> <span class="token string">'4'</span><span class="token punctuation">,</span> <span class="token string">'SYN_ID,PARTITION_ID,ASSET_ID,SYN_TYPE,ACCT_ID,ASSET_TYPE,ASSET_ITEM,ASSET_AMOUNT,BILL_FEE,SYNC_FLAG,NOTIFY_FLAG,SYNC_TYPE,VALID_DATE,EXPIRE_DATE,CREATE_DATE,STS,STS_DATE,SO_NBR,SO_DATE,REMARK,TENANT_ID,REGION_CODE,BILLING_TYPE,DEAL_AMOUNT,NEW_BILL_FEE,OLD_BILL_FEE,MOD(ACCT_ID,4) AS ACC_MOD'</span><span class="token punctuation">,</span> <span class="token string">'ca_asset_syn:ca_asset_syn_0$REGION_CODE$_$ACC_MOD$'</span><span class="token punctuation">,</span> <span class="token string">'AC4'</span><span class="token punctuation">,</span> <span class="token string">'AC4'</span><span class="token punctuation">,</span> <span class="token string">'AD'</span><span class="token punctuation">,</span> <span class="token string">'ca_asset_syn_h'</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token string">'SYN_ID'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> PARAM<span class="token punctuation">.</span>DATA_TRANS_TASK_CHANNEL <span class="token punctuation">(</span>TASK_CODE<span class="token punctuation">,</span> CHANNEL_NO<span class="token punctuation">,</span> <span class="token keyword">COLUMNS</span><span class="token punctuation">,</span> <span class="token keyword">TABLES</span><span class="token punctuation">,</span> SOURCE_DATASOURCE<span class="token punctuation">,</span> HIS_DATASOURCE<span class="token punctuation">,</span> TARGET_DATASOURCE<span class="token punctuation">,</span> HIS_TABLENAME<span class="token punctuation">,</span> SLEEP<span class="token punctuation">,</span> PROCESS_NUM<span class="token punctuation">,</span> ORDER_COLUMNS<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'CaAssetSynDataTransTask'</span><span class="token punctuation">,</span> <span class="token string">'5'</span><span class="token punctuation">,</span> <span class="token string">'SYN_ID,PARTITION_ID,ASSET_ID,SYN_TYPE,ACCT_ID,ASSET_TYPE,ASSET_ITEM,ASSET_AMOUNT,BILL_FEE,SYNC_FLAG,NOTIFY_FLAG,SYNC_TYPE,VALID_DATE,EXPIRE_DATE,CREATE_DATE,STS,STS_DATE,SO_NBR,SO_DATE,REMARK,TENANT_ID,REGION_CODE,BILLING_TYPE,DEAL_AMOUNT,NEW_BILL_FEE,OLD_BILL_FEE,MOD(ACCT_ID,4) AS ACC_MOD'</span><span class="token punctuation">,</span> <span class="token string">'ca_asset_syn:ca_asset_syn_0$REGION_CODE$_$ACC_MOD$'</span><span class="token punctuation">,</span> <span class="token string">'AC5'</span><span class="token punctuation">,</span> <span class="token string">'AC5'</span><span class="token punctuation">,</span> <span class="token string">'AD'</span><span class="token punctuation">,</span> <span class="token string">'ca_asset_syn_h'</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token string">'SYN_ID'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> PARAM<span class="token punctuation">.</span>DATA_TRANS_TASK_CHANNEL <span class="token punctuation">(</span>TASK_CODE<span class="token punctuation">,</span> CHANNEL_NO<span class="token punctuation">,</span> <span class="token keyword">COLUMNS</span><span class="token punctuation">,</span> <span class="token keyword">TABLES</span><span class="token punctuation">,</span> SOURCE_DATASOURCE<span class="token punctuation">,</span> HIS_DATASOURCE<span class="token punctuation">,</span> TARGET_DATASOURCE<span class="token punctuation">,</span> HIS_TABLENAME<span class="token punctuation">,</span> SLEEP<span class="token punctuation">,</span> PROCESS_NUM<span class="token punctuation">,</span> ORDER_COLUMNS<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'CaAssetSynDataTransTask'</span><span class="token punctuation">,</span> <span class="token string">'6'</span><span class="token punctuation">,</span> <span class="token string">'SYN_ID,PARTITION_ID,ASSET_ID,SYN_TYPE,ACCT_ID,ASSET_TYPE,ASSET_ITEM,ASSET_AMOUNT,BILL_FEE,SYNC_FLAG,NOTIFY_FLAG,SYNC_TYPE,VALID_DATE,EXPIRE_DATE,CREATE_DATE,STS,STS_DATE,SO_NBR,SO_DATE,REMARK,TENANT_ID,REGION_CODE,BILLING_TYPE,DEAL_AMOUNT,NEW_BILL_FEE,OLD_BILL_FEE,MOD(ACCT_ID,4) AS ACC_MOD'</span><span class="token punctuation">,</span> <span class="token string">'ca_asset_syn:ca_asset_syn_0$REGION_CODE$_$ACC_MOD$'</span><span class="token punctuation">,</span> <span class="token string">'AC6'</span><span class="token punctuation">,</span> <span class="token string">'AC6'</span><span class="token punctuation">,</span> <span class="token string">'AD'</span><span class="token punctuation">,</span> <span class="token string">'ca_asset_syn_h'</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token string">'SYN_ID'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> PARAM<span class="token punctuation">.</span>DATA_TRANS_TASK_CHANNEL <span class="token punctuation">(</span>TASK_CODE<span class="token punctuation">,</span> CHANNEL_NO<span class="token punctuation">,</span> <span class="token keyword">COLUMNS</span><span class="token punctuation">,</span> <span class="token keyword">TABLES</span><span class="token punctuation">,</span> SOURCE_DATASOURCE<span class="token punctuation">,</span> HIS_DATASOURCE<span class="token punctuation">,</span> TARGET_DATASOURCE<span class="token punctuation">,</span> HIS_TABLENAME<span class="token punctuation">,</span> SLEEP<span class="token punctuation">,</span> PROCESS_NUM<span class="token punctuation">,</span> ORDER_COLUMNS<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'CaAssetSynDataTransTask'</span><span class="token punctuation">,</span> <span class="token string">'7'</span><span class="token punctuation">,</span> <span class="token string">'SYN_ID,PARTITION_ID,ASSET_ID,SYN_TYPE,ACCT_ID,ASSET_TYPE,ASSET_ITEM,ASSET_AMOUNT,BILL_FEE,SYNC_FLAG,NOTIFY_FLAG,SYNC_TYPE,VALID_DATE,EXPIRE_DATE,CREATE_DATE,STS,STS_DATE,SO_NBR,SO_DATE,REMARK,TENANT_ID,REGION_CODE,BILLING_TYPE,DEAL_AMOUNT,NEW_BILL_FEE,OLD_BILL_FEE,MOD(ACCT_ID,4) AS ACC_MOD'</span><span class="token punctuation">,</span> <span class="token string">'ca_asset_syn:ca_asset_syn_0$REGION_CODE$_$ACC_MOD$'</span><span class="token punctuation">,</span> <span class="token string">'AC7'</span><span class="token punctuation">,</span> <span class="token string">'AC7'</span><span class="token punctuation">,</span> <span class="token string">'AD'</span><span class="token punctuation">,</span> <span class="token string">'ca_asset_syn_h'</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token string">'SYN_ID'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> PARAM<span class="token punctuation">.</span>DATA_TRANS_TASK_CHANNEL <span class="token punctuation">(</span>TASK_CODE<span class="token punctuation">,</span> CHANNEL_NO<span class="token punctuation">,</span> <span class="token keyword">COLUMNS</span><span class="token punctuation">,</span> <span class="token keyword">TABLES</span><span class="token punctuation">,</span> SOURCE_DATASOURCE<span class="token punctuation">,</span> HIS_DATASOURCE<span class="token punctuation">,</span> TARGET_DATASOURCE<span class="token punctuation">,</span> HIS_TABLENAME<span class="token punctuation">,</span> SLEEP<span class="token punctuation">,</span> PROCESS_NUM<span class="token punctuation">,</span> ORDER_COLUMNS<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'CaAssetSynDataTransTask'</span><span class="token punctuation">,</span> <span class="token string">'8'</span><span class="token punctuation">,</span> <span class="token string">'SYN_ID,PARTITION_ID,ASSET_ID,SYN_TYPE,ACCT_ID,ASSET_TYPE,ASSET_ITEM,ASSET_AMOUNT,BILL_FEE,SYNC_FLAG,NOTIFY_FLAG,SYNC_TYPE,VALID_DATE,EXPIRE_DATE,CREATE_DATE,STS,STS_DATE,SO_NBR,SO_DATE,REMARK,TENANT_ID,REGION_CODE,BILLING_TYPE,DEAL_AMOUNT,NEW_BILL_FEE,OLD_BILL_FEE,MOD(ACCT_ID,4) AS ACC_MOD'</span><span class="token punctuation">,</span> <span class="token string">'ca_asset_syn:ca_asset_syn_0$REGION_CODE$_$ACC_MOD$'</span><span class="token punctuation">,</span> <span class="token string">'AC8'</span><span class="token punctuation">,</span> <span class="token string">'AC8'</span><span class="token punctuation">,</span> <span class="token string">'AD'</span><span class="token punctuation">,</span> <span class="token string">'ca_asset_syn_h'</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token string">'SYN_ID'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h2 id="第10章-外部费用同步"><a href="#第10章-外部费用同步" class="header-anchor">#</a> 第10章 外部费用同步</h2> <h3 id="_10-1-基本描述"><a href="#_10-1-基本描述" class="header-anchor">#</a> 10.1 基本描述</h3> <p>​		从账管库同步I_FEE表和I_DATA_INDEX表到JD库</p> <h3 id="_10-2-业务流程"><a href="#_10-2-业务流程" class="header-anchor">#</a> 10.2 业务流程</h3> <div class="language- extra-class"><pre><code>	1. 捞取账管库I_DATA_INDEX表数据
	2. 通过so_nbr关联账管库I_FEE_yyyyMM表数据
            		3. 将两个表数据搬迁到JD库对应的表
        		4. 删除账管库I_DATA_INDEX表数据并搬迁历史表,I_FEE_yyyyMM表数据不动
</code></pre></div><h3 id="_10-3-关键表说明"><a href="#_10-3-关键表说明" class="header-anchor">#</a> 10.3 关键表说明</h3> <table><thead><tr><th>表名</th> <th>描述</th></tr></thead> <tbody><tr><td>I_DATA_INDEX</td> <td>外部费用索引表</td></tr> <tr><td>I_FEE_yyyyMM</td> <td>外部费用表</td></tr></tbody></table> <h3 id="_10-4-关键配置说明"><a href="#_10-4-关键配置说明" class="header-anchor">#</a> 10.4 关键配置说明</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">--任务配置</span>
<span class="token keyword">delete</span> <span class="token keyword">from</span> PARAM<span class="token punctuation">.</span>bs_task <span class="token keyword">where</span> task_code <span class="token operator">=</span> <span class="token string">'IFeeTransTask'</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> param<span class="token punctuation">.</span>bs_task <span class="token punctuation">(</span>TASK_CODE<span class="token punctuation">,</span> TASK_NAME<span class="token punctuation">,</span> TASK_GRP_CODE<span class="token punctuation">,</span> TASK_GRP_NAME<span class="token punctuation">,</span> CHANNEL_NUMBER<span class="token punctuation">,</span> CHANNEL_FIELD<span class="token punctuation">,</span> TASK_GRP_ORDER<span class="token punctuation">,</span> TASK_ORDER<span class="token punctuation">,</span> WRITE_MODE<span class="token punctuation">,</span> FILE_RECORD<span class="token punctuation">,</span> USE_FLAG<span class="token punctuation">,</span> CENTER_TYPE<span class="token punctuation">,</span> REGION_ID<span class="token punctuation">,</span> OP_ID<span class="token punctuation">,</span> ORG_ID<span class="token punctuation">,</span> CLASS_NAME<span class="token punctuation">,</span> COUNTY_CODE<span class="token punctuation">)</span>
<span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token string">'IFeeTransTask'</span><span class="token punctuation">,</span> <span class="token string">'外部费用导入表数据搬迁进程'</span><span class="token punctuation">,</span> <span class="token string">'CEN'</span><span class="token punctuation">,</span> <span class="token string">'账管'</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token string">'U'</span><span class="token punctuation">,</span> <span class="token string">'CEN'</span><span class="token punctuation">,</span> <span class="token string">'0000'</span><span class="token punctuation">,</span> <span class="token string">'99990298'</span><span class="token punctuation">,</span> <span class="token string">'10000001'</span><span class="token punctuation">,</span> <span class="token string">'com.ai.ac.core.datatrans.task.IFeeTransTask'</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">--外部费用 八个库,八个通道</span>
<span class="token keyword">delete</span> <span class="token keyword">from</span> PARAM<span class="token punctuation">.</span>BS_TASK_CHANNEL <span class="token keyword">where</span> TASK_CODE<span class="token operator">=</span><span class="token string">'IFeeTransTask'</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> PARAM<span class="token punctuation">.</span>BS_TASK_CHANNEL <span class="token punctuation">(</span>TASK_CODE<span class="token punctuation">,</span> CHANNEL_NO<span class="token punctuation">,</span> START_ID<span class="token punctuation">,</span> END_ID<span class="token punctuation">,</span> BATCH_NUMBER<span class="token punctuation">,</span> INPUT_PATH<span class="token punctuation">,</span> OUTPUT_PATH<span class="token punctuation">,</span> CENTER_TYPE<span class="token punctuation">,</span> REGION_IDS<span class="token punctuation">,</span> CENTER<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'IFeeTransTask'</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token string">'AC'</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> PARAM<span class="token punctuation">.</span>BS_TASK_CHANNEL <span class="token punctuation">(</span>TASK_CODE<span class="token punctuation">,</span> CHANNEL_NO<span class="token punctuation">,</span> START_ID<span class="token punctuation">,</span> END_ID<span class="token punctuation">,</span> BATCH_NUMBER<span class="token punctuation">,</span> INPUT_PATH<span class="token punctuation">,</span> OUTPUT_PATH<span class="token punctuation">,</span> CENTER_TYPE<span class="token punctuation">,</span> REGION_IDS<span class="token punctuation">,</span> CENTER<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'IFeeTransTask'</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token string">'AC'</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> PARAM<span class="token punctuation">.</span>BS_TASK_CHANNEL <span class="token punctuation">(</span>TASK_CODE<span class="token punctuation">,</span> CHANNEL_NO<span class="token punctuation">,</span> START_ID<span class="token punctuation">,</span> END_ID<span class="token punctuation">,</span> BATCH_NUMBER<span class="token punctuation">,</span> INPUT_PATH<span class="token punctuation">,</span> OUTPUT_PATH<span class="token punctuation">,</span> CENTER_TYPE<span class="token punctuation">,</span> REGION_IDS<span class="token punctuation">,</span> CENTER<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'IFeeTransTask'</span><span class="token punctuation">,</span> <span class="token string">'3'</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token string">'AC'</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token string">'3'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> PARAM<span class="token punctuation">.</span>BS_TASK_CHANNEL <span class="token punctuation">(</span>TASK_CODE<span class="token punctuation">,</span> CHANNEL_NO<span class="token punctuation">,</span> START_ID<span class="token punctuation">,</span> END_ID<span class="token punctuation">,</span> BATCH_NUMBER<span class="token punctuation">,</span> INPUT_PATH<span class="token punctuation">,</span> OUTPUT_PATH<span class="token punctuation">,</span> CENTER_TYPE<span class="token punctuation">,</span> REGION_IDS<span class="token punctuation">,</span> CENTER<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'IFeeTransTask'</span><span class="token punctuation">,</span> <span class="token string">'4'</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token string">'AC'</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token string">'4'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> PARAM<span class="token punctuation">.</span>BS_TASK_CHANNEL <span class="token punctuation">(</span>TASK_CODE<span class="token punctuation">,</span> CHANNEL_NO<span class="token punctuation">,</span> START_ID<span class="token punctuation">,</span> END_ID<span class="token punctuation">,</span> BATCH_NUMBER<span class="token punctuation">,</span> INPUT_PATH<span class="token punctuation">,</span> OUTPUT_PATH<span class="token punctuation">,</span> CENTER_TYPE<span class="token punctuation">,</span> REGION_IDS<span class="token punctuation">,</span> CENTER<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'IFeeTransTask'</span><span class="token punctuation">,</span> <span class="token string">'5'</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token string">'AC'</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token string">'5'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> PARAM<span class="token punctuation">.</span>BS_TASK_CHANNEL <span class="token punctuation">(</span>TASK_CODE<span class="token punctuation">,</span> CHANNEL_NO<span class="token punctuation">,</span> START_ID<span class="token punctuation">,</span> END_ID<span class="token punctuation">,</span> BATCH_NUMBER<span class="token punctuation">,</span> INPUT_PATH<span class="token punctuation">,</span> OUTPUT_PATH<span class="token punctuation">,</span> CENTER_TYPE<span class="token punctuation">,</span> REGION_IDS<span class="token punctuation">,</span> CENTER<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'IFeeTransTask'</span><span class="token punctuation">,</span> <span class="token string">'6'</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token string">'AC'</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token string">'6'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> PARAM<span class="token punctuation">.</span>BS_TASK_CHANNEL <span class="token punctuation">(</span>TASK_CODE<span class="token punctuation">,</span> CHANNEL_NO<span class="token punctuation">,</span> START_ID<span class="token punctuation">,</span> END_ID<span class="token punctuation">,</span> BATCH_NUMBER<span class="token punctuation">,</span> INPUT_PATH<span class="token punctuation">,</span> OUTPUT_PATH<span class="token punctuation">,</span> CENTER_TYPE<span class="token punctuation">,</span> REGION_IDS<span class="token punctuation">,</span> CENTER<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'IFeeTransTask'</span><span class="token punctuation">,</span> <span class="token string">'7'</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token string">'AC'</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token string">'7'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> PARAM<span class="token punctuation">.</span>BS_TASK_CHANNEL <span class="token punctuation">(</span>TASK_CODE<span class="token punctuation">,</span> CHANNEL_NO<span class="token punctuation">,</span> START_ID<span class="token punctuation">,</span> END_ID<span class="token punctuation">,</span> BATCH_NUMBER<span class="token punctuation">,</span> INPUT_PATH<span class="token punctuation">,</span> OUTPUT_PATH<span class="token punctuation">,</span> CENTER_TYPE<span class="token punctuation">,</span> REGION_IDS<span class="token punctuation">,</span> CENTER<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'IFeeTransTask'</span><span class="token punctuation">,</span> <span class="token string">'8'</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token string">'AC'</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token string">'8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="第11章-usage短信发送"><a href="#第11章-usage短信发送" class="header-anchor">#</a> 第11章 usage短信发送</h2> <h3 id="_11-1-基本描述"><a href="#_11-1-基本描述" class="header-anchor">#</a> 11.1 基本描述</h3> <blockquote><p>com.ai.ac.core.asset.task.DailyPrepaidUsageData</p> <p>给订购了制定套餐的用户发送使用量</p></blockquote> <h3 id="_11-2-业务流程"><a href="#_11-2-业务流程" class="header-anchor">#</a> 11.2 业务流程</h3> <ol><li>查询订购了指定套餐的用户</li></ol> <h3 id="_11-3-业务表说明"><a href="#_11-3-业务表说明" class="header-anchor">#</a> 11.3 业务表说明</h3> <h3 id="_11-4-关键配置说明"><a href="#_11-4-关键配置说明" class="header-anchor">#</a> 11.4 关键配置说明</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">--指定套餐配置</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> base<span class="token punctuation">.</span>BS_SMS_SERVER_CONFIG <span class="token keyword">where</span>  COMMAND_ID<span class="token operator">=</span><span class="token string">'PRE_ALT_1_SMS_PROMID'</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="第12章-参数同步进程"><a href="#第12章-参数同步进程" class="header-anchor">#</a> 第12章 参数同步进程</h2> <h3 id="基本描述"><a href="#基本描述" class="header-anchor">#</a> 基本描述</h3> <blockquote><p>将<strong>A用户</strong>的表数据同步到<strong>B用户</strong></p></blockquote> <h3 id="业务流程"><a href="#业务流程" class="header-anchor">#</a> 业务流程</h3> <ol><li><p>B用户建表,需要partition_id(用来清理分区)</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">--示例</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> PARAM<span class="token punctuation">.</span>PM_ACCUMULATE_DISC_REF_EVENT
<span class="token punctuation">(</span>
    PRICE_ID       NUMBER<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span>              <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
    PARTITION_ID   NUMBER<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    ITEM_ID        NUMBER<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span>              <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
    RATING_COND_ID NUMBER<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    TENANT_ID      NUMBER<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">'0'</span> <span class="token operator">not</span> <span class="token boolean">null</span>
<span class="token punctuation">)</span>
    PCTFREE <span class="token number">10</span>
    INITRANS <span class="token number">20</span>
    MAXTRANS <span class="token number">255</span>
    <span class="token keyword">TABLESPACE</span> TBS_PARAM_CFG_DAT_01
    <span class="token keyword">PARTITION</span> <span class="token keyword">by</span> RANGE <span class="token punctuation">(</span>PARTITION_ID<span class="token punctuation">)</span>
<span class="token punctuation">(</span>
    <span class="token comment">--PARTITION命名必须为: PAR_表名_0/1</span>
    <span class="token keyword">PARTITION</span> PAR_PM_ACCUMULATE_DISC_REF_EVENT_0 <span class="token keyword">VALUES</span> LESS THAN <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">PARTITION</span> PAR_PM_ACCUMULATE_DISC_REF_EVENT_1 <span class="token keyword">VALUES</span> LESS THAN <span class="token punctuation">(</span>MAXVALUE<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>将需要同步的表配置在进程配置中</p></li> <li><p>启动同步参数的et进程</p></li></ol> <div class="language-http request extra-class"><pre class="language-http"><code>--et地址 asset/asset
<span class="token header-name keyword">http:</span>//172.25.136.13:8880/et-console/index.html
</code></pre></div><p><img src="/acct-doc/assets/img/syncparam.0899c1ff.png" alt="图片">
4. 更新缓存表版本号</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">update</span> base<span class="token punctuation">.</span>CFG_CACHE_TABLE
<span class="token keyword">set</span> CREATE_TIME<span class="token operator">=</span>sysdate <span class="token keyword">where</span> TABLE_ID <span class="token operator">in</span> <span class="token punctuation">(</span>
                                           <span class="token string">'SYS_CITY_PART'</span><span class="token punctuation">,</span><span class="token string">'SYS_COUNTRY'</span><span class="token punctuation">,</span><span class="token string">'GSM_INTL_PLMN_CODE'</span><span class="token punctuation">,</span><span class="token string">'ALL_OPP_TYPE'</span><span class="token punctuation">,</span><span class="token string">'AM_FREE_RES_TYPE_DEF'</span><span class="token punctuation">,</span><span class="token string">'PM_FREERES_USAGE_RULE'</span><span class="token punctuation">,</span><span class="token string">'PM_ASSET_ITEM_GROUP'</span><span class="token punctuation">,</span><span class="token string">'PM_PRODUCT_OFFERING'</span><span class="token punctuation">,</span><span class="token string">'PM_COMPOSITE_OFFER_PRICE'</span><span class="token punctuation">,</span><span class="token string">'PM_COMPONENT_PRODOFFER_PRICE'</span><span class="token punctuation">,</span><span class="token string">'PM_ALLOWANCE_FREERES_SEGMENT'</span><span class="token punctuation">,</span><span class="token string">'PM_ALLOWANCE_FREERES_DETAILS'</span><span class="token punctuation">,</span><span class="token string">'PM_ASSET_ITEM'</span><span class="token punctuation">,</span><span class="token string">'PM_USER_ALARM_DEF'</span><span class="token punctuation">,</span><span class="token string">'PM_USER_ALARM_DTL'</span><span class="token punctuation">,</span><span class="token string">'PM_ALARM_RULE_DEF'</span><span class="token punctuation">,</span><span class="token string">'PM_ASSET_ALARM_REL'</span><span class="token punctuation">,</span><span class="token string">'PM_ASSET_ALARM_DTL'</span><span class="token punctuation">,</span><span class="token string">'PM_OFFLINE_NOTIFICATION'</span><span class="token punctuation">,</span><span class="token string">'PM_PRODUCT_PRICING_PLAN'</span><span class="token punctuation">,</span><span class="token string">'PM_COMPLEX_ACCUM_PIRCE_DTL'</span><span class="token punctuation">,</span><span class="token string">'PM_ACCUMULATE_ITEM_DEF'</span><span class="token punctuation">,</span><span class="token string">'PM_COMPLEX_ACCUMULATE_PRICE'</span><span class="token punctuation">,</span><span class="token string">'PM_PRODUCT_OFFER_LIFECYCLE'</span><span class="token punctuation">,</span><span class="token string">'PM_PRODUCT_OFFER_ATTRIBUTE'</span><span class="token punctuation">,</span><span class="token string">'PM_PRODUCT_SPEC_TYPE'</span><span class="token punctuation">,</span><span class="token string">'PM_PRODUCT_SPEC_TYPE_GROUPS'</span><span class="token punctuation">,</span><span class="token string">'PM_RATING_TARIFF'</span><span class="token punctuation">,</span><span class="token string">'PM_RATING_TARIFF_DTL'</span><span class="token punctuation">,</span><span class="token string">'PM_COMPLEX_RATE_PLAN'</span><span class="token punctuation">,</span><span class="token string">'PM_COMPONENT_USAGE_PRICE'</span><span class="token punctuation">,</span><span class="token string">'PM_COMPONENT_SIMPLE_PRICE'</span><span class="token punctuation">,</span><span class="token string">'PM_COMPONENT_PLEX_PRICE'</span><span class="token punctuation">,</span><span class="token string">'PM_RATING_RATE'</span><span class="token punctuation">,</span><span class="token string">'PM_PRICE_EVENT'</span><span class="token punctuation">,</span><span class="token string">'PM_RATING_CURVE'</span><span class="token punctuation">,</span><span class="token string">'PM_RATING_CURVE_DETAIL'</span><span class="token punctuation">,</span><span class="token string">'PM_PRICE_EVENT_REL'</span><span class="token punctuation">,</span><span class="token string">'PM_ADJUST_SEGMENT'</span><span class="token punctuation">,</span><span class="token string">'PM_USAGE_ADJSCHEME_DETAIL'</span><span class="token punctuation">,</span><span class="token string">'PM_ACCUMULATE_ITEM_REL'</span><span class="token punctuation">,</span><span class="token string">'PM_FREE_USAGE_PROPERTY'</span><span class="token punctuation">,</span><span class="token string">'PM_RECURRING_FEE_DTL'</span><span class="token punctuation">,</span><span class="token string">'PM_RATES'</span><span class="token punctuation">,</span><span class="token string">'PM_CURVE'</span><span class="token punctuation">,</span><span class="token string">'PM_CURVE_SEGMENTS'</span><span class="token punctuation">,</span><span class="token string">'PM_ACCUMULATE_PRICE'</span><span class="token punctuation">,</span><span class="token string">'PM_ACCUMULATE_DISC_REF_EVENT'</span><span class="token punctuation">,</span><span class="token string">'SYS_TIME_SEG_DEF'</span><span class="token punctuation">,</span><span class="token string">'SYS_NOTIFICATION_ACTION_REL'</span><span class="token punctuation">,</span><span class="token string">'SYS_NOTIFICATION_RULE'</span><span class="token punctuation">,</span><span class="token string">'SYS_NOTIFICATION_ACTION'</span><span class="token punctuation">,</span><span class="token string">'SYS_NOTIF_ACTION_CHANNELS'</span><span class="token punctuation">,</span><span class="token string">'SYS_NOTIFICATION_TEMPLATE'</span><span class="token punctuation">,</span><span class="token string">'SYS_MEASURE'</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol start="5"><li><a href="/acct-doc/zh/cache/">同步成功刷新缓存 </a></li></ol> <div class="language-http request extra-class"><pre class="language-http"><code>admin/admin
<span class="token header-name keyword">http:</span>//172.25.132.100:9090/index.do
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//刷新缓存类</span>
<span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>asiainfo<span class="token punctuation">.</span>areca<span class="token punctuation">.</span>soa<span class="token punctuation">.</span>bsparam<span class="token punctuation">.</span>repository<span class="token punctuation">.</span>dao<span class="token punctuation">.</span>staticparam<span class="token punctuation">.</span></span>CfgCacheTableImpl</span>
</code></pre></div><p><img src="/acct-doc/assets/img/re_cache.5a9df79e.png" alt="图片"></p> <h3 id="业务表说明"><a href="#业务表说明" class="header-anchor">#</a> 业务表说明</h3> <table><thead><tr><th>表名</th> <th>说明</th></tr></thead> <tbody><tr><td>param.BS_TASK</td> <td>任务配置表</td></tr> <tr><td>param.BS_TASK_CHANNEL</td> <td>任务通道表</td></tr> <tr><td>PARAM.DATA_TRANS_TASK_CHANNEL</td> <td>数据同步参数表(<strong>关键</strong>)</td></tr></tbody></table> <blockquote><p>DATA_TRANS_TASK_CHANNEL 关键字段说明**(有说明的字段有用,其他字段不关心)**</p></blockquote> <table><thead><tr><th>列名</th> <th>说明</th></tr></thead> <tbody><tr><td>TASK_CODE/CHANNEL_NO</td> <td>跟BS_TASK表的对应</td></tr> <tr><td>TABLES</td> <td>源表和目标表名不一致:<br>sourceTable:targetTable,sourceTable1:targetTable1<br>源表和目标表一致:<br>AM_FREE_RES_TYPE_DEF,PM_FREERES_USAGE_RULE<br>需要根据数据分发到不同表名:<br>ca_asset_syn:ca_asset_syn_0$REGION_CODE$_$ACC_MOD$<br>$替换字符$,需要查询的结果集中有这个字段</td></tr> <tr><td>SOURCE_DATASOURCE</td> <td>从哪个数据源同步数据</td></tr> <tr><td>TARGET_DATASOURCE</td> <td>同步到哪个数据源</td></tr></tbody></table> <h3 id="关键参数配置说明"><a href="#关键参数配置说明" class="header-anchor">#</a> 关键参数配置说明</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">--param.BS_TASK</span>
<span class="token keyword">delete</span> <span class="token keyword">from</span> PARAM<span class="token punctuation">.</span>bs_task <span class="token keyword">where</span> task_code <span class="token operator">=</span> <span class="token string">'SyncPDTableTask'</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> PARAM<span class="token punctuation">.</span>BS_TASK <span class="token punctuation">(</span>TASK_CODE<span class="token punctuation">,</span> TASK_NAME<span class="token punctuation">,</span> TASK_GRP_CODE<span class="token punctuation">,</span> TASK_GRP_NAME<span class="token punctuation">,</span> CHANNEL_NUMBER<span class="token punctuation">,</span> CHANNEL_FIELD<span class="token punctuation">,</span> TASK_GRP_ORDER<span class="token punctuation">,</span> TASK_ORDER<span class="token punctuation">,</span> WRITE_MODE<span class="token punctuation">,</span> FILE_RECORD<span class="token punctuation">,</span> USE_FLAG<span class="token punctuation">,</span> CENTER_TYPE<span class="token punctuation">,</span> REGION_ID<span class="token punctuation">,</span> OP_ID<span class="token punctuation">,</span> ORG_ID<span class="token punctuation">,</span> CLASS_NAME<span class="token punctuation">,</span> COUNTY_CODE<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'SyncPDTableTask'</span><span class="token punctuation">,</span> <span class="token string">'Sync PD table to PARAM'</span><span class="token punctuation">,</span> <span class="token string">'AC'</span><span class="token punctuation">,</span> <span class="token string">'帐管'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token string">'group'</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token string">'U'</span><span class="token punctuation">,</span> <span class="token string">'AC'</span><span class="token punctuation">,</span> <span class="token string">'0000'</span><span class="token punctuation">,</span> <span class="token string">'0000'</span><span class="token punctuation">,</span> <span class="token string">'0000'</span><span class="token punctuation">,</span> <span class="token string">'com.ai.ac.core.datatrans.task.SyncTableTask'</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">--param.BS_TASK_CHANNEL</span>
<span class="token keyword">delete</span> <span class="token keyword">from</span> PARAM<span class="token punctuation">.</span>BS_TASK_CHANNEL <span class="token keyword">where</span> task_code <span class="token operator">=</span> <span class="token string">'SyncPDTableTask'</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> PARAM<span class="token punctuation">.</span>BS_TASK_CHANNEL <span class="token punctuation">(</span>TASK_CODE<span class="token punctuation">,</span> CHANNEL_NO<span class="token punctuation">,</span> START_ID<span class="token punctuation">,</span> END_ID<span class="token punctuation">,</span> BATCH_NUMBER<span class="token punctuation">,</span> INPUT_PATH<span class="token punctuation">,</span> OUTPUT_PATH<span class="token punctuation">,</span> CENTER_TYPE<span class="token punctuation">,</span> REGION_IDS<span class="token punctuation">,</span> CENTER<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'SyncPDTableTask'</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token string">'AC'</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token string">'8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">--PARAM.DATA_TRANS_TASK_CHANNEL</span>
<span class="token keyword">delete</span> <span class="token keyword">from</span> PARAM<span class="token punctuation">.</span>DATA_TRANS_TASK_CHANNEL <span class="token keyword">where</span> task_code <span class="token operator">=</span> <span class="token string">'SyncPDTableTask'</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> PARAM<span class="token punctuation">.</span>DATA_TRANS_TASK_CHANNEL <span class="token punctuation">(</span>TASK_CODE<span class="token punctuation">,</span> CHANNEL_NO<span class="token punctuation">,</span> <span class="token keyword">COLUMNS</span><span class="token punctuation">,</span> <span class="token keyword">TABLES</span><span class="token punctuation">,</span> SOURCE_DATASOURCE<span class="token punctuation">,</span> HIS_DATASOURCE<span class="token punctuation">,</span> TARGET_DATASOURCE<span class="token punctuation">,</span> HIS_TABLENAME<span class="token punctuation">,</span> SLEEP<span class="token punctuation">,</span> PROCESS_NUM<span class="token punctuation">,</span> ORDER_COLUMNS<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'SyncPDTableTask'</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token string">'AM_FREE_RES_TYPE_DEF,PM_FREERES_USAGE_RULE,PM_ASSET_ITEM_GROUP,PM_PRODUCT_OFFERING,PM_COMPOSITE_OFFER_PRICE,PM_COMPONENT_PRODOFFER_PRICE,PM_ALLOWANCE_FREERES_SEGMENT,PM_ALLOWANCE_FREERES_DETAILS,PM_ASSET_ITEM,PM_USER_ALARM_DEF,PM_USER_ALARM_DTL,PM_ALARM_RULE_DEF,PM_ASSET_ALARM_REL,PM_ASSET_ALARM_DTL,PM_OFFLINE_NOTIFICATION,PM_PRODUCT_PRICING_PLAN,PM_COMPLEX_ACCUM_PIRCE_DTL,PM_ACCUMULATE_ITEM_DEF,PM_COMPLEX_ACCUMULATE_PRICE,PM_PRODUCT_OFFER_LIFECYCLE,PM_PRODUCT_OFFER_ATTRIBUTE,PM_PRODUCT_SPEC_TYPE,PM_PRODUCT_SPEC_TYPE_GROUPS,PM_RATING_TARIFF,PM_RATING_TARIFF_DTL,PM_COMPLEX_RATE_PLAN,PM_COMPONENT_USAGE_PRICE,PM_COMPONENT_SIMPLE_PRICE,PM_COMPONENT_PLEX_PRICE,PM_RATING_RATE,PM_PRICE_EVENT,PM_RATING_CURVE,PM_RATING_CURVE_DETAIL,PM_PRICE_EVENT_REL,PM_ADJUST_SEGMENT,PM_USAGE_ADJSCHEME_DETAIL,PM_ACCUMULATE_ITEM_REL,PM_FREE_USAGE_PROPERTY,PM_RECURRING_FEE_DTL,PM_RATES,PM_CURVE,PM_CURVE_SEGMENTS,PM_ACCUMULATE_PRICE,PM_ACCUMULATE_DISC_REF_EVENT'</span><span class="token punctuation">,</span> <span class="token string">'PD'</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token string">'ACTPARAM'</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h2 id="第13章-批量vc充值"><a href="#第13章-批量vc充值" class="header-anchor">#</a> 第13章 批量vc充值</h2> <h2 id="第14章-0缴费销账工单"><a href="#第14章-0缴费销账工单" class="header-anchor">#</a> 第14章 0缴费销账工单</h2> <h2 id="黄典后台"><a href="#黄典后台" class="header-anchor">#</a> 黄典后台</h2> <h1 id="划拨返款"><a href="#划拨返款" class="header-anchor">#</a> 划拨返款</h1> <h3 id="基本描述-basic-description"><a href="#基本描述-basic-description" class="header-anchor">#</a> 基本描述-basic description</h3> <p>在crm订购划拨活动，每个周期固定赠送金额。</p> <h3 id="业务流程-business-process"><a href="#业务流程-business-process" class="header-anchor">#</a> 业务流程-business process</h3> <p>通过在crm页面订购相应的营销活动，等流程走完，查看账管相关表的数据是否正常</p> <p>活动受理表 AC*.AM_APPORTION 会有一条受理记录</p> <p>定时扫描AC*.AM_APPORTION_PLAN表捞取待返款的数据</p> <p>返款前会清理上月返款金额</p> <p>记录业务表，发送短信</p> <h3 id="业务表说明-2"><a href="#业务表说明-2" class="header-anchor">#</a> 业务表说明</h3> <table><thead><tr><th>AM_APPORTION</th> <th>活动受理表</th></tr></thead> <tbody><tr><td>AM_APPORTION_PLAN</td> <td>分摊计划表</td></tr> <tr><td>AM_RETURN</td> <td>分摊日志表</td></tr> <tr><td>AM_RETURN_ERROR</td> <td>分摊错误日志表</td></tr> <tr><td>AM_APPORTION_REFUND_mm</td> <td>分摊计划备份表</td></tr></tbody></table> <h3 id="关键配置说明"><a href="#关键配置说明" class="header-anchor">#</a> 关键配置说明</h3> <table><thead><tr><th>AM_PRICE_PLAN</th> <th>定价计划定义表</th></tr></thead> <tbody><tr><td>AM_PRICE_PLAN_COMP</td> <td>定价计划组成表</td></tr> <tr><td>AM_PRICE_PLAN_APP_RULE</td> <td>返还规则定义表</td></tr> <tr><td>AM_PRICE_PLAN_ATTR</td> <td>定价计划属性表</td></tr> <tr><td>AM_PRICE_PLAN_APP_SEG</td> <td>分段返还规则表</td></tr></tbody></table> <hr> <h1 id="划拨返款最后月清零"><a href="#划拨返款最后月清零" class="header-anchor">#</a> 划拨返款最后月清零</h1> <h3 id="基本描述-basic-description-2"><a href="#基本描述-basic-description-2" class="header-anchor">#</a> 基本描述-basic description</h3> <p>在划拨活动结束后的下个周期 进行账本清零</p> <h3 id="业务流程-business-process-2"><a href="#业务流程-business-process-2" class="header-anchor">#</a> 业务流程-business process</h3> <p>捞取AM_APPORTION_PLAN 表划拨结束的数据，对其进行账本清零</p> <h3 id="业务表说明-3"><a href="#业务表说明-3" class="header-anchor">#</a> 业务表说明</h3> <hr> <p>AM_APPORTION               活动受理表
AM_APPORTION_PLAN         分摊计划表
AM_RETURN                  分摊日志表
AM_RETURN_ERROR           分摊错误日志表
AM_APPORTION_REFUND_mm   分摊计划备份表</p> <hr> <h3 id="关键配置说明-2"><a href="#关键配置说明-2" class="header-anchor">#</a> 关键配置说明</h3> <hr> <p>AM_PRICE_PLAN              定价计划定义表
AM_PRICE_PLAN_COMP        定价计划组成表
AM_PRICE_PLAN_APP_RULE   返还规则定义表
AM_PRICE_PLAN_ATTR        定价计划属性表
AM_PRICE_PLAN_APP_SEG    分段返还规则表</p> <hr> <h2 id="周琪宏后台"><a href="#周琪宏后台" class="header-anchor">#</a> 周琪宏后台</h2> <h2 id="后付费出帐后的短信提醒"><a href="#后付费出帐后的短信提醒" class="header-anchor">#</a> 后付费出帐后的短信提醒</h2> <h3 id="基本描述-basic-description-3"><a href="#基本描述-basic-description-3" class="header-anchor">#</a> 基本描述-basic description</h3> <p>后付费出帐后的短信提醒。</p> <h3 id="业务流程-business-process-3"><a href="#业务流程-business-process-3" class="header-anchor">#</a> 业务流程-business process</h3> <p>进程类：OutBillNotifyTask/OutBillNotifyGenerator</p> <ol><li><p>扫描邮寄账单数据表</p></li> <li><p>查询折扣表，只取账务优惠的，查询产品</p></li> <li><p>查询三户资料，取用户状态0到10之间</p></li> <li><p>查询月缴费信息，如果缴费额大于0，则生成一种短信，否则生成另外一种短信</p></li> <li><p>发送短信</p></li></ol> <h3 id="业务表说明-4"><a href="#业务表说明-4" class="header-anchor">#</a> 业务表说明</h3> <table><thead><tr><th>CEN.AM_MAIL_MAIN_201908</th> <th>邮寄账单数据表（扫描）</th></tr></thead> <tbody><tr><td>CEN.AM_MAIL_MAIN_AUX_201908</td> <td>邮寄账单数据扩展表</td></tr> <tr><td>AD.CA_PARA_LIMITSETTING</td> <td>折扣表</td></tr> <tr><td>crm1.um_subscriber_921</td> <td>三户资料，用户状态0到10之间</td></tr> <tr><td>party.cm_account</td> <td></td></tr></tbody></table> <h3 id="关键配置说明-3"><a href="#关键配置说明-3" class="header-anchor">#</a> 关键配置说明</h3> <p><em>--参数配置</em></p> <p>select t.* from param.BS_SYS_PROFILES t where t.profile_type='ACC_MAIL_BILL';</p> <p>select t.<em>,t.rowid from param.bs_task t where task_code = 'OutBillNotifyTask';</em>--223307/30815095/921*</p> <p>select t.*,t.rowid from PARAM.Bs_Task_Channel t where task_code = 'OutBillNotifyTask';</p> <p>./starttask.sh OutBillNotifyTask 00 -pPHONE_ID=3165715358 -pCYCLE_ID=201906 -pCYCLE_TYPE=1</p> <h2 id="后付费号码月底短信提醒"><a href="#后付费号码月底短信提醒" class="header-anchor">#</a> 后付费号码月底短信提醒</h2> <h3 id="基本描述-basic-description-4"><a href="#基本描述-basic-description-4" class="header-anchor">#</a> 基本描述-basic description</h3> <p>后付费号码月底短信提醒。</p> <h3 id="业务流程-business-process-4"><a href="#业务流程-business-process-4" class="header-anchor">#</a> 业务流程-business process</h3> <p>进程类：EndBillNotifyTask/EndBillNotifyGenerator</p> <ol><li><p>扫描邮寄账单数据表</p></li> <li><p>查询折扣表，只取账务优惠的，查询产品</p></li> <li><p>三户资料，用户状态0到10之间，且MNP_FLAG不为2</p></li> <li><p>查询欠费总额和月账单总额，生成短信</p></li> <li><p>发送短信</p></li></ol> <h3 id="业务表说明-5"><a href="#业务表说明-5" class="header-anchor">#</a> 业务表说明</h3> <table><thead><tr><th>CEN.AM_MAIL_MAIN_201908</th> <th>邮寄账单数据表（扫描）</th></tr></thead> <tbody><tr><td>crm1.um_subscriber_921</td> <td>三户资料，用户状态0到10之间</td></tr> <tr><td>party.cm_account</td> <td></td></tr> <tr><td>party.cb_customer</td> <td></td></tr> <tr><td>crm1.um_offer_921</td> <td></td></tr></tbody></table> <h3 id="关键配置说明-4"><a href="#关键配置说明-4" class="header-anchor">#</a> 关键配置说明</h3> <p><em>--参数配置</em></p> <p>select t.* from param.BS_SYS_PROFILES t where t.profile_type='ACC_MAIL_BILL';</p> <p>select t.<em>,t.rowid from param.bs_task t where task_code = 'EndBillNotifyTask';</em>--223307/30815095/921*</p> <p>select t.*,t.rowid from PARAM.Bs_Task_Channel t where task_code = 'EndBillNotifyTask';</p> <p>./starttask.sh EndBillNotifyTask 00 -pPHONE_ID=3165715358 -pCYCLE_ID=201906</p> <h2 id="后付费号码月中短信提醒"><a href="#后付费号码月中短信提醒" class="header-anchor">#</a> 后付费号码月中短信提醒</h2> <h3 id="基本描述-basic-description-5"><a href="#基本描述-basic-description-5" class="header-anchor">#</a> 基本描述-basic description</h3> <p>后付费号码月中短信提醒</p> <h3 id="业务流程-business-process-5"><a href="#业务流程-business-process-5" class="header-anchor">#</a> 业务流程-business process</h3> <p>进程类：MiddleBillNotifyTask/ MiddleBillNotifyGenerator</p> <ol><li><p>扫描日账单表</p></li> <li><p>查询折扣表，只取账务优惠的，查询产品</p></li> <li><p>查询三户资料，用户状态0到10之间，停机位都是0的后付费，且MNP_FLAG不为2</p></li> <li><p>查欠当前欠费大于才发送，欠费大于等于信用度，发送超出短信</p></li> <li><p>欠费小于信用度，发送普通提醒短信</p></li> <li><p>发送短信</p></li></ol> <h3 id="业务表说明-6"><a href="#业务表说明-6" class="header-anchor">#</a> 业务表说明</h3> <table><thead><tr><th>ad.Ca_Daily_Bill_0921_20190531</th> <th>日账单表（扫描）</th></tr></thead> <tbody><tr><td>ac1.AM_BILL_ITEM</td> <td>欠费信息</td></tr> <tr><td>ac1.AM_ACCT_DEBT_11</td> <td></td></tr> <tr><td>AC1.AM_BALANCE_11</td> <td></td></tr> <tr><td>APS_MDB的实时账单</td> <td></td></tr> <tr><td>AD.CA_PARA_LIMITSETTING</td> <td>折扣表</td></tr> <tr><td>crm1.um_subscriber_921</td> <td>三户资料，用户状态0到10之间，停机位都是0的后付费，且MNP_FLAG不为2</td></tr> <tr><td>party.cm_account</td> <td></td></tr> <tr><td>party.cb_customer</td> <td></td></tr> <tr><td>crm1.um_offer_921</td> <td></td></tr></tbody></table> <h3 id="关键配置说明-5"><a href="#关键配置说明-5" class="header-anchor">#</a> 关键配置说明</h3> <p><em>--参数配置</em></p> <p>select t.* from param.BS_SYS_PROFILES t where t.profile_type='ACC_MAIL_BILL';</p> <p>select t.<em>,t.rowid from param.bs_task t where task_code = 'MiddleBillNotifyTask';</em>--223307/30815095/921*</p> <p>select t.*,t.rowid from PARAM.Bs_Task_Channel t where task_code = 'MiddleBillNotifyTask';</p> <p>./starttask.sh MiddleBillNotifyTask 00 -pPHONE_ID=3105455335 -pBILL_DATE=20190829</p> <h2 id="月租费使用提醒"><a href="#月租费使用提醒" class="header-anchor">#</a> 月租费使用提醒</h2> <h2 id=""><a href="#" class="header-anchor">#</a></h2> <h3 id="基本描述-basic-description-6"><a href="#基本描述-basic-description-6" class="header-anchor">#</a> 基本描述-basic description</h3> <p>月租费使用提醒</p> <h3 id="业务流程-business-process-6"><a href="#业务流程-business-process-6" class="header-anchor">#</a> 业务流程-business process</h3> <p>进程类：LinerentUsageTask/LinerentUsageGenerator</p> <ol><li><p>扫描昨天日账单表费用减去前天日帐表的费用，有增量费用的账户需要处理</p></li> <li><p>查询三户资料，用户状态0到10之间，停机位都是0的后付费</p></li> <li><p>查询短信配置信息，生成短信</p></li> <li><p>发送短信</p></li></ol> <h3 id="业务表说明-7"><a href="#业务表说明-7" class="header-anchor">#</a> 业务表说明</h3> <table><thead><tr><th>ad.Ca_Daily_Bill_0921_20190820</th> <th>日账单表（扫描）</th></tr></thead> <tbody><tr><td>ad.Ca_Usage_Bill_Dtl_0921_20190820</td> <td>日账单信息明细表</td></tr> <tr><td>ad.Ca_Rc_Bill_Dtl_0921_20190820</td> <td></td></tr> <tr><td>ad.Ca_Prom_Bill_Dtl_0921_20190820</td> <td></td></tr> <tr><td>crm1.um_subscriber_921</td> <td>三户资料，用户状态0到10之间，停机位都是0的后付费</td></tr> <tr><td>party.cm_account</td> <td></td></tr> <tr><td>party.cb_customer</td> <td></td></tr> <tr><td>crm1.um_offer_921</td> <td></td></tr></tbody></table> <h3 id="关键配置说明-6"><a href="#关键配置说明-6" class="header-anchor">#</a> 关键配置说明</h3> <p><em>--参数配置</em></p> <p>select t.* from param.BS_SYS_PROFILES t where t.profile_type='ACC_MAIL_BILL';</p> <p>select t.<em>,t.rowid from param.bs_task t where task_code = 'LinerentUsageTask';</em>--223307/30815095/921*</p> <p>select t.*,t.rowid from PARAM.Bs_Task_Channel t where task_code = 'LinerentUsageTask';</p> <p>./starttask.sh LinerentUsageTask 00 -pPHONE_ID=3105455335 -pBILL_DATE=20190831</p> <h2 id="多重账单提醒"><a href="#多重账单提醒" class="header-anchor">#</a> 多重账单提醒</h2> <h3 id="基本描述-basic-description-7"><a href="#基本描述-basic-description-7" class="header-anchor">#</a> 基本描述-basic description</h3> <p>在划拨活动结束后的下个周期 进行账本清零</p> <h3 id="业务流程-business-process-7"><a href="#业务流程-business-process-7" class="header-anchor">#</a> 业务流程-business process</h3> <p>进程类：MultipleBillAlertsTask/MultipleBillAlertsGenerator</p> <ol><li><p>扫描昨天的日账单的有费用的账户</p></li> <li><p>查询三户资料，用户状态为0，停机位都是0的后付费</p></li> <li><p>查询产品，过滤订购日、月、周产品的号码</p></li> <li><p>账单的费用需要按模版15的格式化归类</p></li> <li><p>日产品的提醒，消费金额为昨天的费用减去前天的费用，如果前天是上个月则直接用昨天的费用；每日提醒；</p></li> <li><p>周产品的提醒，消费金额为昨天的费用减去前7天的费用，如果前7天是上个月则直接用昨天的费用；每周1提醒上周费用；</p></li> <li><p>月产品的提醒，消费金额为上月的费用；每月1日提醒上月费用；</p></li> <li><p>发送短信</p></li></ol> <h3 id="业务表说明-8"><a href="#业务表说明-8" class="header-anchor">#</a> 业务表说明</h3> <table><thead><tr><th>ad.Ca_Daily_Bill_0921_20190820</th> <th>日账单表（扫描）</th></tr></thead> <tbody><tr><td>ad.Ca_Usage_Bill_Dtl_0921_20190820</td> <td>日账单信息明细表</td></tr> <tr><td>ad.Ca_Rc_Bill_Dtl_0921_20190820</td> <td></td></tr> <tr><td>ad.Ca_Prom_Bill_Dtl_0921_20190820</td> <td></td></tr> <tr><td>crm1.um_subscriber_921</td> <td>三户资料，用户状态为0，停机位都是0的后付费</td></tr> <tr><td>party.cm_account</td> <td></td></tr> <tr><td>party.cb_customer</td> <td></td></tr> <tr><td>crm1.um_offer_921</td> <td></td></tr></tbody></table> <h3 id="关键配置说明-7"><a href="#关键配置说明-7" class="header-anchor">#</a> 关键配置说明</h3> <p><em>--参数配置</em></p> <p>select t.* from param.BS_SYS_PROFILES t where t.profile_type='ACC_MAIL_BILL';</p> <p>select t.<em>,t.rowid from param.bs_task t where task_code = 'MultipleBillAlertsTask';</em>--223307/30815095/921*</p> <p>select t.*,t.rowid from PARAM.Bs_Task_Channel t where task_code = 'MultipleBillAlertsTask';</p> <p>./starttask.sh MultipleBillAlertsTask 00 -pPHONE_ID=3455345114 -pBILL_DATE=20191004</p> <h2 id="无邮寄地址提醒"><a href="#无邮寄地址提醒" class="header-anchor">#</a> 无邮寄地址提醒</h2> <h3 id="基本描述-basic-description-8"><a href="#基本描述-basic-description-8" class="header-anchor">#</a> 基本描述-basic description</h3> <p>无邮寄地址提醒</p> <h3 id="业务流程-business-process-8"><a href="#业务流程-business-process-8" class="header-anchor">#</a> 业务流程-business process</h3> <p>进程类：NoEmailAddressTask/ NoEmailAddressGenerator</p> <ol><li><p>扫描用户邮寄地址表</p></li> <li><p>邮寄地址字段为空的号码，生成短信</p></li> <li><p>发送短信</p></li></ol> <h3 id="业务表说明-9"><a href="#业务表说明-9" class="header-anchor">#</a> 业务表说明</h3> <hr> <p>CRM1.um_mail_info_921   用户邮寄地址表（扫描各地市）</p> <hr> <h3 id="关键配置说明-8"><a href="#关键配置说明-8" class="header-anchor">#</a> 关键配置说明</h3> <p><em>--参数配置</em></p> <p>select t.* from param.BS_SYS_PROFILES t where t.profile_type='ACC_MAIL_BILL';</p> <p>select t.*,t.rowid from param.bs_task t where task_code = 'NoEmailAddressTask';</p> <p>select t.*,t.rowid from PARAM.Bs_Task_Channel t where task_code = 'NoEmailAddressTask';</p> <p>./starttask.sh NoEmailAddressTask 00 -pCYCLE_ID=201906 -pPHONE_ID=3145656354</p> <h2 id="最多打电话提醒"><a href="#最多打电话提醒" class="header-anchor">#</a> 最多打电话提醒</h2> <h3 id="基本描述-basic-description-9"><a href="#基本描述-basic-description-9" class="header-anchor">#</a> 基本描述-basic description</h3> <p>最多打电话提醒</p> <h3 id="业务流程-business-process-9"><a href="#业务流程-business-process-9" class="header-anchor">#</a> 业务流程-business process</h3> <p>进程类：TopUsedNumberTask/ TopUsedNumberGenerator</p> <ol><li><p>扫描邮寄账单数据表</p></li> <li><p>查询三户资料，用户状态0到10之间的后付费，且MNP_FLAG不为2</p></li> <li><p>查询后付费的语音详单和vpmn的详单，统计call_type为0、2、3、4类型的对端号码次数；</p></li> <li><p>发送短信</p></li></ol> <h3 id="业务表说明-10"><a href="#业务表说明-10" class="header-anchor">#</a> 业务表说明</h3> <table><thead><tr><th>CEN.AM_MAIL_MAIN_201908</th> <th>邮寄账单数据表（扫描）</th></tr></thead> <tbody><tr><td>crm1.um_subscriber_921</td> <td>用户表，后付费用户</td></tr> <tr><td>jf.dr_cs_post_201908</td> <td>三户资料，用户状态0到10之间的后付费，且MNP_FLAG不为2</td></tr> <tr><td>jf.dr_vpmn_pre_201908</td> <td></td></tr></tbody></table> <h3 id="关键配置说明-9"><a href="#关键配置说明-9" class="header-anchor">#</a> 关键配置说明</h3> <p><em>--参数配置</em></p> <p>select t.* from param.BS_SYS_PROFILES t where t.profile_type='ACC_MAIL_BILL';</p> <p>select t.<em>,t.rowid from param.bs_task t where task_code = 'TopUsedNumberTask';</em>--223307/30815095/921*</p> <p>select t.*,t.rowid from PARAM.Bs_Task_Channel t where task_code = 'TopUsedNumberTask';</p> <p>./starttask.sh TopUsedNumberTask 00 -pPHONE_ID=3105455335 -pCYCLE_ID=201908</p> <h2 id="批量押金缴欠费"><a href="#批量押金缴欠费" class="header-anchor">#</a> 批量押金缴欠费</h2> <h3 id="基本描述-basic-description-10"><a href="#基本描述-basic-description-10" class="header-anchor">#</a> 基本描述-basic description</h3> <p>批量押金缴欠费，预付费号码、销户号码或历史号码，可以用押金抵扣历史欠费；</p> <p>后台进程不支持历史号码，因为历史号码对应的多个历史账户。</p> <h3 id="业务流程-business-process-10"><a href="#业务流程-business-process-10" class="header-anchor">#</a> 业务流程-business process</h3> <p>进程接口：<em>asset_ITaskCSV_depositToPayOwe</em></p> <ol><li><p>扫描押金缴欠费后台数据表</p></li> <li><p>逐个调用<em>asset_ITaskCSV_depositToPayOwe</em>接口处理</p></li> <li><p>查询号码是否为预付费号码或销户号码，不是这两种则处理完成；</p></li> <li><p>查询号码和押金类型对应的押金数据，如果押金额度为0，则处理完成；</p></li> <li><p>查询号码的欠费数据，如果欠费为0，则处理完成；</p></li> <li><p>有押金和欠费的号码，做押金缴欠费业务；</p></li> <li><p>数据转移到押金缴欠费数据历史表；</p></li></ol> <h3 id="业务表说明-11"><a href="#业务表说明-11" class="header-anchor">#</a> 业务表说明</h3> <table><thead><tr><th>CEN.AM_BATCH_DEPOSIT_TOPAY</th> <th>押金缴欠费数据表</th></tr></thead> <tbody><tr><td>Ac1.am_deposit</td> <td>押金表</td></tr> <tr><td>ac1.AM_BILL_ITEM</td> <td>欠费信息</td></tr> <tr><td>ac1.AM_ACCT_DEBT_11</td> <td></td></tr> <tr><td>AC1.AM_BALANCE_11</td> <td></td></tr> <tr><td>APS_MDB的实时账单</td> <td></td></tr> <tr><td>Ac1.am_deposit_busi</td> <td>押金业务日志表</td></tr> <tr><td>Ac1.am_busi</td> <td>资金业务记录表</td></tr> <tr><td>Ac1.am_writeoff</td> <td>冲销日志表</td></tr></tbody></table> <h3 id="关键配置说明-10"><a href="#关键配置说明-10" class="header-anchor">#</a> 关键配置说明</h3> <p>select t.<em>,rowid from param.bs_work_order_conf T where ORDER_CODE='BatchDepositToPayOwe';</em>--asset_ITaskCSV_depositToPayOwe*</p> <p>select t.*,rowid from param.bs_work_order_channel T where ORDER_CODE ='BatchDepositToPayOwe';</p> <h2 id="批量退押金"><a href="#批量退押金" class="header-anchor">#</a> 批量退押金</h2> <h3 id="基本描述-basic-description-11"><a href="#基本描述-basic-description-11" class="header-anchor">#</a> 基本描述-basic description</h3> <p>批量押金缴欠费，预付费号码、销户号码或历史号码，可以用押金抵扣历史欠费；</p> <p>后台进程不支持历史号码，因为历史号码对应的多个历史账户。</p> <h3 id="业务流程-business-process-11"><a href="#业务流程-business-process-11" class="header-anchor">#</a> 业务流程-business process</h3> <p>进程接口：<em>asset_ITaskCSV_depositRefund</em></p> <ol><li><p>扫描批量退押金后台数据表</p></li> <li><p>逐个调用<em>asset_ITaskCSV_depositRefund</em>接口处理</p></li> <li><p>查询号码是否为预付费号码或销户号码，不是这两种则处理完成；</p></li> <li><p>查询号码和押金类型对应的押金数据，如果押金额度为0，则处理完成；</p></li> <li><p>查询号码的欠费数据，计算可退金额=押金总额-欠费总额；</p></li> <li><p>有押金的号码，做退押金业务；</p></li> <li><p>数据转移到批量退押金数据历史表；</p></li></ol> <h3 id="业务表说明-12"><a href="#业务表说明-12" class="header-anchor">#</a> 业务表说明</h3> <table><thead><tr><th>CEN.AM_BATCH_DEPOSIT_REFUND</th> <th>批量退押金数据表</th></tr></thead> <tbody><tr><td>Ac1.am_deposit</td> <td>押金表</td></tr> <tr><td>ac1.AM_BILL_ITEM</td> <td>欠费信息</td></tr> <tr><td>ac1.AM_ACCT_DEBT_11</td> <td></td></tr> <tr><td>AC1.AM_BALANCE_11</td> <td></td></tr> <tr><td>APS_MDB的实时账单</td> <td></td></tr> <tr><td>Ac1.am_deposit_busi</td> <td>押金业务日志表</td></tr></tbody></table> <h3 id="关键配置说明-11"><a href="#关键配置说明-11" class="header-anchor">#</a> 关键配置说明</h3> <p>select t.<em>,rowid from param.bs_work_order_conf T where ORDER_CODE='BatchDepositRefund';</em>--asset_ITaskCSV_depositRefund*</p> <p>select t.*,rowid from param.bs_work_order_channel T where ORDER_CODE ='BatchDepositRefund';</p> <h2 id="ntn退押金"><a href="#ntn退押金" class="header-anchor">#</a> NTN退押金</h2> <h3 id="基本描述-basic-description-12"><a href="#基本描述-basic-description-12" class="header-anchor">#</a> 基本描述-basic description</h3> <p>NTN集团的成员号码的退押金，要考虑整个NTN集团的欠费不能超出账本+剩余押金的额度；</p> <h3 id="业务流程-business-process-12"><a href="#业务流程-business-process-12" class="header-anchor">#</a> 业务流程-business process</h3> <p>进程接口：<em>asset_IDepositCSV_depositRefundTask</em></p> <ol><li><p>扫描NTN退押金任务表</p></li> <li><p>逐个调用<em>asset_IDepositCSV_depositRefundTask</em>接口处理</p></li> <li><p>查询NTN账单欠费查询任务表，是否有最近30分钟（可配置）的ntn欠费信息查询；</p></li> <li><p>若无记录，则新增一个NTN账单欠费查询任务，记录关联任务编号，本次扫描完成；</p></li> <li><p>后续再扫描到关联任务，查看状态是否为完成状态，若是则进行下一步；</p></li> <li><p>查询NTN账单欠费查询任务明细表的逐个号码退押金，保证每个号码的剩余押金+账本大于欠费，同时保证整个集团的剩余押金+账本大于欠费，记录业务表；</p></li> <li><p>数据转移到批量退押金数据历史表；</p></li></ol> <h3 id="业务表说明-13"><a href="#业务表说明-13" class="header-anchor">#</a> 业务表说明</h3> <p>| CEN.AM_NTN_DEPOSIT_TASK                           | NTN退押金任务表       |</p> <table><thead><tr><th>CEN.AM_NTN_DEPOSIT_TASK_DETAIL</th> <th></th></tr></thead> <tbody><tr><td>CEN.AM_NTN_TASK</td> <td>NTN账单欠费查询任务表</td></tr> <tr><td>CEN.AM_NTN_TASK_DETAILS</td> <td></td></tr> <tr><td>party.cb_enterprise</td> <td>NTN集团表</td></tr> <tr><td>party.cb_enterprise_dept party.cb_enterprise_mem</td> <td>NTN部门表</td></tr> <tr><td></td> <td>NTN成员表</td></tr> <tr><td>Ac1.am_deposit</td> <td>押金表</td></tr> <tr><td>ac1.AM_BILL_ITEM</td> <td>欠费信息</td></tr> <tr><td>ac1.AM_ACCT_DEBT_11</td> <td></td></tr> <tr><td>AC1.AM_BALANCE_11</td> <td></td></tr> <tr><td>APS_MDB的实时账单</td> <td></td></tr> <tr><td>Ac1.am_deposit_busi</td> <td>押金业务日志表</td></tr></tbody></table> <h3 id="关键配置说明-12"><a href="#关键配置说明-12" class="header-anchor">#</a> 关键配置说明</h3> <p><em>------NTN 退押金</em></p> <p>select t.<em>,t.rowid from param.bs_work_order_conf t where t.order_code = 'NTN_DEPOSIT_REFUND_TASK';</em>--asset_IDepositCSV_depositRefundTask*</p> <p>select t.*,t.rowid from param.BS_WORK_ORDER_CHANNEL t where t.order_code = 'NTN_DEPOSIT_REFUND_TASK';</p> <p><em>-------NTN 欠费查询</em></p> <p>select t.<em>,t.rowid from param.bs_work_order_conf t where t.order_code = 'NTN_BILL_QUERY_TASK%';</em>--asset_ITaskCSV_ntnBillQuery*</p> <p>select t.*,t.rowid from param.BS_WORK_ORDER_CHANNEL t where t.order_code = 'NTN_BILL_QUERY_TASK%';</p> <h1 id="李涛涛后台"><a href="#李涛涛后台" class="header-anchor">#</a> 李涛涛后台</h1> <h1 id="_1-员工缴费"><a href="#_1-员工缴费" class="header-anchor">#</a> 1. 员工缴费</h1> <div class="language- extra-class"><pre><code>1.  ## 基本描述-basic description
</code></pre></div><p>员工缴费是指给Cmpak 的员工进行充值或者扩充有效期。</p> <h2 id="业务流程-business-process-13"><a href="#业务流程-business-process-13" class="header-anchor">#</a> 业务流程-business process</h2> <ol><li><p>对应服务asset_ITaskCSV_empBatchPay</p></li> <li><p>从批量缴费记录表中获取最近3天的缴费记录数据，sql如下:</p> <p>SELECT A.*, A.ROWID FROM AM_BATCH_PAYMENT A,AM_BATCH_IMPORT B WHERE A.PARTITION_ID IN (:TODAY, :YESTERDAY, :PRE_DAY) AND A.BATCH_ID = B.BATCH_ID AND A.DEAL_FLAG = 'U' AND A.TRADE_TYPE_CODE = 9527 AND B.ACT_FLAG IN ('U','R')</p></li> <li><p>循环处理获取的记录，具体逻辑如下</p></li> <li><p>判断此员工是否已经缴费过了，如果已经缴过费就跳过，如果没有就缴费</p></li></ol> <p>Select t.*,t.rowid from cmpk_cen.am_emp_batch_pay_rec_201910 t where t.emp_id=3291;</p> <ol start="5"><li><p>查询三户，补齐业务资料，调用预付费充值接口进行缴费</p></li> <li><p>成功更新成功状态，回填缴费工单，失败更新失败原因和状态</p> <ol start="3"><li><h2 id="业务表说明-14"><a href="#业务表说明-14" class="header-anchor">#</a> 业务表说明</h2></li> <li><h2 id="关键配置说明-13"><a href="#关键配置说明-13" class="header-anchor">#</a> 关键配置说明</h2></li></ol></li></ol> <p>+--------------------------------------------------------------------------------------+
| select * from param.bs_work_order_conf t where t.order_code='EmpBatchPay';    |
|                                                                                      |
| select * from param.bs_work_order_channel t where t.order_code='EmpBatchPay'; |
+--------------------------------------------------------------------------------------+</p> <ol start="2"><li><h1 id="还款"><a href="#还款" class="header-anchor">#</a> 还款</h1> <ol><li><h2 id="基本描述-basic-description-13"><a href="#基本描述-basic-description-13" class="header-anchor">#</a> 基本描述-basic description</h2></li></ol></li></ol> <p>还款任务是对已经借过款的记录，进行还款操作。</p> <h2 id="业务流程-business-process-14"><a href="#业务流程-business-process-14" class="header-anchor">#</a> 业务流程-business process</h2> <ol><li><p>对应服务asset_IAdvanceLoanCSV_repaymentAdvance</p></li> <li><p>从缴费提醒表中获取最近3天的缴费记录数据，sql如下:</p> <p>select so_nbr,PARTITION_ID,busi_type,region_code,acct_id,phone_id,recv_cash,tax,bill_type,pay_date,ret_so_nbr,ret_pay_date,flag,9805 trade_op_id,90000000 trade_org_id,921 trade_county_code,921 trade_region_id,ROWID from am_recharge_advance_notify where flag=0 and PARTITION_ID IN (:TODAY, :YESTERDAY, :PRE_DAY)</p></li> <li><p>循环处理获取的记录，具体逻辑如下</p></li> <li><p>判断此号码是否有借款记录，如果没有直接移历史表，如果有则进行还款，查询是否有接口sql:</p></li></ol> <p>select t.*,rowid from ac8.am_adv_loan_dtl t where t.phone_id='3130518036';</p> <ol start="5"><li><p>判断缴费余额是否大于还款金额，如果小于则移历史表，如果大于则扣费</p></li> <li><p>成功则移历史表并记录还款工单，失败则更新记录状态为3</p> <p>历史表名：</p></li></ol> <p>--新系统的还款历史记录</p> <p>select t.*,rowid from ac8.AM_ADV_LOAN_DTL_HIS_201909 t where t.phone_id='3143352672';</p> <p>--借还款记录表</p> <p>select t.*,rowid from ac8.AM_ADV_LOAN_DTL_PUSH_201909 t where t.phone_id='3143352672';</p> <ol start="3"><li><h2 id="业务表说明-15"><a href="#业务表说明-15" class="header-anchor">#</a> 业务表说明</h2></li> <li><h2 id="关键配置说明-14"><a href="#关键配置说明-14" class="header-anchor">#</a> 关键配置说明</h2></li></ol> <p>+-------------------------------------------------------------------------------------------------+
| select * from param.bs_work_order_conf t where t.order_code='AdvanceLoanTask';           |
|                                                                                                 |
| select * from param.bs_work_order_channel t where t.order_code='AdvanceLoanTask';        |
|                                                                                                 |
| --老系统的借款和还款表                                                                         |
|                                                                                                 |
| select * from ac8.AM_AUTOLOAD t;                                                              |
|                                                                                                 |
| --新系统的借款表                                                                               |
|                                                                                                 |
| select t.<em>,rowid from ac8.am_adv_loan_dtl t where t.phone_id='3130518036';               |
|                                                                                                 |
| --新系统的还款历史记录                                                                         |
|                                                                                                 |
| select t.</em>,rowid from ac8.AM_ADV_LOAN_DTL_HIS_201909 t where t.phone_id='3143352672';  |
|                                                                                                 |
| --借还款记录表                                                                                 |
|                                                                                                 |
| select t.*,rowid from ac8.AM_ADV_LOAN_DTL_PUSH_201909 t where t.phone_id='3143352672'; |
+-------------------------------------------------------------------------------------------------+</p> <ol start="3"><li><h1 id="出账"><a href="#出账" class="header-anchor">#</a> 出账</h1> <ol start="5"><li><h2 id="邮寄账单-post-bill-task"><a href="#邮寄账单-post-bill-task" class="header-anchor">#</a> 邮寄账单-Post Bill Task</h2> <ol><li><h3 id="基本描述-basic-description-14"><a href="#基本描述-basic-description-14" class="header-anchor">#</a> 基本描述-basic description</h3></li></ol></li></ol></li></ol> <p>邮寄账单是指按照客户的定制化帐单类型，比如电子、短信、彩信、邮寄、纸质等，通过对应的渠道给客户下发定制化帐单的过程。</p> <p>Post bill refers to the process of sending customized bills to customers through corresponding channels according to their customized bill types, such as electronic, SMS, MMS, mail, paper, etc.</p> <h4 id="配置参数-configuration-parameter"><a href="#配置参数-configuration-parameter" class="header-anchor">#</a> 配置参数-Configuration Parameter</h4> <p>select * from cmpk_param.bs_sys_profiles t where t.profile_type='ACC_MAIL_BILL';--出账用到的参数</p> <p>select * from cmpk_param.bs_sys_profiles t where t.profile_type='ACC_TXT_BILL'; --txt账单用到的参数</p> <p>select * from cmpk_param.bs_sys_profiles t where t.profile_type='SEND_EMAIL'; --发送邮件用到的参数</p> <p>select * from cmpk_param.bs_static t where t.type_id='CORP_BILL_PLAN_GROUP'; --集团pdf用到的参数</p> <p>//折扣定义
//月租折扣: RENT_DISC定义到这个配置参数里DISCOUNT_ITEM
//月租折扣的折扣科目: 例如80503004这个科目定义到DISCOUNT_ITEM_RENT_DISC 这个配置参数里其他类同
//[XXX]折扣: [XXX]定义到这个配置参数里DISCOUNT_ITEM 结果为 RENT_DISC,[XXX]
//[XXX]折扣的折扣科目: 例如[dddddddd]这个科目定义到DISCOUNT_ITEM_[XXX] 这个配置参数里其他类同
String discountItem=configParamMap.get(&quot;DISCOUNT_ITEM&quot;);</p> <p>例子:则80503004 就是月租折扣的科目</p> <p>18 ACC_MAIL_BILL DISCOUNT_ITEM RENT_DISC ZZZZ 折扣科目类型定义</p> <p>19 ACC_MAIL_BILL DISCOUNT_ITEM_RENT_DISC 80503004 ZZZZ 月租折扣科目定义</p> <h4 id="使用到的表"><a href="#使用到的表" class="header-anchor">#</a> 使用到的表</h4> <p>出账用到的各个表的作用</p> <hr> <p>账单费用:<br>
AC.am_bill_ar_yyyyMM           出账费用原始数据
AC.am_abill_06                  按科目，付费账户，账户汇总 账户级费用 (包含代付费用)
AC.am_sbill_06                  按科目，付费账户，用户，账户，产品id汇总 用户级费用 (包含代付费用)
AC.am_a2sbill_06                按科目，付费账户，用户，账户汇总 账户级代付费用
AC.am_s2abill_06                按科目，付费账户，用户，账户汇总 用户级代付费用
AC.am_bqs_06                    用户级费用信息汇总
AC.am_bqa_06                    账户级费用信息汇总
cen.am_mail_main_201906        号码账单级信息
cen.am_mail_main_aux_201906   号码账单级信息
cen.AM_VPN_SUMMARY              集团业务记录数据沉淀表
cen.am_billing_number_list     txt账单出账号码状态表
cen.AM_VPN_BILL_201906         集团账单表
cen.AM_VPN_BILL_DTL_201906    集团账单扩展表
日志:<br>
cen.am_mail_main_log_2019     个人账单数据生成日志(只记录错误信息)
ac.am_mail_log_2019            txt账单文件生成日志(记录所有信息)
ac.am_email_log_2019           ebill账单文件生成日志(记录所有信息)
ac.am_dmail_log_2019           dup账单文件生成日志(记录所有信息)
cen.AM_VPN_BILL_LOG_201906    集团账单数据生成日志(只记录错误信息)
cen.am_ntn_mail_log            集团数据生成日志(只记录错误信息)
单个号码生成<br>
cen.am_single_phone_2019       个人账单生成和集团账单数据重新生成配置表(主键用户，月份，步骤)
cen.am_single_group_2019       集团账单文件重新生成配置表（主键是集团号码，类型，月份）
配置<br>
param.am_bill_itemcomp          账单format配置</p> <hr> <p>业务用到的关键表:</p> <hr> <p>AD.CA_DISCOUNT_REC_201906            折扣数据
AC.AM_BALANCE_06                      上月末账户余额按月分表
AC.AM_BUSI                             缴费记录表按PARTITION_ID查询
AC.AM_ACCT_DEBT_06                   上月末欠费按月分表
Crm1.um_mail_info_921                邮寄账单信息
Crm1.um_mail_info_his_921_201906   邮寄账单信息历史表
Crm1.UM_OFFER_921                     offer表
Crm1.UM_OFFER_HIS_921_201906        offer历史表
jf.dr_cs_post_20190508               后付费语音
jf.dr_ps_post_20190508               后付费流量
jf.dr_ismp_post_20190508             后付费彩信
jf.dr_sms_post_20190508              后付费短信
jf.dr_vpmn_post_20190508             后付费vpmn
jf.dr_cs_stat_post_new_201910      后付费语音详单统计
jf.dr_sms_stat_post_new_201910     后付费短信详单统计
jf.dr_ismp_stat_post_new_201910    后付费彩信详单统计
jf.dr_ps_stat_post_new_201910      后付费流量详单统计
jf.dr_vpmn_stat_post_new_201910    后付费vpmn详单统计
jf.dr_cs_max_dailed_new_201910     后付费打电话最多号码统计
crm1.um_price_plan_921               产品资费实例
upc.pm_offer                           Offer定义表
party.cb_enterprise                    NTN表
party.cb_enterprise_log               NTN历史表
party.cb_enterprise_dept              DEPT表
party.cb_enterprise_dept_log         DEPT历史表
party.cb_enterprise_mem               NTN成员表
party.cb_enterprise_mem_log          NTN成员历史表
cp.UM_SUBS_CONFIDENTIAL               NTN中敏感号码列表
qd.bboss_city_county                  county_code枚举翻译短名称
stat.CM_CUSTOMER_LEDGER_REPORT       缴费记录统计表
ad.ca_ext_data_his_0921_201906     账户region_id分表 201912月用这个表出外部费用
ac1.i_fee_cen_201912                 201901月之后的外部费用用账管表(因为remark有记录) 待议
cen.AM_FREERES_MON_06                周期性免费资源
cen.AM_OT_FREERES_MON_06            一次性免费资源</p> <hr> <h4 id="调用的接口"><a href="#调用的接口" class="header-anchor">#</a> 调用的接口</h4> <p>押金:asset_IDepositCSV_queryDeposit</p> <p>三户:order.IQueryScaInfosCSV.queryScaInfosBySubsInsId</p> <p>固话号码和手机号查询:order.IUmSubscriberCSV.qryFllGsmMap</p> <p>通过成员用户号获取改变VPMN的操作员名称:order.IVpmnInfoQryCSV.getVpmnNameForMeb</p> <p>各个表的序列:</p> <p>cen.am_mail_main_aux_201906:SEQ_MAIL_BILL_ID</p> <p>cen.am_mail_main_201906:SEQ_MAIL_BILL_ID</p> <p>cen.AM_VPN_BILL_201906:SEQ_VPN_BILL_ID</p> <p>cen.AM_VPN_BILL_DTL_201906:SEQ_VPN_BILL_ID</p> <h4 id="存储过程"><a href="#存储过程" class="header-anchor">#</a> 存储过程</h4> <p>套餐资费:get_plan_info_new</p> <p>跑详单统计的存储过程</p> <h3 id="单个号码生成介绍"><a href="#单个号码生成介绍" class="header-anchor">#</a> 单个号码生成介绍</h3> <p>Select * from cen.am_single_phone_2019;</p> <p>cen.am_single_phone_2019</p> <p>通过step来控制重跑的txt，ebill，dup，以及vpn data</p> <ol><li><p>MAIN_MAIN 2.TXT 文本 3.Duplicate PDF 4. Ebill Pdf 5. VPN DTL ,6 账单重发</p> <p>如果是1，则先跑哪个流程就生成哪个流程的数据</p> <p>如果是2，重新生成txt</p> <p>如果是3，重新生成DUP</p> <p>如果是4，重新生成EBill</p> <p>如果是5，重新生成VPN DATA</p> <p>如果是6，账单ebill重发</p> <p>Select * from cen.am_single_group_2019;</p> <p>cen.am_single_group_2019</p> <p>通过ntn_flag来控制生成哪种账单集团类型 id type</p> <p>1NTN_ID 2DEPT_ID 3CUST_NAME</p> <p>如果是1，重新生成NTN_ID</p> <p>如果是2，重新生成DEPT_ID</p> <p>如果是3，重新生成CUST_NAME</p> <p>日志目录:这里会把所有的ERROR目录集中的输出到这个目录</p> <p>/home/aifet/asset_bidui/data/postBillLog/201906</p> <ol start="3"><li><h3 id="业务流程-business-process-15"><a href="#业务流程-business-process-15" class="header-anchor">#</a> 业务流程-business process</h3></li></ol></li></ol> <p><img src="media/image2.png" alt=""></p> <ol start="5"><li><h4 id="clean-acount-user-bill"><a href="#clean-acount-user-bill" class="header-anchor">#</a> Clean Acount&amp;User bill</h4> <ol><li><h5 id="描述-description"><a href="#描述-description" class="header-anchor">#</a> 描述-description</h5></li></ol></li></ol> <p>删除账单生成的中间表AM_ABILL/AM_SBILL/AM_A2SBILL/AM_S2ABILL</p> <h5 id="流程-process"><a href="#流程-process" class="header-anchor">#</a> 流程-process</h5> <p>对应的代码入口类:com.ai.ac.core.bill.task.truncatetable.TruncateMonthBillInDBTask</p> <p>任务描述:</p> <p>清除8个库里的当月分区的AM_ABILL/AM_SBILL/AM_A2SBILL/AM_S2ABILL表</p> <ol start="6"><li><h4 id="gen-account-user-bill"><a href="#gen-account-user-bill" class="header-anchor">#</a> Gen Account&amp;User Bill</h4> <ol start="3"><li><h5 id="描述-description-2"><a href="#描述-description-2" class="header-anchor">#</a> 描述-description</h5></li></ol></li></ol> <p>将账单表按账户，用户，用户代付，账户代付拆分成四个部分。</p> <p>The billing table is divided into four parts: account, user, user pay-on-behalf and account pay-on-behalf.</p> <h5 id="流程-process-2"><a href="#流程-process-2" class="header-anchor">#</a> 流程-process</h5> <p>对应的代码入口类:com.ai.ac.core.bill.task.billimage.MonthBillInDBTask</p> <p>任务描述:</p> <ol><li><p>按账户id分表 AM_ABILL(账户级账单科目明细汇总),AM_A2SBILL(账户级代付账单科目明细汇总)</p></li> <li><p>按用户id分表AM_SBILL(用户级账单科目及OFFER明细汇总),AM_S2ABILL(用户级代付账单科目及OFFER明细汇总)</p> <ol start="7"><li><h4 id="clean-user-sum-bill"><a href="#clean-user-sum-bill" class="header-anchor">#</a> Clean User Sum Bill</h4> <ol start="5"><li><h5 id="描述-description-3"><a href="#描述-description-3" class="header-anchor">#</a> 描述-description</h5></li></ol></li></ol></li></ol> <p>清理AM_BQS(用户级账单汇总表)</p> <h5 id="流程-process-3"><a href="#流程-process-3" class="header-anchor">#</a> 流程-process</h5> <p>对应的代码入口类:com.ai.ac.core.bill.task.truncatetable.TruncateUserBillInfoTask</p> <p>任务描述:</p> <p>清理AM_BQS(用户级账单汇总表)</p> <ol start="8"><li><h4 id="gen-user-sum-bill"><a href="#gen-user-sum-bill" class="header-anchor">#</a> Gen User Sum bill</h4> <ol start="7"><li><h5 id="描述-description-4"><a href="#描述-description-4" class="header-anchor">#</a> 描述-description</h5></li></ol></li></ol> <p>汇总用户级费用，他人代付，账单级折扣等信息到一张表AM_BQS。</p> <p>Summarize user level fee, Paid by Others, acctount discount into one table.</p> <h5 id="流程-process-4"><a href="#流程-process-4" class="header-anchor">#</a> 流程-process</h5> <p>对应的代码入口类:com.ai.ac.core.bill.task.billimage.UserBillInfoTask</p> <p>任务描述:</p> <ol><li><p>从AM_SBILL(用户级账单科目及OFFER明细汇总),AM_S2ABILL(用户级代付账单科目及OFFER明细汇总)获取用户级账单信息和代付费用</p></li> <li><p>从帐处获取账单级折扣费用</p> <ol start="9"><li><h4 id="clean-account-sum-biil"><a href="#clean-account-sum-biil" class="header-anchor">#</a> Clean Account Sum BiIl</h4> <ol start="9"><li><h5 id="描述-description-5"><a href="#描述-description-5" class="header-anchor">#</a> 描述-description</h5></li></ol></li></ol></li></ol> <p>清理AM_BQA(账户级账单汇总表)</p> <h5 id="流程-process-5"><a href="#流程-process-5" class="header-anchor">#</a> 流程-process</h5> <p>对应的代码入口类:com.ai.ac.core.bill.task.truncatetable.TruncateAcctBillInfoTask</p> <p>任务描述:</p> <p>清理AM_BQA(账户级账单汇总表)</p> <ol start="10"><li><h4 id="gen-account-sum-bill"><a href="#gen-account-sum-bill" class="header-anchor">#</a> Gen Account Sum BIll</h4> <ol start="11"><li><h5 id="描述-description-6"><a href="#描述-description-6" class="header-anchor">#</a> 描述-description</h5></li></ol></li></ol> <p>汇总账户级费用，代他人付，余额，欠费，资金收入，费用明细等信息到一张表AM_BQA。</p> <p>Summarize account level fee, paid to others, balance, owe fee, asset income, fee details into one table.</p> <h5 id="流程-process-6"><a href="#流程-process-6" class="header-anchor">#</a> 流程-process</h5> <p>对应的代码入口类:com.ai.ac.core.bill.task.billimage.MonthBillInDBTask</p> <p>任务描述:</p> <ol><li><p>从AM_ABILL(账户级账单科目明细汇总),AM_A2SBILL(账户级代付账单科目明细汇总)获取账户级费用信息</p></li> <li><p>获取账户余额和欠费信息</p></li> <li><p>获取上个月缴费总额和最后缴费日期</p> <ol start="11"><li><h4 id="clean-invoice-data"><a href="#clean-invoice-data" class="header-anchor">#</a> Clean Invoice Data</h4> <ol start="13"><li><h5 id="描述-description-7"><a href="#描述-description-7" class="header-anchor">#</a> 描述-description</h5></li></ol></li></ol></li></ol> <p>清理AM_MAIL_MAIN_YYYYMM/AM_MAIL_MAIN_AUX_YYYYMM,</p> <p>AM_MAIL_MAIN_LOG_YYYY,AM_SINGLE_PHONE_YYYY STEP in (1,2,3,4)</p> <h5 id="流程-process-7"><a href="#流程-process-7" class="header-anchor">#</a> 流程-process</h5> <p>对应的代码入口类:com.ai.ac.core.bill.task.truncatetable.TruncateAcctBillInfoTask</p> <p>任务描述:</p> <p>清理AM_MAIL_MAIN_YYYYMM/AM_MAIL_MAIN_AUX_YYYYMM,</p> <p>AM_MAIL_MAIN_LOG_YYYY,AM_SINGLE_PHONE_YYYY STEP in (1,2,3,4)</p> <ol start="12"><li><h4 id="gen-invoice-data"><a href="#gen-invoice-data" class="header-anchor">#</a> Gen Invoice Data</h4> <ol start="15"><li><h5 id="描述-description-8"><a href="#描述-description-8" class="header-anchor">#</a> 描述-description</h5></li></ol></li></ol> <p>按用户生成最终账单文件数据,生成AM_MAIL_MAIN_YYYYMM/</p> <p>AM_MAIL_MAIN_AUX_YYYYMM/AM_MAIL_MAIN_LOG_YYYY</p> <h5 id="流程-process-8"><a href="#流程-process-8" class="header-anchor">#</a> 流程-process</h5> <p>对应的代码入口类:com.ai.ac.core.bill.task.cmpk.PerNumberTask</p> <p>任务描述:</p> <ol><li><p>从AM_BQS中获取查询的数据，遍历数据进行处理</p></li> <li><p>查询邮寄信息，账户级费用AM_BQA，查询押金信息，主产品</p></li> <li><p>如果邮寄信息不存在，则程序会自动补一条数据，备注为sys create YYYYMM</p></li> <li><p>通过脚本BILL_FORMAT_ID参数查到的模板汇总账单费用，通过账单配置重新计算账单费用和详单费用</p></li> <li><p>通过MONTH_BILL_FORMAT_ID和EXT_DATA_FORMAT_ID参数，格式化新版账单费用和老版外部费用</p></li> <li><p>调用存储过程获取套餐计费价格信息</p> <ol start="13"><li><h4 id="clean-txt-file-log"><a href="#clean-txt-file-log" class="header-anchor">#</a> Clean txt file log</h4> <ol start="17"><li><h5 id="描述-description-9"><a href="#描述-description-9" class="header-anchor">#</a> 描述-description</h5></li></ol></li></ol></li></ol> <p>清理邮寄账单am_mail_log_日志,清除am_single_phone_yyyy step=2</p> <h5 id="流程-process-9"><a href="#流程-process-9" class="header-anchor">#</a> 流程-process</h5> <p>对应的代码入口类:com.ai.ac.core.bill.task.truncatetable.TruncatePerNumberTxtTask</p> <p>任务描述:</p> <p>清理邮寄账单am_mail_log_日志,清除am_single_phone_yyyy step=2</p> <ol start="14"><li><h4 id="gen-invoice-file"><a href="#gen-invoice-file" class="header-anchor">#</a> Gen Invoice File</h4> <ol start="19"><li><h5 id="描述-description-10"><a href="#描述-description-10" class="header-anchor">#</a> 描述-description</h5></li></ol></li></ol> <p>生成邮寄账单TXT，生成log日志</p> <h5 id="流程-process-10"><a href="#流程-process-10" class="header-anchor">#</a> 流程-process</h5> <p>对应的代码入口类:com.ai.ac.core.bill.task.pdf.TxtBillTask</p> <p>任务描述:</p> <ol><li><p>从AM_MAIL_MAIN_YYYYMM中获取查询的数据，遍历数据进行处理</p></li> <li><p>查询邮寄信息，外部费用，免费资源，缴费统计信息，详单信息</p></li> <li><p>通过脚本OLD_FLAG=1来判断生成老账单还是新版账单</p></li> <li><p>生成的账单文件按账户取模分布在4台主机上，规则通过通道配置</p></li> <li><p>销户超过一个月不生成账单文件，日志记录记成功DETAIL_FLAGE记E</p></li> <li><p>账单金额小于Rs.5的不生成账单文件，日志记录记成功DETAIL_FLAGE记N</p></li> <li><p>根据DETAIL_FLAG判断是否生成详单，0和3不生成，1主叫，2被叫</p> <ol start="15"><li><h4 id="collect-txt-invoices"><a href="#collect-txt-invoices" class="header-anchor">#</a> Collect txt invoices</h4> <ol start="21"><li><h5 id="描述-description-11"><a href="#描述-description-11" class="header-anchor">#</a> 描述-description</h5></li></ol></li></ol></li></ol> <p>归并TXT账单到同一个FTP主机</p> <h5 id="流程-process-11"><a href="#流程-process-11" class="header-anchor">#</a> 流程-process</h5> <p>对应的代码入口类:com.ai.ac.core.bill.task.collect.CollectTxtBillTask</p> <p>任务描述:</p> <p>将/data01/acttask/data/postBill/201912/TXT/目录下的文件发送到14主机/data02/acttask/data/dolist/201912目录下，如果成功就备份到/data01/acttask/data/postBill_FINAL/201912/TXT/</p> <ol start="16"><li><h4 id="check-invoice-data-missing"><a href="#check-invoice-data-missing" class="header-anchor">#</a> Check Invoice Data missing</h4> <ol start="23"><li><h5 id="描述-description-12"><a href="#描述-description-12" class="header-anchor">#</a> 描述-description</h5></li></ol></li></ol> <p>检查AM_MAIL_MAIN_AUX表看有无遗漏AM_BILL_AR的数,如果有遗漏生成am_single_phone_yyyy step=1</p> <h5 id="流程-process-12"><a href="#流程-process-12" class="header-anchor">#</a> 流程-process</h5> <p>对应的代码入口类:com.ai.ac.core.bill.task.checkdata.CheckPerNumberDataTask</p> <p>任务描述:</p> <ol><li><p>计算AM_MAIL_MAIN_AUX和AM_BILL_AR表的用户数量，如果相等，则表明不需要补数据，如果不相等，若差异数量等于AM_MAIL_MAIN_LOG_2019表当月的数量时，则通过这个错误日志记录补数据，如果也不相等，则通过两个表的差异数据补数据，AM_BILL_AR表用的是统计库的数据。需要补生成的数据放到am_single_phone_yyyy表里，且STEP=1</p></li> <li><p>将统计的结果发送短信给相关人员。</p> <ol start="17"><li><h4 id="check-invoice-file-missing"><a href="#check-invoice-file-missing" class="header-anchor">#</a> Check Invoice File missing</h4> <ol start="25"><li><h5 id="描述-description-13"><a href="#描述-description-13" class="header-anchor">#</a> 描述-description</h5></li></ol></li></ol></li></ol> <p>检查未生成文本账单的号码,记录到am_single_phone_yyyy表step=2</p> <h5 id="流程-process-13"><a href="#流程-process-13" class="header-anchor">#</a> 流程-process</h5> <p>对应的代码入口类:com.ai.ac.core.bill.task.checkdata.CheckTxtBillTask</p> <p>任务描述:</p> <ol><li><p>计算AM_MAIL_MAIN_AUX的数量和am_mail_log_YYYY表的成功用户数量，如果相等，则表明不需要补数据，如果不相等，若差异数量等于am_mail_log_YYYY表当月的错误数量时，则通过这个错误日志记录补数据，如果也不相等，则通过两个表的差异数据补数据，am_mail_log_YYYY表用的是统计库的数据.需要补生成的数据放到am_single_phone_yyyy表里，且STEP=2</p></li> <li><p>将统计的结果发送短信给相关人员。</p> <ol start="18"><li><h4 id="send-mail-notify"><a href="#send-mail-notify" class="header-anchor">#</a> Send Mail Notify</h4> <ol start="27"><li><h5 id="描述-description-14"><a href="#描述-description-14" class="header-anchor">#</a> 描述-description</h5></li></ol></li></ol></li></ol> <p>把生成文本账单的号码及plan info写入CEN.AM_BILLING_NUMBER_LIST表并发邮件提醒做账单检查</p> <h5 id="流程-process-14"><a href="#流程-process-14" class="header-anchor">#</a> 流程-process</h5> <p>对应的代码入口类:com.ai.ac.core.bill.task.collect.SendTxtMailTask</p> <p>任务描述:</p> <ol><li><p>am_mail_main_YYYYMM生成CEN.AM_BILLING_NUMBER_LIST表记录</p></li> <li><p>发送邮件告知客户和PSO TXT账单生成完毕，可以检查账单了。</p> <ol start="19"><li><h4 id="regenerate-txt-file"><a href="#regenerate-txt-file" class="header-anchor">#</a> Regenerate Txt file</h4> <ol start="29"><li><h5 id="描述-description-15"><a href="#描述-description-15" class="header-anchor">#</a> 描述-description</h5></li></ol></li></ol></li></ol> <p>重新生成漏掉的Txt账单</p> <h5 id="流程-process-15"><a href="#流程-process-15" class="header-anchor">#</a> 流程-process</h5> <p>对应的代码入口类:com.ai.ac.core.bill.task.single.SinglePhoneBillTask</p> <p>任务描述:</p> <ol><li><p>查询am_single_phone_yyyy表里STEP等于1和2的数据</p></li> <li><p>补齐三户信息，删除原来表的数据重新生成AM_BQA_12,AM_BQS_12,</p> <p>AM_MAIL_MAIN_201912,AM_MAIL_MAIN_AUX_201912,AM_MAIL_MAIN_LOG_2019，AC1.AM_MAIL_LOG_2019,重新生成txt账单文件，并修改AM_SINGLE_PHONE的状态，执行结果以及执行时间。</p> <ol start="20"><li><h4 id="clean-dmail-log"><a href="#clean-dmail-log" class="header-anchor">#</a> Clean dmail_log</h4> <ol start="31"><li><h5 id="描述-description-16"><a href="#描述-description-16" class="header-anchor">#</a> 描述-description</h5></li></ol></li></ol></li></ol> <p>清理邮寄账单am_dmail_log_日志和am_single_phone_yyyy表中step=3的数据</p> <h5 id="流程-process-16"><a href="#流程-process-16" class="header-anchor">#</a> 流程-process</h5> <p>对应的代码入口类:com.ai.ac.core.bill.task.truncatetable.TruncatePerNumberDupTask</p> <p>任务描述:</p> <p>清理邮寄账单am_dmail_log_日志和am_single_phone_yyyy表中step=3的数据</p> <ol start="21"><li><h4 id="gen-dupbill-pdf"><a href="#gen-dupbill-pdf" class="header-anchor">#</a> Gen DupBIll PDF</h4> <ol start="33"><li><h5 id="描述-description-17"><a href="#描述-description-17" class="header-anchor">#</a> 描述-description</h5></li></ol></li></ol> <p>生成Duplicate PDF，生成log日志</p> <h5 id="流程-process-17"><a href="#流程-process-17" class="header-anchor">#</a> 流程-process</h5> <p>对应的代码入口类:com.ai.ac.core.bill.task.pdf.SendEmailDupTask</p> <p>任务描述:</p> <ol><li><p>从AM_MAIL_MAIN_YYYYMM中获取查询的数据，遍历数据进行处理</p></li> <li><p>查询邮寄信息，外部费用，免费资源，缴费统计信息，详单信息</p></li> <li><p>通过主套餐来判断生成哪种账单账单(GMS,PRI,FIX_LINE)</p></li> <li><p>生成的账单文件直接按账户取模分布在4台主机的/data01/acttask/data/postBill_FINAL/201912/DUP目录下</p></li> <li><p>所有的用户都要生成DUP账单和详单</p> <ol start="22"><li><h4 id="check-invoice-file-missing-2"><a href="#check-invoice-file-missing-2" class="header-anchor">#</a> Check Invoice File missing</h4> <ol start="35"><li><h5 id="描述-description-18"><a href="#描述-description-18" class="header-anchor">#</a> 描述-description</h5></li></ol></li></ol></li></ol> <p>检查未生成Duplicate PDF账单的号码记录到am_single_phone_yyyy表step=3</p> <h5 id="流程-process-18"><a href="#流程-process-18" class="header-anchor">#</a> 流程-process</h5> <p>对应的代码入口类:com.ai.ac.core.bill.task.checkdata.CheckDupPdfTask</p> <p>任务描述:</p> <ol><li><p>计算AM_MAIL_MAIN_AUX的数量和am_dmail_log_YYYY表的成功用户数量，如果相等，则表明不需要补数据，如果不相等，若差异数量等于am_dmail_log_YYYY表当月的错误数量时，则通过这个错误日志记录补数据，如果也不相等，则通过两个表的差异数据补数据，am_dmail_log_YYYY表用的是统计库的数据.需要补生成的数据放到am_single_phone_yyyy表里，且STEP=3</p></li> <li><p>将统计的结果发送短信给相关人员。</p> <ol start="23"><li><h4 id="regerate-single-number-dup-pdf"><a href="#regerate-single-number-dup-pdf" class="header-anchor">#</a> Regerate single number DUP PDF</h4> <ol start="37"><li><h5 id="描述-description-19"><a href="#描述-description-19" class="header-anchor">#</a> 描述-description</h5></li></ol></li></ol></li></ol> <p>重新生成漏掉的Duplicate PDF账单</p> <h5 id="流程-process-19"><a href="#流程-process-19" class="header-anchor">#</a> 流程-process</h5> <p>对应的代码入口类:com.ai.ac.core.bill.task.single.SinglePhoneDupPdfTask</p> <p>任务描述:</p> <ol start="3"><li><p>查询am_single_phone_yyyy表里STEP等于1和3的数据</p></li> <li><p>补齐三户信息，删除原来表的数据重新生成AM_BQA_12,AM_BQS_12,</p> <p>AM_MAIL_MAIN_201912,AM_MAIL_MAIN_AUX_201912,AM_MAIL_MAIN_LOG_2019，AC1.AM_DMAIL_LOG_2019,重新生成duplicate pdf账单文件，并修改AM_SINGLE_PHONE的状态，执行结果以及执行时间。</p> <ol start="24"><li><h4 id="clean-email-log"><a href="#clean-email-log" class="header-anchor">#</a> Clean email_log</h4> <ol start="39"><li><h5 id="描述-description-20"><a href="#描述-description-20" class="header-anchor">#</a> 描述-description</h5></li></ol></li></ol></li></ol> <p>清理邮寄账单am_email_log_日志和am_single_phone_yyyy表中step=4的数据</p> <h5 id="流程-process-20"><a href="#流程-process-20" class="header-anchor">#</a> 流程-process</h5> <p>对应的代码入口类:com.ai.ac.core.bill.task.truncatetable.TruncatePerNumberPdfTask</p> <p>任务描述:</p> <p>清理邮寄账单am_email_log_日志和am_single_phone_yyyy表中step=4的数据</p> <ol start="25"><li><h4 id="gen-ebill-pdf"><a href="#gen-ebill-pdf" class="header-anchor">#</a> Gen Ebill Pdf</h4> <ol start="41"><li><h5 id="描述-description-21"><a href="#描述-description-21" class="header-anchor">#</a> 描述-description</h5></li></ol></li></ol> <p>生成Ebill PDF，生成log日志</p> <h5 id="流程-process-21"><a href="#流程-process-21" class="header-anchor">#</a> 流程-process</h5> <p>对应的代码入口类:com.ai.ac.core.bill.task.pdf.SendEmailEbillTask</p> <p>任务描述:</p> <ol><li><p>从AM_MAIL_MAIN_YYYYMM中获取查询的数据，遍历数据进行处理</p></li> <li><p>查询邮寄信息，外部费用，免费资源，缴费统计信息，详单信息</p></li> <li><p>通过主套餐来判断生成哪种账单账单(GMS,PRI,FIX_LINE)</p></li> <li><p>生成的账单文件按账户取模分布在4台主机的/data01/acttask/data/postBill/201912/PDF目录下</p></li> <li><p>有数据就有账单，根据POS_MODE 的第3位是否为1来判断是否生成详单</p> <ol start="26"><li><h4 id="collect-and-send-ebill"><a href="#collect-and-send-ebill" class="header-anchor">#</a> Collect And Send Ebill</h4> <ol start="43"><li><h5 id="描述-description-22"><a href="#描述-description-22" class="header-anchor">#</a> 描述-description</h5></li></ol></li></ol></li></ol> <p>归并Ebill账单，并发送邮件</p> <h5 id="流程-process-22"><a href="#流程-process-22" class="header-anchor">#</a> 流程-process</h5> <p>对应的代码入口类:com.ai.ac.core.bill.task.collect.CollectAndSendEbillTask</p> <p>任务描述:</p> <ol><li><p>遍历账单文件目录，根据文件名获取手机号，然后查询对应的邮寄信息</p></li> <li><p>根据查询的信息，拼接邮件内容，先插入邮件表，然后再将账单文件移到/data01/acttask/data/postBill_FINAL/201912/PDF</p> <ol start="27"><li><h4 id="check-ebill-pdf-file"><a href="#check-ebill-pdf-file" class="header-anchor">#</a> Check Ebill Pdf file</h4> <ol start="45"><li><h5 id="描述-description-23"><a href="#描述-description-23" class="header-anchor">#</a> 描述-description</h5></li></ol></li></ol></li></ol> <p>检查未生成Ebill PDF账单的号码记录到am_single_phone_yyyy表step=4</p> <h5 id="流程-process-23"><a href="#流程-process-23" class="header-anchor">#</a> 流程-process</h5> <p>对应的代码入口类:com.ai.ac.core.bill.task.checkdata.CheckEbillPdfTask</p> <p>任务描述:</p> <ol><li><p>计算AM_MAIL_MAIN_AUX的数量和am_email_log_YYYY表的成功用户数量，如果相等，则表明不需要补数据，如果不相等，若差异数量等于am_email_log_YYYY表当月的错误数量时，则通过这个错误日志记录补数据，如果也不相等，则通过两个表的差异数据补数据，am_email_log_YYYY表用的是统计库的数据.需要补生成的数据放到am_single_phone_yyyy表里，且STEP=4</p></li> <li><p>将统计的结果发送短信给相关人员。</p> <ol start="28"><li><h4 id="regenerate-ebill"><a href="#regenerate-ebill" class="header-anchor">#</a> Regenerate Ebill</h4> <ol start="47"><li><h5 id="描述-description-24"><a href="#描述-description-24" class="header-anchor">#</a> 描述-description</h5></li></ol></li></ol></li></ol> <p>重新生成漏掉的Ebill PDF账单</p> <h5 id="流程-process-24"><a href="#流程-process-24" class="header-anchor">#</a> 流程-process</h5> <p>对应的代码入口类:com.ai.ac.core.bill.task.single.SinglePhoneEbillPdfBillTask</p> <p>任务描述:</p> <ol><li><p>查询am_single_phone_yyyy表里STEP等于1和4的数据</p></li> <li><p>补齐三户信息，删除原来表的数据重新生成AM_BQA_12,AM_BQS_12,</p> <p>AM_MAIL_MAIN_201912,AM_MAIL_MAIN_AUX_201912,AM_MAIL_MAIN_LOG_2019，AC1.AM_EMAIL_LOG_2019,重新生成ebill pdf账单文件，并修改AM_SINGLE_PHONE的状态，执行结果以及执行时间。</p> <ol start="29"><li><h4 id="clean-ntn-log-am-vpn-summary"><a href="#clean-ntn-log-am-vpn-summary" class="header-anchor">#</a> Clean NTN_LOG&amp;AM_VPN_SUMMARY</h4> <ol start="49"><li><h5 id="描述-description-25"><a href="#描述-description-25" class="header-anchor">#</a> 描述-description</h5></li></ol></li></ol></li></ol> <p>清理NTN_LOG和AM_VPN_SUMMARY,AM_SINGLE_GROUP_YYYY</p> <h5 id="流程-process-25"><a href="#流程-process-25" class="header-anchor">#</a> 流程-process</h5> <p>对应的代码入口类:com.ai.ac.core.bill.task.truncatetable.TruncateNTNLogTask</p> <p>任务描述:</p> <p>清理NTN_LOG和AM_VPN_SUMMARY,AM_SINGLE_GROUP_YYYY</p> <ol start="30"><li><h4 id="gen-ntn-pdf"><a href="#gen-ntn-pdf" class="header-anchor">#</a> Gen NTN PDF</h4> <ol start="51"><li><h5 id="描述-description-26"><a href="#描述-description-26" class="header-anchor">#</a> 描述-description</h5></li></ol></li></ol> <p>生成NTN_ID PDF，生成log日志</p> <h5 id="流程-process-26"><a href="#流程-process-26" class="header-anchor">#</a> 流程-process</h5> <p>对应的代码入口类:com.ai.ac.core.bill.task.pdf.NtnEmailTask -pGROUP_TYPE=NTN</p> <p>任务描述:</p> <ol><li><p>从集团信息表里查询出这个月内有效过的数据，遍历数据进行处理</p></li> <li><p>查询AM_VPN_BILL_YYYYMM表中当前NTN_ID是否有2条以上的数据，如果有才生产账单</p></li> <li><p>查询敏感用户表，如果有号码在里面则生成两份账单，一个包含敏感号码，一个不包含敏感号码，否则只生成一种PDF文件，并记录日志到AM_NTN_MAIL_LOG_YYYY表ntn_flag=1</p></li> <li><p>生成的文件放到/data02/acttask/data/postBill/201912/GROUP/NTN目录下</p> <ol start="31"><li><h4 id="gen-dept-pdf"><a href="#gen-dept-pdf" class="header-anchor">#</a> Gen Dept PDF</h4> <ol start="53"><li><h5 id="描述-description-27"><a href="#描述-description-27" class="header-anchor">#</a> 描述-description</h5></li></ol></li></ol></li></ol> <p>生成DEPT PDF，生成log日志</p> <h5 id="流程-process-27"><a href="#流程-process-27" class="header-anchor">#</a> 流程-process</h5> <p>对应的代码入口类:com.ai.ac.core.bill.task.pdf.NtnEmailTask -pGROUP_TYPE=DEPT</p> <p>任务描述:</p> <ol><li><p>从集团信息表里查询出这个月内有效过的数据，遍历数据进行处理</p></li> <li><p>查询AM_VPN_BILL_DTL_YYYYMM表中当前DEPT_ID是否有数据，如果有才生产账单</p></li> <li><p>查询敏感用户表，如果有号码在里面则生成两份账单，一个包含敏感号码，一个不包含敏感号码，否则只生成一种PDF文件，并记录日志到AM_NTN_MAIL_LOG_YYYY表 ntn_flag=2</p></li> <li><p>生成的文件放到/data02/acttask/data/postBill/201912/GROUP/DEPT目录下</p> <ol start="32"><li><h4 id="gen-cust-name-pdf"><a href="#gen-cust-name-pdf" class="header-anchor">#</a> Gen Cust Name PDF</h4> <ol start="55"><li><h5 id="描述-description-28"><a href="#描述-description-28" class="header-anchor">#</a> 描述-description</h5></li></ol></li></ol></li></ol> <p>生成CUSTNAME PDF，生成log日志</p> <h5 id="流程-process-28"><a href="#流程-process-28" class="header-anchor">#</a> 流程-process</h5> <p>对应的代码入口类:com.ai.ac.core.bill.task.pdf.NtnEmailTask</p> <p>-pGROUP_TYPE=CUSTNAME</p> <p>任务描述:</p> <ol><li><p>查询AM_VPN_BILL_YYYYMM表中cust_name有2条以上的数据的记录进行遍历</p></li> <li><p>查询敏感用户表，如果有号码在里面则生成两份账单，一个包含敏感号码，一个不包含敏感号码，否则只生成一种PDF文件</p></li> <li><p>生成的文件放到/data02/acttask/data/postBill/201912/GROUP/CUST_NAME目录下</p> <ol start="33"><li><h4 id="collect-ntn-pdf"><a href="#collect-ntn-pdf" class="header-anchor">#</a> Collect NTN PDF</h4> <ol start="57"><li><h5 id="描述-description-29"><a href="#描述-description-29" class="header-anchor">#</a> 描述-description</h5></li></ol></li></ol></li></ol> <p>归集集团账单到16主机</p> <h5 id="流程-process-29"><a href="#流程-process-29" class="header-anchor">#</a> 流程-process</h5> <p>对应的代码入口类:com.ai.ac.core.bill.task.collect.CollectNTNTask</p> <p>任务描述:</p> <p>遍历账单文件目录，发送集团账单文件到16主机/data02/acttask/data/postBill_FINAL/</p> <p>201912/GROUP这个目录下，其他主机的账单文件会备份到/data02/acttask/data/postBill_FINAL/201912/GROUP这个目录下，16主机的账单文件会从/data02/acttask/data/postBill/201912/GROUP目录mv到/data02/acttask/data/</p> <p>postBill_FINAL/201912/GROUP目录下，所有16主机生成的账单只存在一份，其他主机生成的账单有2份</p> <ol start="34"><li><h4 id="check-ntn-bill-data"><a href="#check-ntn-bill-data" class="header-anchor">#</a> Check NTN Bill Data</h4> <ol start="59"><li><h5 id="描述-description-30"><a href="#描述-description-30" class="header-anchor">#</a> 描述-description</h5></li></ol></li></ol> <p>检查AM_VPN_DTL_YYYYMM表看有无遗漏AM_BILL_AR的数据检查，生成am_single_phone_yyyy step=5</p> <h5 id="流程-process-30"><a href="#流程-process-30" class="header-anchor">#</a> 流程-process</h5> <p>对应的代码入口类:com.ai.ac.core.bill.task.checkdata.CheckVPNDataTask</p> <p>任务描述:</p> <ol><li><p>计算AM_VPN_BILL_DTL_YYYYMM和AM_BILL_AR表的用户数量，如果相等，则表明不需要补数据，如果不相等，若差异数量等于AM_VPN_BILL_LOG_2019表当月的数量时，则通过这个错误日志记录补数据，如果也不相等，则通过两个表的差异数据补数据，AM_BILL_AR表用的是统计库的数据。需要补生成的数据放到am_single_phone_yyyy表里，且STEP=5</p></li> <li><p>将统计的结果发送短信给相关人员。</p> <ol start="35"><li><h4 id="check-ntn-pdf"><a href="#check-ntn-pdf" class="header-anchor">#</a> Check NTN PDF</h4> <ol start="61"><li><h5 id="描述-description-31"><a href="#描述-description-31" class="header-anchor">#</a> 描述-description</h5></li></ol></li></ol></li></ol> <p>检查log日志与AM_VPN_DTL_YYYYMM比是否有遗漏，生成am_single_group_yyyy</p> <h5 id="流程-process-31"><a href="#流程-process-31" class="header-anchor">#</a> 流程-process</h5> <p>对应的代码入口类:com.ai.ac.core.bill.task.checkdata.CheckVPNPDFTask</p> <p>任务描述:</p> <ol><li><p>计算AM_VPN_BILL_YYYY按NTN_ID group by 数量大于2的NTN_ID数量和am_ntn_mail_log_YYYY表ntn_flag=1的成功用户数量，如果相等，则表明不需要补数据，如果不相等，若差异数量等于am_ntn_mail_log_YYYY表ntn_flag=1当月的错误数量时，则通过这个错误日志记录补数据，如果也不相等，则通过两个表的差异数据补数据.需要补生成的数据放到am_single_group_yyyy表里，ntn_flag=1</p></li> <li><p>计算AM_VPN_BILL_DTL_YYYY按DEPT_ID group by 的DEPT_ID数量和am_ntn_mail_log_YYYY表ntn_flag=2的成功用户数量，如果相等，则表明不需要补数据，如果不相等，若差异数量等于am_ntn_mail_log_YYYY表ntn_flag=2当月的错误数量时，则通过这个错误日志记录补数据，如果也不相等，则通过两个表的差异数据补数据.需要补生成的数据放到am_single_group_yyyy表里，ntn_flag=2</p></li> <li><p>计算AM_VPN_BILL_YYYY按CUST_NAME group by 数量大于2的CUST_NAME数量和am_ntn_mail_log_YYYY表ntn_flag=3的成功用户数量，如果相等，则表明不需要补数据，如果不相等，若差异数量等于am_ntn_mail_log_YYYY表ntn_flag=3当月的错误数量时，则通过这个错误日志记录补数据，如果也不相等，则通过两个表的差异数据补数据.需要补生成的数据放到am_single_group_yyyy表里，ntn_flag=3</p></li> <li><p>将统计的结果发送短信给相关人员。</p> <ol start="36"><li><h4 id="regenerate-ntn-data"><a href="#regenerate-ntn-data" class="header-anchor">#</a> Regenerate NTN Data</h4> <ol start="63"><li><h5 id="描述-description-32"><a href="#描述-description-32" class="header-anchor">#</a> 描述-description</h5></li></ol></li></ol></li></ol> <p>重新生成漏掉的集团数据</p> <h5 id="流程-process-32"><a href="#流程-process-32" class="header-anchor">#</a> 流程-process</h5> <p>对应的代码入口类:com.ai.ac.core.bill.task.single.SingleVpnDataTask</p> <p>任务描述:</p> <ol start="3"><li><p>查询am_single_phone_yyyy表里STEP等于5的数据</p></li> <li><p>补齐三户信息，删除原来表的数据重新生成AM_BQA_12,AM_BQS_12,</p> <p>AM_VPN_BILL_201912,AM_VPN_BILL_DTL_201912,AM_VPN_BILL_LOG_2019，如果是NTN号码，则需要将判断AM_SINGLE_GROUP表中是否有这个类型的NTN数据，如果有就更新，如果没有就插入，完成后并修改AM_SINGLE_PHONE的状态，执行结果以及执行时间。</p> <ol start="37"><li><h4 id="regenerate-ntn-pdf-file"><a href="#regenerate-ntn-pdf-file" class="header-anchor">#</a> Regenerate NTN PDF file</h4> <ol start="65"><li><h5 id="描述-description-33"><a href="#描述-description-33" class="header-anchor">#</a> 描述-description</h5></li></ol></li></ol></li></ol> <p>重新生成漏掉的集团PDF</p> <h5 id="流程-process-33"><a href="#流程-process-33" class="header-anchor">#</a> 流程-process</h5> <p>对应的代码入口类:com.ai.ac.core.bill.task.single.SingleVpnPdfTask</p> <p>任务描述:</p> <ol><li><p>查询am_single_group_yyyy表里的数据</p></li> <li><p>根据NTN_FLAG类型调用不同处理类进行处理，生成对应的PDF后，并修改AM_SINGLE_PHONE的状态，执行结果以及执行时间。</p> <ol start="38"><li><h4 id="resend-email-bill"><a href="#resend-email-bill" class="header-anchor">#</a> Resend Email Bill</h4> <ol start="67"><li><h5 id="描述-description-34"><a href="#描述-description-34" class="header-anchor">#</a> 描述-description</h5></li></ol></li></ol></li></ol> <p>重发账单生成</p> <h5 id="流程-process-34"><a href="#流程-process-34" class="header-anchor">#</a> 流程-process</h5> <p>对应的代码入口类:com.ai.ac.core.bill.task.single.SingleResendEmailTask</p> <p>任务描述:</p> <ol><li><p>客户通过前台界面申请账单重发，录入账单重复数据到am_single_phone_yyyy表</p></li> <li><p>后台任务查询am_single_phone_yyyy表里STEP等于6的数据</p></li> <li><p>补齐三户信息，删除原来表的数据根据AM_MAIL_MAIN_201912,</p> <p>AM_MAIL_MAIN_AUX_201912表重新生成AC1.AM_EMAIL_LOG_2019,重新生成ebill pdf账单文件，并修改AM_SINGLE_PHONE的状态，执行结果以及执行时间，账单文件生成到/data02/acttask/data/postBill/201912/RESEND目录</p></li> <li><p>归集/data02/acttask/data/postBill/201912/RESEND账单到/data02/acttask/data</p> <p>/postBill_FINAL/201912/PDF目录下，并插入到邮寄表，成功后，修改重发账单数据信息。</p></li></ol></div> <footer class="page-edit"><div class="edit-link"><a href="http://8.208.26.203:18082/cmpak/acctmanm/edit/develop/doc/zh/assetcenter/后台设计文档.md" target="_blank" rel="noopener noreferrer">在 Gogs 上编辑此页</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/acct-doc/zh/assetcenter/前台设计文档.html" class="prev">
        前台设计文档
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/acct-doc/assets/js/app.63ad57cc.js" defer></script><script src="/acct-doc/assets/js/2.33beb707.js" defer></script><script src="/acct-doc/assets/js/10.3a0026ee.js" defer></script>
  </body>
</html>
