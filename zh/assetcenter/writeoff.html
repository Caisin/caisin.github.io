<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>抵扣 | CMPAK 账管文档</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="CMPAK 账管交维文档">
    
    <link rel="preload" href="/acct-doc/assets/css/0.styles.51d143cd.css" as="style"><link rel="preload" href="/acct-doc/assets/js/app.63ad57cc.js" as="script"><link rel="preload" href="/acct-doc/assets/js/2.33beb707.js" as="script"><link rel="preload" href="/acct-doc/assets/js/9.bbaf23c7.js" as="script"><link rel="prefetch" href="/acct-doc/assets/js/10.3a0026ee.js"><link rel="prefetch" href="/acct-doc/assets/js/11.37b0e332.js"><link rel="prefetch" href="/acct-doc/assets/js/12.aeeb4d1b.js"><link rel="prefetch" href="/acct-doc/assets/js/13.ac323191.js"><link rel="prefetch" href="/acct-doc/assets/js/14.bd2cb70d.js"><link rel="prefetch" href="/acct-doc/assets/js/15.e224db95.js"><link rel="prefetch" href="/acct-doc/assets/js/16.1706826f.js"><link rel="prefetch" href="/acct-doc/assets/js/17.d60e9805.js"><link rel="prefetch" href="/acct-doc/assets/js/18.b7a13350.js"><link rel="prefetch" href="/acct-doc/assets/js/19.cf8e7b1d.js"><link rel="prefetch" href="/acct-doc/assets/js/20.105e9797.js"><link rel="prefetch" href="/acct-doc/assets/js/21.b3600cfd.js"><link rel="prefetch" href="/acct-doc/assets/js/22.fc9c31d9.js"><link rel="prefetch" href="/acct-doc/assets/js/23.63486421.js"><link rel="prefetch" href="/acct-doc/assets/js/24.206d6f32.js"><link rel="prefetch" href="/acct-doc/assets/js/25.fcfed3db.js"><link rel="prefetch" href="/acct-doc/assets/js/26.9c2a70ba.js"><link rel="prefetch" href="/acct-doc/assets/js/27.a56776c7.js"><link rel="prefetch" href="/acct-doc/assets/js/28.f3ad07db.js"><link rel="prefetch" href="/acct-doc/assets/js/29.b5b0f0f5.js"><link rel="prefetch" href="/acct-doc/assets/js/3.e252b8df.js"><link rel="prefetch" href="/acct-doc/assets/js/30.3b82be60.js"><link rel="prefetch" href="/acct-doc/assets/js/31.7cfde945.js"><link rel="prefetch" href="/acct-doc/assets/js/32.b0420cfa.js"><link rel="prefetch" href="/acct-doc/assets/js/33.9208bbca.js"><link rel="prefetch" href="/acct-doc/assets/js/34.1ef2f7cc.js"><link rel="prefetch" href="/acct-doc/assets/js/35.f00cf5a4.js"><link rel="prefetch" href="/acct-doc/assets/js/36.c8d22bd6.js"><link rel="prefetch" href="/acct-doc/assets/js/37.a8d4eb5f.js"><link rel="prefetch" href="/acct-doc/assets/js/4.6f4dd1f9.js"><link rel="prefetch" href="/acct-doc/assets/js/5.1dee15cb.js"><link rel="prefetch" href="/acct-doc/assets/js/6.6d4ac80a.js"><link rel="prefetch" href="/acct-doc/assets/js/7.e14e4b70.js"><link rel="prefetch" href="/acct-doc/assets/js/8.36259b9a.js">
    <link rel="stylesheet" href="/acct-doc/assets/css/0.styles.51d143cd.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/acct-doc/" class="home-link router-link-active"><!----> <span class="site-name">CMPAK 账管文档</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/acct-doc/zh/" class="nav-link router-link-active">
  首页
</a></div><div class="nav-item"><a href="/acct-doc/zh/deploy/" class="nav-link">
  发布
</a></div><div class="nav-item"><a href="/acct-doc/zh/environment/" class="nav-link">
  环境
</a></div><div class="nav-item"><a href="/acct-doc/zh/db/" class="nav-link">
  数据脚本
</a></div><div class="nav-item"><a href="/acct-doc/zh/cache/" class="nav-link">
  缓存
</a></div><div class="nav-item"><a href="/acct-doc/zh/param/" class="nav-link">
  参数
</a></div><div class="nav-item"><a href="/acct-doc/zh/assetcenter/" class="nav-link router-link-active">
  资产中心
</a></div><div class="nav-item"><a href="http://172.25.132.86:9000/cmpk-api/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CSF 服务
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/acct-doc/zh/assetcenter/writeoff.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="/acct-doc/en/" class="nav-link">
  English
</a></li></ul></div></div> <a href="http://8.208.26.203:18082/cmpak/acctmanm" target="_blank" rel="noopener noreferrer" class="repo-link">
    Source
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/acct-doc/zh/" class="nav-link router-link-active">
  首页
</a></div><div class="nav-item"><a href="/acct-doc/zh/deploy/" class="nav-link">
  发布
</a></div><div class="nav-item"><a href="/acct-doc/zh/environment/" class="nav-link">
  环境
</a></div><div class="nav-item"><a href="/acct-doc/zh/db/" class="nav-link">
  数据脚本
</a></div><div class="nav-item"><a href="/acct-doc/zh/cache/" class="nav-link">
  缓存
</a></div><div class="nav-item"><a href="/acct-doc/zh/param/" class="nav-link">
  参数
</a></div><div class="nav-item"><a href="/acct-doc/zh/assetcenter/" class="nav-link router-link-active">
  资产中心
</a></div><div class="nav-item"><a href="http://172.25.132.86:9000/cmpk-api/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CSF 服务
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/acct-doc/zh/assetcenter/writeoff.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="/acct-doc/en/" class="nav-link">
  English
</a></li></ul></div></div> <a href="http://8.208.26.203:18082/cmpak/acctmanm" target="_blank" rel="noopener noreferrer" class="repo-link">
    Source
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>资产中心</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/acct-doc/zh/assetcenter/" aria-current="page" class="sidebar-link">资产中心</a></li><li><a href="/acct-doc/zh/assetcenter/interface.html" class="sidebar-link">接口出入参</a></li><li><a href="/acct-doc/zh/assetcenter/writeoff.html" aria-current="page" class="active sidebar-link">抵扣</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/writeoff.html#step1-拉取s文件" class="sidebar-link">step1 拉取S文件</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/writeoff.html#step2-s文件稽核" class="sidebar-link">step2 S文件稽核</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/writeoff.html#step3-s文件入库" class="sidebar-link">step3 S文件入库</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/writeoff.html#setp4-生成欠费表-账本和0缴费工单" class="sidebar-link">setp4 生成欠费表/账本和0缴费工单</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/writeoff.html#业务限制" class="sidebar-link">业务限制 :</a></li></ul></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/writeoff.html#step5-修改账期状态" class="sidebar-link">step5 修改账期状态</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/writeoff.html#step6-客户核查期间" class="sidebar-link">step6 客户核查期间</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/writeoff.html#业务限制-2" class="sidebar-link">业务限制 :</a></li></ul></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/writeoff.html#step5-月初0缴费工单处理完成" class="sidebar-link">step5 月初0缴费工单处理完成</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/writeoff.html#业务限制-3" class="sidebar-link">业务限制 :</a></li></ul></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/writeoff.html#回退机制" class="sidebar-link">回退机制</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/writeoff.html#_5号前回退" class="sidebar-link">5号前回退</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/writeoff.html#_5号后回退" class="sidebar-link">5号后回退</a></li></ul></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/writeoff.html#后台脚本地址" class="sidebar-link">后台脚本地址</a></li><li class="sidebar-sub-header"><a href="/acct-doc/zh/assetcenter/writeoff.html#出账比对sql" class="sidebar-link">出账比对sql</a></li></ul></li><li><a href="/acct-doc/zh/assetcenter/前台设计文档.html" class="sidebar-link">前台设计文档</a></li><li><a href="/acct-doc/zh/assetcenter/后台设计文档.html" class="sidebar-link">后台设计文档</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="抵扣"><a href="#抵扣" class="header-anchor">#</a> 抵扣</h1> <p></p><div class="table-of-contents"><ul><li><a href="#step1-拉取s文件">step1 拉取S文件</a></li><li><a href="#step2-s文件稽核">step2 S文件稽核</a></li><li><a href="#step3-s文件入库">step3 S文件入库</a></li><li><a href="#setp4-生成欠费表-账本和0缴费工单">setp4 生成欠费表/账本和0缴费工单</a><ul><li><a href="#业务限制">业务限制 :</a></li></ul></li><li><a href="#step5-修改账期状态">step5 修改账期状态</a></li><li><a href="#step6-客户核查期间">step6 客户核查期间</a><ul><li><a href="#业务限制">业务限制 :</a></li></ul></li><li><a href="#step5-月初0缴费工单处理完成">step5 月初0缴费工单处理完成</a><ul><li><a href="#业务限制">业务限制 :</a></li></ul></li><li><a href="#回退机制">回退机制</a><ul><li><a href="#_5号前回退">5号前回退</a></li><li><a href="#_5号后回退">5号后回退</a></li></ul></li><li><a href="#后台脚本地址">后台脚本地址</a></li><li><a href="#出账比对sql">出账比对sql</a></li></ul></div><p></p> <p>流程图</p> <p><img src="/acct-doc/assets/img/DBM.52a22f3b.png" alt="image-201912301229078"></p> <div class="language- extra-class"><pre><code> 进入一号,账期自动切到20状态
 等待计费生成账单的S文件
</code></pre></div><h2 id="step1-拉取s文件"><a href="#step1-拉取s文件" class="header-anchor">#</a> step1 拉取S文件</h2> <div class="language- extra-class"><pre><code> 将计费生成的s文件拉到账管主机
</code></pre></div><h2 id="step2-s文件稽核"><a href="#step2-s文件稽核" class="header-anchor">#</a> step2 S文件稽核</h2> <div class="language- extra-class"><pre class="language-text"><code>通过billing给的total.log文件的统计数据 跟S文件的作比较,金额和记录数对上就判断校验成功
</code></pre></div><h2 id="step3-s文件入库"><a href="#step3-s文件入库" class="header-anchor">#</a> step3 S文件入库</h2> <div class="language- extra-class"><pre><code>通过S生成入库
am_bill_ar_yyyymm
am_bill_item
</code></pre></div><h2 id="setp4-生成欠费表-账本和0缴费工单"><a href="#setp4-生成欠费表-账本和0缴费工单" class="header-anchor">#</a> setp4 生成欠费表/账本和0缴费工单</h2> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">--am_acct_debt_mm 通过sql sum生成</span>
<span class="token comment">--am_balance_mm </span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> am_balance_11 <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> am_balance_10 <span class="token keyword">where</span> trade_date<span class="token operator">&lt;</span>to_date<span class="token punctuation">(</span><span class="token string">'20191101000000'</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="业务限制"><a href="#业务限制" class="header-anchor">#</a> 业务限制 :</h3> <ol><li><p><s>撤单</s></p> <blockquote><p>账本在搬迁,不能撤单</p></blockquote></li> <li><p>缴费</p> <blockquote><p>入账会入上月和当前月账本am_balance表,只入账,不销账,也不插销账工单</p></blockquote></li> <li><p>转账</p></li> <li><p>调账</p> <blockquote><p>不允许调当月生成的账单</p></blockquote></li> <li><p><s>预存清退</s></p> <blockquote><p>账本在搬迁,不能清退</p></blockquote></li></ol> <h2 id="step5-修改账期状态"><a href="#step5-修改账期状态" class="header-anchor">#</a> step5 修改账期状态</h2> <div class="language- extra-class"><pre><code>账单和欠费文件入库完成将am_cycle表状态修改为3  
</code></pre></div><h2 id="step6-客户核查期间"><a href="#step6-客户核查期间" class="header-anchor">#</a> step6 客户核查期间</h2> <div class="language- extra-class"><pre><code>客户核查账单是否有误,核查完成将账期状态改为2  
状态修改成功,开始启动月初0缴费销账工单
</code></pre></div><h3 id="业务限制-2"><a href="#业务限制-2" class="header-anchor">#</a> 业务限制 :</h3> <ol><li><p>缴费</p> <blockquote><p>同步缴费 判断是否有未处理工单,有工单则插入工单,否则直接销账</p></blockquote></li> <li><p>撤单</p> <blockquote><p>3状态,有工单不允许撤单</p></blockquote></li> <li><p>转账</p> <blockquote><p>可以转,但有工单不允许转出</p></blockquote></li> <li><p><s>调账</s>???</p></li> <li><p>预存清退</p> <blockquote><p>有工单不允许清退</p></blockquote></li></ol> <h2 id="step5-月初0缴费工单处理完成"><a href="#step5-月初0缴费工单处理完成" class="header-anchor">#</a> step5 月初0缴费工单处理完成</h2> <div class="language- extra-class"><pre><code> 修改账期状态为4
</code></pre></div><h3 id="业务限制-3"><a href="#业务限制-3" class="header-anchor">#</a> 业务限制 :</h3> <p>20状态: 查两个月实时账单 账本缴费入往月和实时月</p> <p>状态变化时间:月初自动切20</p> <p>不支持:</p> <p>调账本,转账,撤单,清退,销账</p> <p>支持:</p> <p>缴费</p> <p>3状态: 只查一个月实时账单,账本只入实时月</p> <p>状态变化时间:入账单完成切</p> <p>不支持:</p> <p>调当月账单,销账</p> <p>半支持</p> <p>转账(存在销账工单,不允许转账)</p> <p>支持:</p> <p>缴费,调往月账单,调账本,撤单,清退(是否5号以后在做清退)</p> <p>以上两个状态缴费生成4106工单,20账本入两个月,3只入一个月,有的话不生成</p> <p>当月入库账单不能调账</p> <p>2状态: 缴费可以销账,但是要判断是否存在4106的0缴费工单,不存在直接销账,存在不销账</p> <p>状态变化时间: 客户核查完成,开始4106销账时候切</p> <p>当前状态&lt;=2</p> <p>不支持:</p> <p>半支持</p> <p>转账(存在销账工单,不予许转账)</p> <p>支持:</p> <p>缴费,调账单,调账本,撤单,清退(是否5号以后在做清退),销账</p> <p>1状态: 4106销账工单结束,直接销账,不判断是否存在4106工单</p> <p>状态变化时间:4106销账工单结束</p> <p>无限制</p> <h2 id="回退机制"><a href="#回退机制" class="header-anchor">#</a> 回退机制</h2> <h3 id="_5号前回退"><a href="#_5号前回退" class="header-anchor">#</a> 5号前回退</h3> <h4 id="部分撤单"><a href="#部分撤单" class="header-anchor">#</a> 部分撤单</h4> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">--1. 配置需要撤单的账户,可配置多条,账户间用逗号&quot;,&quot;</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> BS_SYS_PROFILES <span class="token keyword">where</span> PROFILE_TYPE<span class="token operator">=</span><span class="token string">'PPY_TARGET_ACCT_IDS'</span><span class="token punctuation">;</span>
<span class="token comment">-- 2. 启动et 的 WriteOffReverseTask</span>
</code></pre></div><h4 id="全量回退"><a href="#全量回退" class="header-anchor">#</a> 全量回退</h4> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">--去掉部分撤单的参数配置</span>
<span class="token keyword">delete</span> <span class="token keyword">from</span> BS_SYS_PROFILES <span class="token keyword">where</span> PROFILE_TYPE<span class="token operator">=</span><span class="token string">'PPY_TARGET_ACCT_IDS'</span><span class="token punctuation">;</span>
<span class="token comment">-- 2. 启动et 的 WriteOffReverseTask</span>
</code></pre></div><h4 id="回退某个中心"><a href="#回退某个中心" class="header-anchor">#</a> 回退某个中心</h4> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token comment">#et配置 新增启动参数</span>
<span class="token attr-name">TARGET_CENTERS</span><span class="token punctuation">=</span><span class="token attr-value">1,2,3,4,5,6,7,8</span>
</code></pre></div><p><img src="/acct-doc/assets/img/ReverseParamConfig.6fbe7f82.png" alt="image-ReverseParamConfig"></p> <h3 id="_5号后回退"><a href="#_5号后回退" class="header-anchor">#</a> 5号后回退</h3> <h4 id="单个撤单"><a href="#单个撤单" class="header-anchor">#</a> 单个撤单</h4> <div class="language- extra-class"><pre class="language-text"><code>根据0缴费的流水,缴费返销页面撤单
删掉该账户错误账单
</code></pre></div><h4 id="批量撤单"><a href="#批量撤单" class="header-anchor">#</a> 批量撤单</h4> <div class="language- extra-class"><pre><code>批量导出4106的流水,通过批量返销工单撤单
删掉入库账单,通过新的S文件重新入库
</code></pre></div><h2 id="后台脚本地址"><a href="#后台脚本地址" class="header-anchor">#</a> 后台脚本地址</h2> <div class="language-http extra-class"><pre class="language-http"><code><span class="token header-name keyword">http:</span>//git.wadecn.com:18084/hekx/assetprocess-script.git
</code></pre></div><h2 id="出账比对sql"><a href="#出账比对sql" class="header-anchor">#</a> 出账比对sql</h2> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">--统计库查询 出账账户数</span>
<span class="token keyword">select</span> <span class="token function">sum</span><span class="token punctuation">(</span>cc<span class="token punctuation">)</span> <span class="token keyword">from</span> <span class="token punctuation">(</span>
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token keyword">distinct</span> acct_id<span class="token punctuation">)</span> cc <span class="token keyword">from</span> ac1<span class="token punctuation">.</span>am_bill_ar_201912 <span class="token keyword">group</span> <span class="token keyword">by</span> acct_id <span class="token keyword">union</span> <span class="token keyword">all</span>
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token keyword">distinct</span> acct_id<span class="token punctuation">)</span> cc <span class="token keyword">from</span> ac2<span class="token punctuation">.</span>am_bill_ar_201912 <span class="token keyword">group</span> <span class="token keyword">by</span> acct_id <span class="token keyword">union</span> <span class="token keyword">all</span>
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token keyword">distinct</span> acct_id<span class="token punctuation">)</span> cc <span class="token keyword">from</span> ac3<span class="token punctuation">.</span>am_bill_ar_201912 <span class="token keyword">group</span> <span class="token keyword">by</span> acct_id <span class="token keyword">union</span> <span class="token keyword">all</span>
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token keyword">distinct</span> acct_id<span class="token punctuation">)</span> cc <span class="token keyword">from</span> ac4<span class="token punctuation">.</span>am_bill_ar_201912 <span class="token keyword">group</span> <span class="token keyword">by</span> acct_id <span class="token keyword">union</span> <span class="token keyword">all</span>
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token keyword">distinct</span> acct_id<span class="token punctuation">)</span> cc <span class="token keyword">from</span> ac5<span class="token punctuation">.</span>am_bill_ar_201912 <span class="token keyword">group</span> <span class="token keyword">by</span> acct_id <span class="token keyword">union</span> <span class="token keyword">all</span>
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token keyword">distinct</span> acct_id<span class="token punctuation">)</span> cc <span class="token keyword">from</span> ac6<span class="token punctuation">.</span>am_bill_ar_201912 <span class="token keyword">group</span> <span class="token keyword">by</span> acct_id <span class="token keyword">union</span> <span class="token keyword">all</span>
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token keyword">distinct</span> acct_id<span class="token punctuation">)</span> cc <span class="token keyword">from</span> ac7<span class="token punctuation">.</span>am_bill_ar_201912 <span class="token keyword">group</span> <span class="token keyword">by</span> acct_id <span class="token keyword">union</span> <span class="token keyword">all</span>
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token keyword">distinct</span> acct_id<span class="token punctuation">)</span> cc <span class="token keyword">from</span> ac8<span class="token punctuation">.</span>am_bill_ar_201912 <span class="token keyword">group</span> <span class="token keyword">by</span> acct_id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">--统计库查询  出账用户数</span>
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token keyword">distinct</span> subscriber_id<span class="token punctuation">)</span> <span class="token keyword">from</span> <span class="token punctuation">(</span>
<span class="token keyword">select</span> subscriber_id  <span class="token keyword">from</span> ac1<span class="token punctuation">.</span>am_bill_ar_201912 <span class="token keyword">group</span> <span class="token keyword">by</span> subscriber_id <span class="token keyword">union</span> <span class="token keyword">all</span>
<span class="token keyword">select</span> subscriber_id  <span class="token keyword">from</span> ac2<span class="token punctuation">.</span>am_bill_ar_201912 <span class="token keyword">group</span> <span class="token keyword">by</span> subscriber_id <span class="token keyword">union</span> <span class="token keyword">all</span>
<span class="token keyword">select</span> subscriber_id  <span class="token keyword">from</span> ac3<span class="token punctuation">.</span>am_bill_ar_201912 <span class="token keyword">group</span> <span class="token keyword">by</span> subscriber_id <span class="token keyword">union</span> <span class="token keyword">all</span>
<span class="token keyword">select</span> subscriber_id  <span class="token keyword">from</span> ac4<span class="token punctuation">.</span>am_bill_ar_201912 <span class="token keyword">group</span> <span class="token keyword">by</span> subscriber_id <span class="token keyword">union</span> <span class="token keyword">all</span>
<span class="token keyword">select</span> subscriber_id  <span class="token keyword">from</span> ac5<span class="token punctuation">.</span>am_bill_ar_201912 <span class="token keyword">group</span> <span class="token keyword">by</span> subscriber_id <span class="token keyword">union</span> <span class="token keyword">all</span>
<span class="token keyword">select</span> subscriber_id  <span class="token keyword">from</span> ac6<span class="token punctuation">.</span>am_bill_ar_201912 <span class="token keyword">group</span> <span class="token keyword">by</span> subscriber_id <span class="token keyword">union</span> <span class="token keyword">all</span>
<span class="token keyword">select</span> subscriber_id  <span class="token keyword">from</span> ac7<span class="token punctuation">.</span>am_bill_ar_201912 <span class="token keyword">group</span> <span class="token keyword">by</span> subscriber_id <span class="token keyword">union</span> <span class="token keyword">all</span>
<span class="token keyword">select</span> subscriber_id  <span class="token keyword">from</span> ac8<span class="token punctuation">.</span>am_bill_ar_201912 <span class="token keyword">group</span> <span class="token keyword">by</span> subscriber_id<span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">--生成账单数据用户数</span>
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> cen<span class="token punctuation">.</span>am_mail_main_201912<span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> cen<span class="token punctuation">.</span>am_mail_main_aux_201912<span class="token punctuation">;</span>
<span class="token comment">--账单数据失败数量</span>
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> cen<span class="token punctuation">.</span>am_mail_main_log_2019 t <span class="token keyword">where</span> t<span class="token punctuation">.</span>bill_month<span class="token operator">=</span><span class="token number">201912</span><span class="token punctuation">;</span>
<span class="token comment">--单个号码补得数据数量</span>
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span>  cen<span class="token punctuation">.</span>am_single_phone_2019 t <span class="token keyword">where</span> t<span class="token punctuation">.</span>bill_month<span class="token operator">=</span><span class="token number">201912</span><span class="token operator">and</span> t<span class="token punctuation">.</span>step<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>


<span class="token comment">--txt账单数量</span>
<span class="token comment">--success 账单txt真正生成的数量</span>
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> stat<span class="token punctuation">.</span>am_mail_log_2019 t <span class="token keyword">where</span>  t<span class="token punctuation">.</span>POS_MONTH<span class="token operator">=</span><span class="token number">201912</span> <span class="token operator">and</span> t<span class="token punctuation">.</span>REMARKS <span class="token operator">=</span><span class="token string">'S'</span> <span class="token operator">and</span> t<span class="token punctuation">.</span>DETAIL_FLAG<span class="token operator">!=</span><span class="token string">'E'</span> <span class="token operator">and</span> t<span class="token punctuation">.</span>DETAIL_FLAG<span class="token operator">!=</span><span class="token string">'N'</span><span class="token punctuation">;</span>
<span class="token comment">--差异的数据</span>
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> stat<span class="token punctuation">.</span>am_mail_log_2019 t <span class="token keyword">where</span>  t<span class="token punctuation">.</span>POS_MONTH<span class="token operator">=</span><span class="token number">201912</span> <span class="token operator">and</span> <span class="token punctuation">(</span>t<span class="token punctuation">.</span>REMARKS <span class="token operator">!=</span><span class="token string">'S'</span> <span class="token operator">or</span> t<span class="token punctuation">.</span>DETAIL_FLAG<span class="token operator">=</span><span class="token string">'E'</span> <span class="token operator">or</span> t<span class="token punctuation">.</span>DETAIL_FLAG<span class="token operator">=</span><span class="token string">'N'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">--blocked</span>
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> stat<span class="token punctuation">.</span>am_mail_log_2019 t <span class="token keyword">where</span>  t<span class="token punctuation">.</span>POS_MONTH<span class="token operator">=</span><span class="token number">201912</span> <span class="token operator">and</span> t<span class="token punctuation">.</span>REMARKS <span class="token operator">=</span><span class="token string">'S'</span> <span class="token operator">and</span> t<span class="token punctuation">.</span>DETAIL_FLAG<span class="token operator">=</span><span class="token string">'E'</span><span class="token punctuation">;</span>
<span class="token comment">--fee less then Rs. 5</span>
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> stat<span class="token punctuation">.</span>am_mail_log_2019 t <span class="token keyword">where</span>  t<span class="token punctuation">.</span>POS_MONTH<span class="token operator">=</span><span class="token number">201912</span> <span class="token operator">and</span> t<span class="token punctuation">.</span>REMARKS <span class="token operator">=</span><span class="token string">'S'</span> <span class="token operator">and</span> t<span class="token punctuation">.</span>DETAIL_FLAG<span class="token operator">=</span><span class="token string">'N'</span><span class="token punctuation">;</span>
<span class="token comment">--单个号码补得数据数量</span>
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span>  cen<span class="token punctuation">.</span>am_single_phone_2019 t <span class="token keyword">where</span> t<span class="token punctuation">.</span>bill_month<span class="token operator">=</span><span class="token number">201912</span> <span class="token operator">and</span> t<span class="token punctuation">.</span>step<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span>


<span class="token comment">--发送邮件 给客户的数据</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> cen<span class="token punctuation">.</span>am_billing_number_list<span class="token punctuation">;</span>








<span class="token comment">--ebill 数量校验</span>
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">as</span> cc <span class="token keyword">from</span> cen<span class="token punctuation">.</span>am_mail_main_aux_201912<span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">as</span> cc <span class="token keyword">from</span> stat<span class="token punctuation">.</span>am_email_log_2019 t <span class="token keyword">where</span> t<span class="token punctuation">.</span>POS_MONTH<span class="token operator">=</span><span class="token number">201912</span> <span class="token operator">and</span> t<span class="token punctuation">.</span>REMARKS<span class="token operator">=</span><span class="token string">'S'</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">as</span> cc <span class="token keyword">from</span> stat<span class="token punctuation">.</span>am_email_log_2019 t <span class="token keyword">where</span> t<span class="token punctuation">.</span>POS_MONTH<span class="token operator">=</span><span class="token number">201912</span> <span class="token operator">and</span> t<span class="token punctuation">.</span>REMARKS<span class="token operator">!=</span><span class="token string">'S'</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> cen<span class="token punctuation">.</span>am_single_phone_2019 t <span class="token keyword">where</span> t<span class="token punctuation">.</span>bill_month<span class="token operator">=</span><span class="token number">201912</span> <span class="token operator">and</span> t<span class="token punctuation">.</span>step<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">;</span>

<span class="token comment">--dup数量</span>
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">as</span> cc <span class="token keyword">from</span> cen<span class="token punctuation">.</span>am_mail_main_aux_201912<span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">as</span> cc <span class="token keyword">from</span> stat<span class="token punctuation">.</span>am_dmail_log_2019 t <span class="token keyword">where</span> t<span class="token punctuation">.</span>POS_MONTH<span class="token operator">=</span><span class="token number">201912</span> <span class="token operator">and</span> t<span class="token punctuation">.</span>REMARKS<span class="token operator">=</span><span class="token string">'S'</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">as</span> cc <span class="token keyword">from</span> stat<span class="token punctuation">.</span>am_dmail_log_2019 t <span class="token keyword">where</span> t<span class="token punctuation">.</span>POS_MONTH<span class="token operator">=</span><span class="token number">201912</span> <span class="token operator">and</span> t<span class="token punctuation">.</span>REMARKS<span class="token operator">!=</span><span class="token string">'S'</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> cen<span class="token punctuation">.</span>am_single_phone_2019 t <span class="token keyword">where</span> t<span class="token punctuation">.</span>bill_month<span class="token operator">=</span><span class="token number">201912</span> <span class="token operator">and</span> t<span class="token punctuation">.</span>step<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">;</span>



<span class="token comment">--NTN DATA</span>
<span class="token comment">--成功生成的数量</span>
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> cen<span class="token punctuation">.</span>am_vpn_bill_dtl_201912<span class="token punctuation">;</span>
<span class="token comment">--失败的数量</span>
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span>  <span class="token keyword">from</span> cen<span class="token punctuation">.</span>AM_VPN_BILL_LOG_2019 t <span class="token keyword">where</span> t<span class="token punctuation">.</span>bill_month<span class="token operator">=</span><span class="token number">201912</span><span class="token punctuation">;</span>
<span class="token comment">--需要补得数据量</span>
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span>  cen<span class="token punctuation">.</span>am_single_phone_2019 t <span class="token keyword">where</span> t<span class="token punctuation">.</span>bill_month<span class="token operator">=</span><span class="token number">201912</span> <span class="token operator">and</span> t<span class="token punctuation">.</span>step<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">;</span>


<span class="token comment">--NTN PDF 数量</span>
<span class="token comment">--应该生成的数量</span>
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> cmpk_cen<span class="token punctuation">.</span>am_vpn_bill_201906 t <span class="token keyword">group</span> <span class="token keyword">by</span> t<span class="token punctuation">.</span>ntn_id <span class="token keyword">having</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">--成功的数量</span>
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> cen<span class="token punctuation">.</span>am_ntn_mail_log t <span class="token keyword">where</span> ntn_flag<span class="token operator">=</span><span class="token number">1</span> <span class="token operator">and</span> t<span class="token punctuation">.</span>remarks<span class="token operator">=</span><span class="token string">'S'</span> <span class="token operator">and</span> t<span class="token punctuation">.</span>pos_month<span class="token operator">=</span><span class="token string">'201912'</span><span class="token punctuation">;</span>
<span class="token comment">--失败的数量</span>
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> cen<span class="token punctuation">.</span>am_ntn_mail_log t <span class="token keyword">where</span> ntn_flag<span class="token operator">=</span><span class="token number">1</span> <span class="token operator">and</span> t<span class="token punctuation">.</span>remarks<span class="token operator">!=</span><span class="token string">'S'</span> <span class="token operator">and</span> t<span class="token punctuation">.</span>pos_month<span class="token operator">=</span><span class="token string">'201912'</span><span class="token punctuation">;</span>
<span class="token comment">--补得数据</span>
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> cen<span class="token punctuation">.</span>am_single_group_2019 t <span class="token keyword">where</span> t<span class="token punctuation">.</span>ntn_flag<span class="token operator">=</span><span class="token number">1</span> <span class="token operator">and</span> t<span class="token punctuation">.</span>bill_month<span class="token operator">=</span><span class="token number">201912</span><span class="token punctuation">;</span>

<span class="token comment">--DEPT PDF</span>
<span class="token comment">--应该生成的数量</span>
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> dept_id<span class="token punctuation">,</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> cen<span class="token punctuation">.</span>am_vpn_bill_dtl_201912 t <span class="token keyword">group</span> <span class="token keyword">by</span> t<span class="token punctuation">.</span>dept_id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">--成功的数量</span>
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> cen<span class="token punctuation">.</span>am_ntn_mail_log t <span class="token keyword">where</span> ntn_flag<span class="token operator">=</span><span class="token number">2</span> <span class="token operator">and</span> t<span class="token punctuation">.</span>remarks<span class="token operator">=</span><span class="token string">'S'</span> <span class="token operator">and</span> t<span class="token punctuation">.</span>pos_month<span class="token operator">=</span><span class="token string">'201912'</span><span class="token punctuation">;</span>
<span class="token comment">--失败的数量</span>
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> cen<span class="token punctuation">.</span>am_ntn_mail_log t <span class="token keyword">where</span> ntn_flag<span class="token operator">=</span><span class="token number">2</span> <span class="token operator">and</span> t<span class="token punctuation">.</span>remarks<span class="token operator">!=</span><span class="token string">'S'</span> <span class="token operator">and</span> t<span class="token punctuation">.</span>pos_month<span class="token operator">=</span><span class="token string">'201912'</span><span class="token punctuation">;</span>
<span class="token comment">--补得数据</span>
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> cen<span class="token punctuation">.</span>am_single_group_2019 t <span class="token keyword">where</span> t<span class="token punctuation">.</span>ntn_flag<span class="token operator">=</span><span class="token number">2</span> <span class="token operator">and</span> t<span class="token punctuation">.</span>bill_month<span class="token operator">=</span><span class="token number">201912</span><span class="token punctuation">;</span>

<span class="token comment">--CUST_NAME</span>
<span class="token comment">--应该生成的数量</span>
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span> CC <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> t<span class="token punctuation">.</span>cust_name<span class="token punctuation">,</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> cmpk_cen<span class="token punctuation">.</span>am_vpn_bill_201906 t <span class="token keyword">where</span> t<span class="token punctuation">.</span>cust_name <span class="token operator">is</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">group</span> <span class="token keyword">by</span> cust_name <span class="token keyword">having</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">1</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">--成功的数量</span>
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> cen<span class="token punctuation">.</span>am_ntn_mail_log t <span class="token keyword">where</span> ntn_flag<span class="token operator">=</span><span class="token number">3</span> <span class="token operator">and</span> t<span class="token punctuation">.</span>remarks<span class="token operator">=</span><span class="token string">'S'</span> <span class="token operator">and</span> t<span class="token punctuation">.</span>pos_month<span class="token operator">=</span><span class="token string">'201912'</span><span class="token punctuation">;</span>
<span class="token comment">--失败的数量</span>
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> cen<span class="token punctuation">.</span>am_ntn_mail_log t <span class="token keyword">where</span> ntn_flag<span class="token operator">=</span><span class="token number">3</span> <span class="token operator">and</span> t<span class="token punctuation">.</span>remarks<span class="token operator">!=</span><span class="token string">'S'</span> <span class="token operator">and</span> t<span class="token punctuation">.</span>pos_month<span class="token operator">=</span><span class="token string">'201912'</span><span class="token punctuation">;</span>
<span class="token comment">--补得数据</span>
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> cen<span class="token punctuation">.</span>am_single_group_2019 t <span class="token keyword">where</span> t<span class="token punctuation">.</span>ntn_flag<span class="token operator">=</span><span class="token number">3</span> <span class="token operator">and</span> t<span class="token punctuation">.</span>bill_month<span class="token operator">=</span><span class="token number">201912</span><span class="token punctuation">;</span>

<span class="token comment">--额外生成的数据</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> CMPK_CEN<span class="token punctuation">.</span>AM_VPN_SUMMARY t<span class="token punctuation">;</span>

</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="http://8.208.26.203:18082/cmpak/acctmanm/edit/develop/doc/zh/assetcenter/writeoff.md" target="_blank" rel="noopener noreferrer">在 Gogs 上编辑此页</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/acct-doc/zh/assetcenter/interface.html" class="prev">
        接口出入参
      </a></span> <span class="next"><a href="/acct-doc/zh/assetcenter/前台设计文档.html">
        前台设计文档
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/acct-doc/assets/js/app.63ad57cc.js" defer></script><script src="/acct-doc/assets/js/2.33beb707.js" defer></script><script src="/acct-doc/assets/js/9.bbaf23c7.js" defer></script>
  </body>
</html>
